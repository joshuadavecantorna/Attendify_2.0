import{d as Me,q as Ie,r as y,c as Be,s as Xe,a as f,o as u,b as s,e as t,h as He,w as a,f as n,k as v,t as r,i as d,n as N,F,g as H,j,v as Ke,x as Qe,m as K}from"./app-OXmU166Q.js";import{B as le,C as Je,F as Ge,S as Ze,_ as qe}from"./AppLayout.vue_vue_type_script_setup_true_lang-CQKvJ_Ct.js";import{d as We}from"./index-C61bzdNy.js";import{_ as g,b as w,c as h,a as b,d as L}from"./CardTitle.vue_vue_type_script_setup_true_lang-FXh4yG6b.js";import{c as he,_}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CGIYOqcj.js";import{_ as Q}from"./index-DpPOakUB.js";import{_ as z}from"./Input.vue_vue_type_script_setup_true_lang-B7F0P19X.js";import{_ as A}from"./Label.vue_vue_type_script_setup_true_lang-B0_ysysQ.js";import{_ as ne,a as oe,b as de,c as re,d as S}from"./SelectValue.vue_vue_type_script_setup_true_lang-DS3K1WjJ.js";import{_ as fe,a as me,b as pe,c as ve,d as _e}from"./DialogTitle.vue_vue_type_script_setup_true_lang-6XzyZbOz.js";import{_ as xe}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CqT1EXV_.js";import{D as te}from"./download-Dr_Nksky.js";import{U}from"./users-CgcVcNzr.js";import{U as ye}from"./user-check-lULhbVeV.js";import{U as Ye}from"./user-x-DeIHMvp_.js";import{Z as et}from"./zap-D_-B-eka.js";import{Q as ge}from"./qr-code-Bs10IxCn.js";import{C as M}from"./calendar-N-OzfFB-.js";import{C as be}from"./clock-BndlhL6d.js";import{S as we}from"./search-BwSlLQkk.js";import{C as tt}from"./circle-check-big-C21okGWW.js";import{C as st}from"./circle-alert-CtovYjxa.js";import"./useForwardExpose-Dn3oH0KL.js";import"./RovingFocusGroup-BlJuKAAH.js";import"./check-DxhJGc9p.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=he("RefreshCwIcon",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=he("SaveIcon",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),lt={class:"space-y-6 p-6"},nt={class:"flex items-center justify-between"},ot={class:"space-y-2"},dt={class:"text-3xl font-bold tracking-tight"},rt={class:"text-muted-foreground"},ut={key:0,class:"flex gap-2"},it={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},ct={class:"text-2xl font-bold"},ft={class:"text-2xl font-bold text-green-600"},mt={class:"text-xs text-muted-foreground mt-1"},pt={class:"text-green-600"},vt={class:"text-2xl font-bold text-red-600"},_t={class:"text-xs text-muted-foreground mt-1"},xt={class:"text-2xl font-bold"},yt={class:"lg:col-span-1 space-y-6"},gt={key:0,class:"space-y-3"},bt={key:1,class:"space-y-3"},wt={class:"flex gap-2"},ht={key:0,class:"space-y-2"},kt={class:"flex items-center space-x-2"},St={key:1,class:"space-y-2"},Ct={key:0,class:"text-muted-foreground"},Rt={key:1},jt={class:"space-y-2"},At={class:"relative"},Et={key:2,class:"space-y-3 pt-3 border-t"},Dt={class:"grid grid-cols-2 gap-3"},Tt={class:"space-y-1"},Vt={class:"relative"},$t={class:"space-y-1"},Nt={class:"relative"},Ut={key:3,class:"pt-2 border-t"},Pt={class:"text-sm text-muted-foreground"},Ot={class:"flex justify-between"},Ft={class:"flex justify-between"},Lt={class:"text-green-600"},zt={class:"flex justify-between"},Mt={class:"text-red-600"},It={key:0,class:"flex justify-between"},Bt={class:"flex items-center justify-between"},Xt={class:"space-y-3"},Ht={class:"flex items-center gap-3"},Kt={class:"font-medium"},Qt={class:"text-sm text-muted-foreground"},Jt={class:"flex items-center gap-2"},Gt={key:0,class:"text-center py-8 text-muted-foreground"},Zt={class:"flex items-center justify-between"},qt={class:"flex gap-2"},Wt={class:"space-y-2"},Yt={class:"relative mb-4"},es={class:"space-y-2 max-h-96 overflow-y-auto"},ts={class:"flex items-center gap-3"},ss={class:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-sm font-medium"},as={class:"font-medium"},ls={class:"text-sm text-muted-foreground"},ns={class:"flex items-center gap-2"},os={key:0,class:"text-center py-8 text-muted-foreground"},ds={class:"flex items-center justify-between"},rs={class:"flex gap-2"},us={class:"space-y-6"},is={class:"grid grid-cols-5 gap-3"},cs={class:"text-center p-3 bg-blue-50 rounded-lg border border-blue-100"},fs={class:"text-2xl font-bold text-blue-600"},ms={class:"text-center p-3 bg-green-50 rounded-lg border border-green-100"},ps={class:"text-2xl font-bold text-green-600"},vs={class:"text-center p-3 bg-red-50 rounded-lg border border-red-100"},_s={class:"text-2xl font-bold text-red-600"},xs={class:"text-center p-3 bg-yellow-50 rounded-lg border border-yellow-100"},ys={class:"text-2xl font-bold text-yellow-600"},gs={class:"text-center p-3 bg-gray-50 rounded-lg border border-gray-100"},bs={class:"text-2xl font-bold text-gray-600"},ws={class:"flex gap-3"},hs={class:"relative flex-1"},ks={class:"space-y-2 max-h-80 overflow-y-auto"},Ss={class:"flex items-center gap-4"},Cs={class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium"},Rs={class:"font-semibold text-gray-900"},js={class:"text-sm text-gray-500"},As={class:"flex items-center gap-3"},Es={class:"text-right"},Ds={key:0,class:"text-center py-12 text-muted-foreground"},Ts={class:"text-lg font-semibold mb-2"},Vs={class:"text-muted-foreground"},$s={key:1,class:"space-y-6"},Ns={class:"grid gap-4 md:grid-cols-4"},Us={class:"text-2xl font-bold"},Ps={class:"text-2xl font-bold text-green-600"},Os={class:"text-xs text-muted-foreground mt-1"},Fs={class:"text-green-600"},Ls={class:"text-2xl font-bold text-red-600"},zs={class:"text-xs text-muted-foreground mt-1"},Ms={class:"text-2xl font-bold"},Is={class:"space-y-3"},Bs={class:"flex items-center gap-3"},Xs={class:"font-medium"},Hs={class:"text-sm text-muted-foreground"},Ks={key:0},Qs={class:"flex items-center gap-2"},Js={key:0,class:"text-center py-8 text-muted-foreground"},Gs={class:"flex justify-center py-6"},Zs={class:"w-48 h-48 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center"},qs={class:"text-center text-sm text-muted-foreground"},Ws={class:"space-y-4"},Ys={class:"space-y-2"},ea={class:"space-y-2"},ja=Me({__name:"Attendance",props:{userRole:{},classes:{default:()=>[]},attendanceStats:{},todaySessions:{default:()=>[]},student:{},attendanceHistory:{default:()=>[]}},setup(ke){const i=ke,E=Ie(),Se=[{title:"Dashboard",href:We().url},{title:"Attendance",href:"#"}],m=y(""),x=y(new Date().toISOString().split("T")[0]),D=y(""),I=y("all"),B=y(!1),se=y(""),k=y(!1),C=y([]),p=y(!1),X=y(!1),J=y(null),P=y(""),G=y(null),T=y({total:0,present:0,absent:0,excused:0,no_record:0,attendance_rate:0}),V=y(new Date().toISOString().split("T")[0]),$=y(new Date().toISOString().split("T")[0]),Z=Be(()=>{let o=C.value;if(D.value){const e=D.value.toLowerCase();o=o.filter(l=>l.name.toLowerCase().includes(e)||l.studentId.toLowerCase().includes(e))}return I.value&&I.value!=="all"&&(o=o.filter(e=>e.status===I.value)),o}),q=o=>new Date(o).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),O=o=>i.classes?.find(e=>e.id===o),Ce=async o=>{console.log("Class changed to:",o),D.value="",o&&i.userRole!=="student"&&await W(o,x.value)},Re=async()=>{console.log("Date changed to:",x.value),k.value&&i.userRole==="admin"?await ae():m.value&&i.userRole!=="student"&&await W(m.value,x.value)},W=async(o,e)=>{try{p.value=!0;const l=await fetch(`/attendance/class/${o}/students?date=${e}`,{method:"GET",headers:{"X-CSRF-TOKEN":E.props.csrf_token,Accept:"application/json"}});if(l.ok){const c=await l.json();C.value=c}else console.error("Failed to load students")}catch(l){console.error("Error loading students:",l)}finally{p.value=!1}},je=()=>{if(!m.value){alert("Please select a class first");return}se.value="SESSION-"+Date.now(),B.value=!0},Ae=()=>{K.visit("/reports")},Ee=async()=>{if(!m.value){alert("Please select a class first");return}try{p.value=!0;const o=await fetch("/attendance/export",{method:"POST",headers:{"X-CSRF-TOKEN":E.props.csrf_token,"Content-Type":"application/json",Accept:"text/csv"},body:JSON.stringify({class_id:m.value,start_date:x.value,end_date:x.value,format:"class"})});if(o.ok){const e=await o.blob(),l=window.URL.createObjectURL(e),c=document.createElement("a");c.href=l;const R=o.headers.get("Content-Disposition");let Y="attendance_export.csv";if(R){const ee=R.match(/filename="(.+)"/);ee&&(Y=ee[1])}else Y=`attendance_${(O(m.value)?.name||"class").replace(/[^a-zA-Z0-9]/g,"_")}_${x.value}.csv`;c.download=Y,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l),alert("Attendance data exported successfully!")}else{const e=await o.json().catch(()=>({error:"Export failed"}));alert(e.error||"Export failed. Please try again.")}}catch(o){console.error("Export error:",o),alert("Export failed. Please try again.")}finally{p.value=!1}},De=(o,e)=>{const l=C.value.find(c=>c.id===o);l&&(l.status=e)},Te=()=>{C.value.forEach(o=>{o.status="present"})},Ve=async()=>{if(!m.value||C.value.length===0){alert("No students to save attendance for");return}try{p.value=!0;const o=await fetch("/attendance/record",{method:"POST",headers:{"X-CSRF-TOKEN":E.props.csrf_token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({class_id:m.value,date:x.value,students:C.value.map(e=>({student_id:e.id,status:e.status,time_in:e.status==="present"?"08:00":null,time_out:e.status==="present"?"10:00":null}))})});if(o.ok){const e=await o.json();alert(e.message)}else{const e=await o.json();alert(e.error||"Failed to save attendance")}}catch(o){console.error("Save error:",o),alert("Failed to save attendance. Please try again.")}finally{p.value=!1}},$e=async()=>{if(!J.value||!P.value.trim()){alert("Please provide a reason for the excuse");return}try{p.value=!0;const o=new FormData;o.append("attendance_id",J.value.id),o.append("reason",P.value),G.value&&o.append("supporting_document",G.value);const e=await fetch("/attendance/excuse",{method:"POST",headers:{"X-CSRF-TOKEN":E.props.csrf_token,Accept:"application/json"},body:o});if(e.ok){const l=await e.json();alert(l.message),X.value=!1,P.value="",G.value=null,J.value=null,K.reload()}else{const l=await e.json();alert(l.error||"Failed to submit excuse")}}catch(o){console.error("Excuse submission error:",o),alert("Failed to submit excuse. Please try again.")}finally{p.value=!1}},Ne=()=>{K.reload()},Ue=o=>{m.value=o.classId,i.userRole!=="student"&&W(o.classId,x.value)},Pe=()=>{B.value=!1,se.value="",alert("Attendance session ended")},Oe=o=>{J.value=o,X.value=!0},Fe=()=>{k.value=!0,m.value="",ae()},Le=()=>{K.visit("/reports")},ze=async()=>{try{p.value=!0;const o=await fetch("/attendance/export",{method:"POST",headers:{"X-CSRF-TOKEN":E.props.csrf_token,"Content-Type":"application/json",Accept:"text/csv"},body:JSON.stringify({export_all:!0,start_date:x.value,end_date:x.value,format:"system"})});if(o.ok){const e=await o.blob(),l=window.URL.createObjectURL(e),c=document.createElement("a");c.href=l;const R=`system_attendance_${x.value}.csv`;c.download=R,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l),alert("System attendance data exported successfully!")}else{const e=await o.json().catch(()=>({error:"Export failed"}));alert(e.error||"Export failed. Please try again.")}}catch(o){console.error("Export error:",o),alert("Export failed. Please try again.")}finally{p.value=!1}},ae=async()=>{if(i.userRole==="admin")try{p.value=!0;const o=await fetch(`/attendance/system-overview?date=${x.value}`,{method:"GET",headers:{"X-CSRF-TOKEN":E.props.csrf_token,Accept:"application/json"}});if(o.ok){const e=await o.json();C.value=e.students||[],T.value=e.summary||T.value}else console.error("Failed to load system attendance")}catch(o){console.error("Error loading system attendance:",o)}finally{p.value=!1}},ie=()=>{k.value&&i.userRole==="admin"?ae():K.reload()},ce=async()=>{if(!V.value||!$.value){alert("Please select both start and end dates");return}if(new Date(V.value)>new Date($.value)){alert("Start date cannot be after end date");return}try{p.value=!0;const o=await fetch("/attendance/export",{method:"POST",headers:{"X-CSRF-TOKEN":E.props.csrf_token,"Content-Type":"application/json",Accept:"text/csv"},body:JSON.stringify({class_id:m.value||null,start_date:V.value,end_date:$.value,format:m.value?"class":"teacher"})});if(o.ok){const e=await o.blob(),l=window.URL.createObjectURL(e),c=document.createElement("a");c.href=l;let R;m.value?R=`attendance_${(O(m.value)?.name||"class").replace(/[^a-zA-Z0-9]/g,"_")}_${V.value}_to_${$.value}.csv`:R=`attendance_all_classes_${V.value}_to_${$.value}.csv`,c.download=R,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l),alert("Attendance data exported successfully!")}else{const e=await o.json().catch(()=>({error:"Export failed"}));alert(e.error||"Export failed. Please try again.")}}catch(o){console.error("Export error:",o),alert("Export failed. Please try again.")}finally{p.value=!1}};return Xe(async()=>{i.classes&&i.classes.length>0&&i.userRole!=="student"&&(m.value=i.classes[0].id,await W(m.value,x.value))}),(o,e)=>(u(),f(F,null,[s(t(He),{title:"Attendance"}),s(qe,{breadcrumbs:Se},{default:a(()=>[n("div",lt,[n("div",nt,[n("div",ot,[n("h1",dt,r(i.userRole==="admin"?"System Attendance Management":"Attendance Management"),1),n("p",rt,r(i.userRole==="admin"?"Monitor and manage attendance across all classes and students":"Track, manage, and monitor student attendance for all your classes"),1)]),i.userRole==="admin"?(u(),f("div",ut,[s(t(_),{onClick:ie,variant:"outline"},{default:a(()=>[s(t(ue),{class:"h-4 w-4 mr-2"}),e[15]||(e[15]=d(" Refresh Data ",-1))]),_:1,__:[15]}),s(t(_),{onClick:ze},{default:a(()=>[s(t(te),{class:"h-4 w-4 mr-2"}),e[16]||(e[16]=d(" Export All ",-1))]),_:1,__:[16]})])):v("",!0)]),n("div",it,[s(t(g),null,{default:a(()=>[s(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(h),{class:"text-sm font-medium"},{default:a(()=>e[17]||(e[17]=[d("Total Students",-1)])),_:1,__:[17]}),s(t(U),{class:"h-5 w-5 text-blue-500"})]),_:1}),s(t(b),null,{default:a(()=>[n("div",ct,r(o.attendanceStats.totalStudents||0),1),e[18]||(e[18]=n("p",{class:"text-xs text-muted-foreground mt-1"}," Across all classes ",-1))]),_:1,__:[18]})]),_:1}),s(t(g),null,{default:a(()=>[s(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(h),{class:"text-sm font-medium"},{default:a(()=>e[19]||(e[19]=[d("Present Today",-1)])),_:1,__:[19]}),s(t(ye),{class:"h-5 w-5 text-green-500"})]),_:1}),s(t(b),null,{default:a(()=>[n("div",ft,r(o.attendanceStats.presentToday||0),1),n("p",mt,[n("span",pt,r(o.attendanceStats.totalStudents&&o.attendanceStats.presentToday?(o.attendanceStats.presentToday/o.attendanceStats.totalStudents*100).toFixed(1):0)+"%",1),e[20]||(e[20]=d(" attendance rate ",-1))])]),_:1})]),_:1}),s(t(g),null,{default:a(()=>[s(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(h),{class:"text-sm font-medium"},{default:a(()=>e[21]||(e[21]=[d("Absent Today",-1)])),_:1,__:[21]}),s(t(Ye),{class:"h-5 w-5 text-red-500"})]),_:1}),s(t(b),null,{default:a(()=>[n("div",vt,r(o.attendanceStats.absentToday||0),1),n("p",_t,r(o.attendanceStats.excusedToday||0)+" excused absences ",1)]),_:1})]),_:1}),s(t(g),null,{default:a(()=>[s(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(h),{class:"text-sm font-medium"},{default:a(()=>e[22]||(e[22]=[d("Active Classes",-1)])),_:1,__:[22]}),s(t(le),{class:"h-5 w-5 text-purple-500"})]),_:1}),s(t(b),null,{default:a(()=>[n("div",xt,r(o.attendanceStats.activeClasses||0),1),e[23]||(e[23]=n("p",{class:"text-xs text-muted-foreground mt-1"}," Classes today ",-1))]),_:1,__:[23]})]),_:1})]),i.userRole!=="student"?(u(),f("div",{key:0,class:N(["grid gap-6",i.userRole==="admin"?"lg:grid-cols-4":"lg:grid-cols-3"])},[n("div",yt,[s(t(g),null,{default:a(()=>[s(t(w),null,{default:a(()=>[s(t(h),{class:"flex items-center gap-2"},{default:a(()=>[s(t(et),{class:"h-5 w-5"}),e[24]||(e[24]=d(" Quick Actions ",-1))]),_:1,__:[24]}),s(t(L),null,{default:a(()=>[d(r(i.userRole==="admin"?"System administration and oversight":"Start attendance or manage students"),1)]),_:1})]),_:1}),s(t(b),{class:"space-y-3"},{default:a(()=>[i.userRole==="admin"?(u(),f("div",gt,[s(t(_),{onClick:Fe,class:"w-full justify-start",size:"sm"},{default:a(()=>[s(t(U),{class:"mr-2 h-4 w-4"}),e[25]||(e[25]=d(" All Attendance ",-1))]),_:1,__:[25]}),s(t(_),{onClick:Le,variant:"outline",class:"justify-start w-full",size:"sm"},{default:a(()=>[s(t(Je),{class:"mr-2 h-4 w-4"}),e[26]||(e[26]=d(" Reports ",-1))]),_:1,__:[26]})])):(u(),f("div",bt,[s(t(_),{onClick:je,class:"w-full justify-start",size:"lg"},{default:a(()=>[s(t(ge),{class:"mr-2 h-4 w-4"}),e[27]||(e[27]=d(" Start QR Attendance ",-1))]),_:1,__:[27]}),s(t(_),{onClick:Ae,variant:"outline",class:"w-full justify-start",size:"lg"},{default:a(()=>[s(t(Ge),{class:"mr-2 h-4 w-4"}),e[28]||(e[28]=d(" View Reports ",-1))]),_:1,__:[28]}),n("div",wt,[s(t(_),{onClick:Ee,variant:"outline",class:"flex-1 justify-start",size:"lg",disabled:!m.value||p.value},{default:a(()=>[s(t(te),{class:"mr-2 h-4 w-4"}),d(" "+r(p.value?"Exporting...":"Export Today"),1)]),_:1},8,["disabled"]),s(t(_),{onClick:ce,variant:"outline",class:"flex-1 justify-start",size:"lg",disabled:p.value},{default:a(()=>[s(t(te),{class:"mr-2 h-4 w-4"}),d(" "+r(p.value?"Exporting...":"Export Range"),1)]),_:1},8,["disabled"])])]))]),_:1})]),_:1}),s(t(g),null,{default:a(()=>[s(t(w),null,{default:a(()=>[s(t(h),{class:"flex items-center gap-2"},{default:a(()=>[s(t(le),{class:"h-5 w-5"}),d(" "+r(i.userRole==="admin"?"Select Class (All System)":"Select Class"),1)]),_:1}),s(t(L),null,{default:a(()=>[d(r(i.userRole==="admin"?"View attendance for any class in the system":"Choose a class to view attendance"),1)]),_:1})]),_:1}),s(t(b),{class:"space-y-3"},{default:a(()=>[i.userRole==="admin"?(u(),f("div",ht,[s(t(A),{for:"all-classes-toggle"},{default:a(()=>e[29]||(e[29]=[d("View Mode",-1)])),_:1,__:[29]}),n("div",kt,[s(t(_),{onClick:e[0]||(e[0]=l=>k.value=!k.value),variant:"outline",size:"sm",class:"w-full"},{default:a(()=>[d(r(k.value?"Show Individual Class":"Show All Classes"),1)]),_:1})])])):v("",!0),!k.value||i.userRole!=="admin"?(u(),f("div",St,[s(t(A),{for:"class-select"},{default:a(()=>e[30]||(e[30]=[d("Class",-1)])),_:1,__:[30]}),s(t(ne),{modelValue:m.value,"onUpdate:modelValue":[e[1]||(e[1]=l=>m.value=l),e[2]||(e[2]=l=>Ce(l))]},{default:a(()=>[s(t(oe),null,{default:a(()=>[s(t(de),{placeholder:"Select a class"})]),_:1}),s(t(re),null,{default:a(()=>[(u(!0),f(F,null,H(o.classes,l=>(u(),j(t(S),{key:l.id,value:l.id},{default:a(()=>[d(r(l.name)+" ",1),i.userRole==="admin"?(u(),f("span",Ct," ("+r(l.teacher)+") - "+r(l.studentCount)+" students ",1)):(u(),f("span",Rt," ("+r(l.studentCount)+" students) ",1))]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])):v("",!0),n("div",jt,[s(t(A),{for:"date-select",class:"text-sm font-medium"},{default:a(()=>e[31]||(e[31]=[d("Date",-1)])),_:1,__:[31]}),n("div",At,[s(t(M),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4 pointer-events-none"}),s(t(z),{type:"date",modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=l=>x.value=l),onChange:Re,id:"date-select",class:"pl-10 [&::-webkit-calendar-picker-indicator]:hidden [&::-webkit-calendar-picker-indicator]:absolute [&::-webkit-calendar-picker-indicator]:right-2 [&::-webkit-calendar-picker-indicator]:top-1/2 [&::-webkit-calendar-picker-indicator]:transform [&::-webkit-calendar-picker-indicator]:-translate-y-1/2",placeholder:"Select date"},null,8,["modelValue"])])]),i.userRole!=="student"?(u(),f("div",Et,[s(t(A),{class:"text-sm font-medium"},{default:a(()=>e[32]||(e[32]=[d("Export Date Range",-1)])),_:1,__:[32]}),n("div",Dt,[n("div",Tt,[s(t(A),{for:"export-start-date",class:"text-xs text-gray-600"},{default:a(()=>e[33]||(e[33]=[d("From Date",-1)])),_:1,__:[33]}),n("div",Vt,[s(t(M),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4 pointer-events-none"}),s(t(z),{type:"date",modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=l=>V.value=l),id:"export-start-date",class:"text-sm pl-10 [&::-webkit-calendar-picker-indicator]:opacity-0",placeholder:"Select start date"},null,8,["modelValue"])])]),n("div",$t,[s(t(A),{for:"export-end-date",class:"text-xs text-gray-600"},{default:a(()=>e[34]||(e[34]=[d("To Date",-1)])),_:1,__:[34]}),n("div",Nt,[s(t(M),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4 pointer-events-none"}),s(t(z),{type:"date",modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=l=>$.value=l),id:"export-end-date",class:"text-sm pl-10 [&::-webkit-calendar-picker-indicator]:opacity-0",placeholder:"Select end date"},null,8,["modelValue"])])])]),s(t(_),{onClick:ce,variant:"outline",size:"sm",class:"w-full mt-2",disabled:p.value},{default:a(()=>[s(t(te),{class:"h-4 w-4 mr-2"}),d(" "+r(p.value?"Exporting...":"Export Range to CSV"),1)]),_:1},8,["disabled"])])):v("",!0),m.value&&!k.value?(u(),f("div",Ut,[n("div",Pt,[n("div",Ot,[e[35]||(e[35]=n("span",null,"Students:",-1)),n("span",null,r(O(m.value)?.studentCount||0),1)]),n("div",Ft,[e[36]||(e[36]=n("span",null,"Present:",-1)),n("span",Lt,r(C.value.filter(l=>l.status==="present").length),1)]),n("div",zt,[e[37]||(e[37]=n("span",null,"Absent:",-1)),n("span",Mt,r(C.value.filter(l=>l.status==="absent").length),1)]),i.userRole==="admin"?(u(),f("div",It,[e[38]||(e[38]=n("span",null,"Teacher:",-1)),n("span",null,r(O(m.value)?.teacher||"N/A"),1)])):v("",!0)])])):v("",!0)]),_:1})]),_:1})]),n("div",{class:N([i.userRole==="admin"?"lg:col-span-3":"lg:col-span-2","space-y-6"])},[o.userRole==="teacher"?(u(),j(t(g),{key:0},{default:a(()=>[s(t(w),null,{default:a(()=>[n("div",Bt,[n("div",null,[s(t(h),{class:"flex items-center gap-2"},{default:a(()=>[s(t(be),{class:"h-5 w-5"}),e[39]||(e[39]=d(" Today's Sessions ",-1))]),_:1,__:[39]}),s(t(L),null,{default:a(()=>[d(r(q(x.value)),1)]),_:1})]),s(t(_),{onClick:Ne,variant:"outline",size:"sm"},{default:a(()=>[s(t(ue),{class:"h-4 w-4 mr-1"}),e[40]||(e[40]=d(" Refresh ",-1))]),_:1,__:[40]})])]),_:1}),s(t(b),null,{default:a(()=>[n("div",Xt,[(u(!0),f(F,null,H(o.todaySessions,l=>(u(),f("div",{key:l.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors"},[n("div",Ht,[n("div",{class:N(["w-2 h-2 rounded-full",{"bg-green-500":l.status==="completed","bg-blue-500":l.status==="active","bg-gray-400":l.status==="scheduled"}])},null,2),n("div",null,[n("p",Kt,r(l.className),1),n("p",Qt,r(l.time)+" • "+r(l.presentCount)+"/"+r(l.totalStudents)+" present ",1)])]),n("div",Jt,[s(t(Q),{variant:l.status==="completed"?"default":l.status==="active"?"secondary":"outline"},{default:a(()=>[d(r(l.status==="completed"?"Completed":l.status==="active"?"Active":"Scheduled"),1)]),_:2},1032,["variant"]),l.status!=="completed"?(u(),j(t(_),{key:0,onClick:c=>Ue(l),variant:"ghost",size:"sm"},{default:a(()=>[s(t(Ze),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):v("",!0)])]))),128)),o.todaySessions.length===0?(u(),f("div",Gt,[s(t(M),{class:"mx-auto h-8 w-8 mb-2"}),e[41]||(e[41]=n("p",null,"No sessions scheduled for today",-1))])):v("",!0)])]),_:1})]),_:1})):v("",!0),m.value&&!k.value?(u(),j(t(g),{key:1},{default:a(()=>[s(t(w),null,{default:a(()=>[n("div",Zt,[n("div",null,[s(t(h),{class:"flex items-center gap-2"},{default:a(()=>[s(t(U),{class:"h-5 w-5"}),e[42]||(e[42]=d(" Student Attendance ",-1))]),_:1,__:[42]}),s(t(L),null,{default:a(()=>[d(r(O(m.value)?.name)+" - "+r(q(x.value)),1)]),_:1})]),n("div",qt,[s(t(_),{onClick:Te,variant:"outline",size:"sm"},{default:a(()=>[s(t(ye),{class:"h-4 w-4 mr-1"}),e[43]||(e[43]=d(" Mark All Present ",-1))]),_:1,__:[43]}),s(t(_),{onClick:Ve,size:"sm"},{default:a(()=>[s(t(at),{class:"h-4 w-4 mr-1"}),e[44]||(e[44]=d(" Save Changes ",-1))]),_:1,__:[44]})])])]),_:1}),s(t(b),null,{default:a(()=>[n("div",Wt,[n("div",Yt,[s(t(we),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),s(t(z),{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=l=>D.value=l),placeholder:"Search students...",class:"pl-10"},null,8,["modelValue"])]),n("div",es,[(u(!0),f(F,null,H(Z.value,l=>(u(),f("div",{key:l.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors"},[n("div",ts,[n("div",ss,r(l.name.charAt(0)),1),n("div",null,[n("p",as,r(l.name),1),n("p",ls,r(l.studentId),1)])]),n("div",ns,[s(t(ne),{modelValue:l.status,"onUpdate:modelValue":[c=>l.status=c,c=>De(l.id,c)]},{default:a(()=>[s(t(oe),{class:"w-32"},{default:a(()=>[s(t(de))]),_:1}),s(t(re),null,{default:a(()=>[s(t(S),{value:"present"},{default:a(()=>e[45]||(e[45]=[d("Present",-1)])),_:1,__:[45]}),s(t(S),{value:"absent"},{default:a(()=>e[46]||(e[46]=[d("Absent",-1)])),_:1,__:[46]}),s(t(S),{value:"excused"},{default:a(()=>e[47]||(e[47]=[d("Excused",-1)])),_:1,__:[47]}),s(t(S),{value:"late"},{default:a(()=>e[48]||(e[48]=[d("Late",-1)])),_:1,__:[48]})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"]),s(t(Q),{class:N({"bg-green-100 text-green-800":l.status==="present","bg-red-100 text-red-800":l.status==="absent","bg-yellow-100 text-yellow-800":l.status==="excused","bg-orange-100 text-orange-800":l.status==="late"})},{default:a(()=>[d(r(l.status),1)]),_:2},1032,["class"])])]))),128))]),Z.value.length===0?(u(),f("div",os,[s(t(U),{class:"mx-auto h-8 w-8 mb-2"}),e[49]||(e[49]=n("p",null,"No students found",-1))])):v("",!0)])]),_:1})]),_:1})):v("",!0),k.value&&i.userRole==="admin"?(u(),j(t(g),{key:2},{default:a(()=>[s(t(w),null,{default:a(()=>[n("div",ds,[n("div",null,[s(t(h),{class:"flex items-center gap-2"},{default:a(()=>[s(t(U),{class:"h-5 w-5"}),e[50]||(e[50]=d(" System Overview ",-1))]),_:1,__:[50]}),s(t(L),null,{default:a(()=>[d("All students - "+r(q(x.value)),1)]),_:1})]),n("div",rs,[s(t(_),{onClick:ie,variant:"outline",size:"sm"},{default:a(()=>[s(t(ue),{class:"h-4 w-4"})]),_:1})])])]),_:1}),s(t(b),null,{default:a(()=>[n("div",us,[n("div",is,[n("div",cs,[n("div",fs,r(T.value.total||0),1),e[51]||(e[51]=n("div",{class:"text-xs text-blue-600 font-medium"},"Total",-1))]),n("div",ms,[n("div",ps,r(T.value.present||0),1),e[52]||(e[52]=n("div",{class:"text-xs text-green-600 font-medium"},"Present",-1))]),n("div",vs,[n("div",_s,r(T.value.absent||0),1),e[53]||(e[53]=n("div",{class:"text-xs text-red-600 font-medium"},"Absent",-1))]),n("div",xs,[n("div",ys,r(T.value.excused||0),1),e[54]||(e[54]=n("div",{class:"text-xs text-yellow-600 font-medium"},"Excused",-1))]),n("div",gs,[n("div",bs,r(T.value.no_record||0),1),e[55]||(e[55]=n("div",{class:"text-xs text-gray-600 font-medium"},"No Record",-1))])]),n("div",ws,[n("div",hs,[s(t(we),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),s(t(z),{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=l=>D.value=l),placeholder:"Search students...",class:"pl-10"},null,8,["modelValue"])]),s(t(ne),{modelValue:I.value,"onUpdate:modelValue":e[8]||(e[8]=l=>I.value=l)},{default:a(()=>[s(t(oe),{class:"w-32"},{default:a(()=>[s(t(de),{placeholder:"Status"})]),_:1}),s(t(re),null,{default:a(()=>[s(t(S),{value:"all"},{default:a(()=>e[56]||(e[56]=[d("All",-1)])),_:1,__:[56]}),s(t(S),{value:"present"},{default:a(()=>e[57]||(e[57]=[d("Present",-1)])),_:1,__:[57]}),s(t(S),{value:"absent"},{default:a(()=>e[58]||(e[58]=[d("Absent",-1)])),_:1,__:[58]}),s(t(S),{value:"excused"},{default:a(()=>e[59]||(e[59]=[d("Excused",-1)])),_:1,__:[59]}),s(t(S),{value:"no-record"},{default:a(()=>e[60]||(e[60]=[d("No Record",-1)])),_:1,__:[60]})]),_:1})]),_:1},8,["modelValue"])]),n("div",ks,[(u(!0),f(F,null,H(Z.value,l=>(u(),f("div",{key:l.id,class:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors bg-white"},[n("div",Ss,[n("div",Cs,r(l.name.charAt(0).toUpperCase()),1),n("div",null,[n("p",Rs,r(l.name),1),n("p",js,r(l.studentId),1)])]),n("div",As,[n("div",Es,[s(t(Q),{class:N([{"bg-green-100 text-green-800 border-green-200":l.status==="present","bg-red-100 text-red-800 border-red-200":l.status==="absent","bg-yellow-100 text-yellow-800 border-yellow-200":l.status==="excused","bg-orange-100 text-orange-800 border-orange-200":l.status==="late","bg-gray-100 text-gray-800 border-gray-200":l.status==="no-record"},"font-medium"])},{default:a(()=>[d(r(l.status==="no-record"?"No Record":l.status.charAt(0).toUpperCase()+l.status.slice(1)),1)]),_:2},1032,["class"])])])]))),128))]),Z.value.length===0?(u(),f("div",Ds,[s(t(U),{class:"mx-auto h-12 w-12 mb-3 text-gray-300"}),e[61]||(e[61]=n("p",{class:"text-lg font-medium mb-1"},"No students found",-1)),e[62]||(e[62]=n("p",{class:"text-sm"},"Try adjusting your search or filter criteria",-1))])):v("",!0)])]),_:1})]),_:1})):v("",!0),!m.value&&!k.value?(u(),j(t(g),{key:3},{default:a(()=>[s(t(b),{class:"text-center py-12"},{default:a(()=>[s(t(le),{class:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),n("h3",Ts,r(i.userRole==="admin"?"Select View Mode":"Select a Class"),1),n("p",Vs,r(i.userRole==="admin"?"Choose to view individual class attendance or system-wide overview":"Choose a class from the sidebar to view and manage attendance"),1)]),_:1})]),_:1})):v("",!0)],2)],2)):v("",!0),i.userRole==="student"?(u(),f("div",$s,[n("div",Ns,[s(t(g),null,{default:a(()=>[s(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(h),{class:"text-sm font-medium"},{default:a(()=>e[63]||(e[63]=[d("Total Days",-1)])),_:1,__:[63]}),s(t(M),{class:"h-5 w-5 text-blue-500"})]),_:1}),s(t(b),null,{default:a(()=>[n("div",Us,r(o.attendanceStats.totalDays||0),1),e[64]||(e[64]=n("p",{class:"text-xs text-muted-foreground mt-1"}," This semester ",-1))]),_:1,__:[64]})]),_:1}),s(t(g),null,{default:a(()=>[s(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(h),{class:"text-sm font-medium"},{default:a(()=>e[65]||(e[65]=[d("Present Days",-1)])),_:1,__:[65]}),s(t(tt),{class:"h-5 w-5 text-green-500"})]),_:1}),s(t(b),null,{default:a(()=>[n("div",Ps,r(o.attendanceStats.presentDays||0),1),n("p",Os,[n("span",Fs,r(o.attendanceStats.attendanceRate||0)+"%",1),e[66]||(e[66]=d(" attendance rate ",-1))])]),_:1})]),_:1}),s(t(g),null,{default:a(()=>[s(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(h),{class:"text-sm font-medium"},{default:a(()=>e[67]||(e[67]=[d("Absent Days",-1)])),_:1,__:[67]}),s(t(st),{class:"h-5 w-5 text-red-500"})]),_:1}),s(t(b),null,{default:a(()=>[n("div",Ls,r(o.attendanceStats.absentDays||0),1),n("p",zs,r(o.attendanceStats.excusedDays||0)+" excused ",1)]),_:1})]),_:1}),s(t(g),null,{default:a(()=>[s(t(w),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(h),{class:"text-sm font-medium"},{default:a(()=>e[68]||(e[68]=[d("Attendance Rate",-1)])),_:1,__:[68]}),s(t(U),{class:"h-5 w-5 text-purple-500"})]),_:1}),s(t(b),null,{default:a(()=>[n("div",Ms,r(o.attendanceStats.attendanceRate||0)+"%",1),e[69]||(e[69]=n("p",{class:"text-xs text-muted-foreground mt-1"}," Overall performance ",-1))]),_:1,__:[69]})]),_:1})]),s(t(g),null,{default:a(()=>[s(t(w),null,{default:a(()=>[s(t(h),{class:"flex items-center gap-2"},{default:a(()=>[s(t(be),{class:"h-5 w-5"}),e[70]||(e[70]=d(" My Attendance History ",-1))]),_:1,__:[70]}),s(t(L),null,{default:a(()=>e[71]||(e[71]=[d("View your attendance records and submit excuses",-1)])),_:1,__:[71]})]),_:1}),s(t(b),null,{default:a(()=>[n("div",Is,[(u(!0),f(F,null,H(i.attendanceHistory,l=>(u(),f("div",{key:l.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors"},[n("div",Bs,[n("div",{class:N(["w-2 h-2 rounded-full",{"bg-green-500":l.status==="present","bg-red-500":l.status==="absent","bg-yellow-500":l.status==="excused","bg-orange-500":l.status==="late"}])},null,2),n("div",null,[n("p",Xs,r(l.class_name),1),n("p",Hs,[d(r(q(l.date))+" ",1),l.time_in?(u(),f("span",Ks," • "+r(l.time_in),1)):v("",!0)])])]),n("div",Qs,[s(t(Q),{class:N({"bg-green-100 text-green-800":l.status==="present","bg-red-100 text-red-800":l.status==="absent","bg-yellow-100 text-yellow-800":l.status==="excused","bg-orange-100 text-orange-800":l.status==="late"})},{default:a(()=>[d(r(l.status),1)]),_:2},1032,["class"]),l.status==="absent"&&!l.excuse?(u(),j(t(_),{key:0,onClick:c=>Oe(l),variant:"outline",size:"sm"},{default:a(()=>e[72]||(e[72]=[d(" Submit Excuse ",-1)])),_:2,__:[72]},1032,["onClick"])):v("",!0),l.excuse?(u(),j(t(Q),{key:1,variant:l.excuse.status==="approved"?"default":l.excuse.status==="pending"?"secondary":"destructive"},{default:a(()=>[d(" Excuse "+r(l.excuse.status),1)]),_:2},1032,["variant"])):v("",!0)])]))),128)),i.attendanceHistory.length===0?(u(),f("div",Js,[s(t(M),{class:"mx-auto h-8 w-8 mb-2"}),e[73]||(e[73]=n("p",null,"No attendance records found",-1))])):v("",!0)])]),_:1})]),_:1})])):v("",!0)]),s(t(fe),{open:B.value,"onUpdate:open":e[10]||(e[10]=l=>B.value=l)},{default:a(()=>[s(t(me),{class:"sm:max-w-md"},{default:a(()=>[s(t(pe),null,{default:a(()=>[s(t(ve),null,{default:a(()=>e[74]||(e[74]=[d("QR Code Attendance",-1)])),_:1,__:[74]}),s(t(_e),null,{default:a(()=>e[75]||(e[75]=[d(" Students can scan this QR code to mark their attendance ",-1)])),_:1,__:[75]})]),_:1}),n("div",Gs,[n("div",Zs,[s(t(ge),{class:"h-16 w-16 text-gray-400"})])]),n("div",qs,[d(" Class: "+r(O(m.value)?.name),1),e[76]||(e[76]=n("br",null,null,-1)),d(" Session ID: "+r(se.value),1)]),s(t(xe),null,{default:a(()=>[s(t(_),{onClick:e[9]||(e[9]=l=>B.value=!1),variant:"outline"},{default:a(()=>e[77]||(e[77]=[d("Close",-1)])),_:1,__:[77]}),s(t(_),{onClick:Pe},{default:a(()=>e[78]||(e[78]=[d("End Session",-1)])),_:1,__:[78]})]),_:1})]),_:1})]),_:1},8,["open"]),s(t(fe),{open:X.value,"onUpdate:open":e[14]||(e[14]=l=>X.value=l)},{default:a(()=>[s(t(me),{class:"sm:max-w-md"},{default:a(()=>[s(t(pe),null,{default:a(()=>[s(t(ve),null,{default:a(()=>e[79]||(e[79]=[d("Submit Excuse",-1)])),_:1,__:[79]}),s(t(_e),null,{default:a(()=>e[80]||(e[80]=[d(" Provide a reason for your absence and any supporting documentation ",-1)])),_:1,__:[80]})]),_:1}),n("div",Ws,[n("div",Ys,[s(t(A),{for:"excuse-reason"},{default:a(()=>e[81]||(e[81]=[d("Reason for Absence",-1)])),_:1,__:[81]}),Ke(n("textarea",{id:"excuse-reason","onUpdate:modelValue":e[11]||(e[11]=l=>P.value=l),placeholder:"Please explain the reason for your absence...",class:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},null,512),[[Qe,P.value]])]),n("div",ea,[s(t(A),{for:"supporting-doc"},{default:a(()=>e[82]||(e[82]=[d("Supporting Document (Optional)",-1)])),_:1,__:[82]}),s(t(z),{id:"supporting-doc",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:e[12]||(e[12]=l=>G.value=l.target?.files?.[0]||null)}),e[83]||(e[83]=n("p",{class:"text-xs text-muted-foreground"}," PDF, JPG, JPEG, or PNG files only (max 2MB) ",-1))])]),s(t(xe),null,{default:a(()=>[s(t(_),{onClick:e[13]||(e[13]=l=>X.value=!1),variant:"outline"},{default:a(()=>e[84]||(e[84]=[d("Cancel",-1)])),_:1,__:[84]}),s(t(_),{onClick:$e,disabled:!P.value.trim()||p.value},{default:a(()=>[d(r(p.value?"Submitting...":"Submit Excuse"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{ja as default};
