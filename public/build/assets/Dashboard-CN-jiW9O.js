import{_ as xe}from"./AppLayout.vue_vue_type_script_setup_true_lang-CQKvJ_Ct.js";import{d as be,q as Ce,c as D,r as g,C as ye,a as c,o as d,b as s,e as t,h as we,w as a,f as o,i as r,t as u,F as P,g as A,n as he,j as E,l as ke,k as N,m as O}from"./app-OXmU166Q.js";import{_ as x,b,c as C,a as y,d as T}from"./CardTitle.vue_vue_type_script_setup_true_lang-FXh4yG6b.js";import{_ as z}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CGIYOqcj.js";import{_ as Se}from"./index-DpPOakUB.js";import{_ as X,a as H,b as J,c as W,d as K}from"./DialogTitle.vue_vue_type_script_setup_true_lang-6XzyZbOz.js";import{_ as G,a as Z,b as ee,c as te,d as Y}from"./SelectValue.vue_vue_type_script_setup_true_lang-DS3K1WjJ.js";import{_ as $e}from"./Input.vue_vue_type_script_setup_true_lang-B7F0P19X.js";import{_ as B}from"./Label.vue_vue_type_script_setup_true_lang-B0_ysysQ.js";import{C as Re,I as De}from"./vue-qrcode-reader-VKk38FVR.js";import{C as se}from"./circle-check-big-C21okGWW.js";import{C as ae}from"./circle-x-Chpyzb7n.js";import{C as U}from"./circle-alert-CtovYjxa.js";import{Q as le}from"./qr-code-Bs10IxCn.js";import{C as Pe}from"./clock-BndlhL6d.js";import"./useForwardExpose-Dn3oH0KL.js";import"./users-CgcVcNzr.js";import"./RovingFocusGroup-BlJuKAAH.js";import"./check-DxhJGc9p.js";const Ee={class:"flex h-full flex-1 flex-col gap-6 p-6"},Ne={class:"text-3xl font-bold"},je={class:"text-blue-600"},Qe={class:"text-muted-foreground"},qe={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},Ae={class:"text-2xl font-bold text-green-600"},Te={class:"text-xs text-muted-foreground"},Ve={class:"text-2xl font-bold text-red-600"},Fe={class:"text-xs text-muted-foreground"},Ie={class:"text-2xl font-bold text-yellow-600"},ze={class:"text-xs text-muted-foreground"},Ye={class:"grid gap-4 md:grid-cols-2"},Be={class:"bg-white dark:bg-gray-800 rounded-md p-3 font-mono text-sm border"},Ue={class:"space-y-3"},Me={key:0},Le={class:"space-y-1"},Oe={class:"font-medium"},Xe={class:"text-sm text-muted-foreground"},He={class:"text-sm text-muted-foreground"},Je={class:"text-right"},We={class:"text-sm font-medium"},Ke={class:"text-xs text-muted-foreground"},Ge={key:1,class:"text-center py-6 text-muted-foreground"},Ze={class:"space-y-3"},et={class:"flex items-center space-x-3"},tt={class:"font-medium"},st={class:"text-sm text-muted-foreground"},at={class:"space-y-4"},lt={class:"space-y-2"},ot={key:0,class:"p-3 bg-yellow-100 border border-yellow-400 rounded text-sm"},nt={key:1,class:"border rounded-lg overflow-hidden bg-muted/50"},rt={class:"relative aspect-square bg-black"},ut={key:1,class:"absolute inset-0 flex items-center justify-center bg-black/50 text-white text-center p-4"},dt={class:"text-sm"},it={key:2,class:"absolute inset-0 flex items-center justify-center bg-black/50 text-white"},ct={key:2,class:"text-center py-8 text-muted-foreground"},mt={class:"space-y-4"},ft={class:"space-y-2"},_t={class:"space-y-2"},At=be({__name:"Dashboard",props:{student:{},stats:{},classes:{},upcomingClasses:{},recentRequests:{},recentAttendance:{}},setup(oe){const f=oe,ne=Ce(),re=D(()=>ne.props.auth.user),ue=[{title:"Dashboard",href:"/student/dashboard"}],$=g(!1),j=g(!1),i=g(""),w=g(""),Q=g("off"),h=g(""),p=g(!1),_=D(()=>{const n=f.stats;if(console.log("Computing attendance stats with:",n),!n)return{presentPercentage:0,absentPercentage:0,excusedPercentage:0,totalClasses:0,presentCount:0,absentCount:0,excusedCount:0};const e=n.totalAttendance||0,l=Math.max(0,e-(n.presentCount||0));let m=n.attendanceRate||0,v=0;e>0&&(v=Math.round(l/e*100)),m=isNaN(m)?0:m,v=isNaN(v)?0:v;const R={presentPercentage:m,absentPercentage:v,excusedPercentage:0,totalClasses:n.totalClasses||0,presentCount:n.presentCount||0,absentCount:l,excusedCount:0};return console.log("Computed attendance stats:",R),R}),M=D(()=>f.upcomingClasses||[]),de=D(()=>f.recentAttendance??[]),k=D(()=>f.classes||[]),ie=()=>{if(k.value.length===0){alert("You are not enrolled in any classes.");return}$.value=!0,Q.value="auto",h.value=""};ye($,n=>{n||(Q.value="off",i.value="",h.value="")});const ce=n=>{console.error("Camera error:",n),h.value="Unable to access camera. Please check permissions."},me=n=>{if(n.length>0){const e=n[0].rawValue;_e(e)}},fe=()=>{if(k.value.length===0){alert("You are not enrolled in any classes.");return}j.value=!0},_e=async n=>{if(!i.value){alert("Please select a class first.");return}p.value=!0;try{const e=n.trim().split(",").map(q=>q.trim());if(e.length<2)throw new Error('Invalid QR code format. Expected: "Name,Course"');const l=e[0],m=e[1];if(!f.student)throw new Error("Student information not available");const v=f.student.name.toLowerCase().replace(/\s+/g," ").trim(),R=l.toLowerCase().replace(/\s+/g," ").trim();if(!(v.includes(R)||R.includes(v)))throw new Error(`QR code name "${l}" does not match your profile name "${f.student.name}"`);const V=(f.student.course||"").toLowerCase().replace(/\s+/g,""),L=m.toLowerCase().replace(/\s+/g,"");if(V&&!V.includes(L.replace("bs",""))&&!L.includes(V.replace("bachelor","").replace("science","")))throw new Error(`QR code course "${m}" does not match your profile course "${f.student.course}"`);const F=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!F)throw new Error("CSRF token not found. Please refresh the page.");console.log("QR Data verified - Name:",l,"Course:",m),console.log("Marking attendance for class:",i.value);const S=await fetch("/student/self-checkin",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":F,"X-Requested-With":"XMLHttpRequest",Authorization:`Bearer ${F}`},credentials:"same-origin",body:JSON.stringify({class_id:i.value,name:l,course:m})});if(console.log("Response status:",S.status),console.log("Response headers:",Object.fromEntries(S.headers.entries())),!S.ok){const q=await S.json().catch(()=>({message:"Failed to mark attendance"}));throw console.error("Error response:",q),new Error(q.message||`HTTP error! status: ${S.status}`)}const I=await S.json();console.log("Success response:",I),I.success?(alert("Success! You have been marked as present."),$.value=!1,i.value="",O.reload()):alert(I.message||"Failed to mark attendance")}catch(e){console.error("Check-in error:",e),h.value=e.message||"Failed to process check-in. Please try again."}finally{p.value=!1}},pe=async()=>{if(!i.value){alert("Please select a class.");return}if(!w.value){alert("Please enter a session ID.");return}p.value=!0;try{const n=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!n)throw new Error("CSRF token not found");const e=await fetch("/student/quick-checkin",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":n,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({method:"manual",qr_code:w.value,class_id:i.value})});if(!e.ok){const m=await e.json().catch(()=>({message:"Failed to mark attendance"}));throw new Error(m.message||`HTTP error! status: ${e.status}`)}const l=await e.json();l.success?(alert(`Success! ${l.message}`),j.value=!1,i.value="",w.value="",O.reload()):alert(l.message||"Failed to mark attendance")}catch(n){console.error("Check-in error:",n),alert(n.message||"Failed to process check-in. Please try again.")}finally{p.value=!1}},ve=n=>{switch(n){case"present":return"bg-green-500";case"absent":return"bg-red-500";case"excused":return"bg-yellow-500";default:return"bg-gray-500"}},ge=n=>{switch(n){case"present":return se;case"absent":return ae;case"excused":return U;default:return Pe}};return(n,e)=>(d(),c(P,null,[s(t(we),{title:"Student Dashboard"}),s(xe,{breadcrumbs:ue},{default:a(()=>[o("div",Ee,[o("div",null,[o("h1",Ne,[e[5]||(e[5]=r("Welcome back, ",-1)),o("span",je,u(f.student?.name||re.value.name),1),e[6]||(e[6]=r(" ðŸŽ“",-1))]),o("p",Qe," Student ID: "+u(f.student?.student_id||"Not available")+" â€¢ Course: "+u(f.student?.course||"Not specified"),1),e[7]||(e[7]=o("p",{class:"text-sm text-muted-foreground mt-1"},"Here's your attendance overview and upcoming classes",-1))]),o("div",qe,[s(t(x),null,{default:a(()=>[s(t(b),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(C),{class:"text-sm font-medium"},{default:a(()=>e[8]||(e[8]=[r("Present %",-1)])),_:1,__:[8]}),s(t(se),{class:"h-4 w-4 text-green-600"})]),_:1}),s(t(y),null,{default:a(()=>[o("div",Ae,u(_.value.presentPercentage)+"%",1),o("p",Te,u(_.value.presentCount)+" of "+u(_.value.totalClasses)+" sessions",1)]),_:1})]),_:1}),s(t(x),null,{default:a(()=>[s(t(b),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(C),{class:"text-sm font-medium"},{default:a(()=>e[9]||(e[9]=[r("Absent %",-1)])),_:1,__:[9]}),s(t(ae),{class:"h-4 w-4 text-red-600"})]),_:1}),s(t(y),null,{default:a(()=>[o("div",Ve,u(_.value.absentPercentage)+"%",1),o("p",Fe,u(_.value.absentCount)+" of "+u(_.value.totalClasses)+" sessions",1)]),_:1})]),_:1}),s(t(x),null,{default:a(()=>[s(t(b),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(C),{class:"text-sm font-medium"},{default:a(()=>e[10]||(e[10]=[r("Excused %",-1)])),_:1,__:[10]}),s(t(U),{class:"h-4 w-4 text-yellow-600"})]),_:1}),s(t(y),null,{default:a(()=>[o("div",Ie,u(_.value.excusedPercentage)+"%",1),o("p",ze,u(_.value.excusedCount)+" of "+u(_.value.totalClasses)+" sessions",1)]),_:1})]),_:1})]),o("div",Ye,[s(t(x),{class:"border-blue-200 bg-blue-50 dark:bg-blue-950/20"},{default:a(()=>[s(t(b),null,{default:a(()=>[s(t(C),{class:"text-blue-900 dark:text-blue-100"},{default:a(()=>e[11]||(e[11]=[r("Your QR Code Format",-1)])),_:1,__:[11]}),s(t(T),{class:"text-blue-700 dark:text-blue-300"},{default:a(()=>e[12]||(e[12]=[r(" Generate a QR code with this exact text to use for self check-in ",-1)])),_:1,__:[12]})]),_:1}),s(t(y),null,{default:a(()=>[o("div",Be,u(n.student?.name||"Your Name")+","+u(n.student?.course||"Your Course"),1),e[13]||(e[13]=o("p",{class:"text-xs text-blue-600 dark:text-blue-400 mt-2"},' Example: "Juan Dela Cruz,BSCS" or "Maria Santos,BSIT" ',-1))]),_:1,__:[13]})]),_:1}),s(t(x),null,{default:a(()=>[s(t(b),null,{default:a(()=>[s(t(C),null,{default:a(()=>e[14]||(e[14]=[r("Self Check-In",-1)])),_:1,__:[14]}),s(t(T),null,{default:a(()=>e[15]||(e[15]=[r("Use your personal QR code (name,course format) to mark attendance",-1)])),_:1,__:[15]})]),_:1}),s(t(y),{class:"space-y-4"},{default:a(()=>[s(t(z),{onClick:ie,class:"w-full",size:"lg"},{default:a(()=>[s(t(le),{class:"mr-2 h-5 w-5"}),e[16]||(e[16]=r(" Scan Your QR Code ",-1))]),_:1,__:[16]}),e[18]||(e[18]=o("div",{class:"text-center text-sm text-muted-foreground"}," or ",-1)),s(t(z),{onClick:fe,variant:"outline",class:"w-full",size:"lg"},{default:a(()=>[s(t(Re),{class:"mr-2 h-5 w-5"}),e[17]||(e[17]=r(" Enter Session ID ",-1))]),_:1,__:[17]})]),_:1,__:[18]})]),_:1}),s(t(x),null,{default:a(()=>[s(t(b),null,{default:a(()=>[s(t(C),null,{default:a(()=>e[19]||(e[19]=[r("Upcoming Classes",-1)])),_:1,__:[19]}),s(t(T),null,{default:a(()=>e[20]||(e[20]=[r("Your schedule for today and tomorrow",-1)])),_:1,__:[20]})]),_:1}),s(t(y),null,{default:a(()=>[o("div",Ue,[M.value.length>0?(d(),c("div",Me,[(d(!0),c(P,null,A(M.value.slice(0,4),l=>(d(),c("div",{key:l.class_name,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors"},[o("div",Le,[o("p",Oe,u(l.class_name),1),o("p",Xe,u(l.teacher),1),o("p",He,"Room "+u(l.room),1)]),o("div",Je,[o("p",We,u(l.time),1),o("p",Ke,u(l.date),1)])]))),128))])):(d(),c("div",Ge,e[21]||(e[21]=[o("p",null,"No upcoming classes scheduled",-1)])))])]),_:1})]),_:1})]),s(t(x),null,{default:a(()=>[s(t(b),null,{default:a(()=>[s(t(C),null,{default:a(()=>e[22]||(e[22]=[r("Recent Attendance",-1)])),_:1,__:[22]}),s(t(T),null,{default:a(()=>e[23]||(e[23]=[r("Your recent attendance history",-1)])),_:1,__:[23]})]),_:1}),s(t(y),null,{default:a(()=>[o("div",Ze,[(d(!0),c(P,null,A(de.value,(l,m)=>(d(),c("div",{key:m,class:"flex items-center justify-between p-3 border rounded-lg"},[o("div",et,[o("div",{class:he(["w-2 h-2 rounded-full",ve(l.status)])},null,2),o("div",null,[o("p",tt,u(l.class_name),1),o("p",st,u(l.session_date),1)])]),s(t(Se),{variant:l.status==="present"?"default":l.status==="excused"?"secondary":"destructive"},{default:a(()=>[(d(),E(ke(ge(l.status)),{class:"w-3 h-3 mr-1"})),r(" "+u(l.status.charAt(0).toUpperCase()+l.status.slice(1)),1)]),_:2},1032,["variant"])]))),128))])]),_:1})]),_:1})]),s(t(X),{open:$.value,"onUpdate:open":e[1]||(e[1]=l=>$.value=l)},{default:a(()=>[s(t(H),{class:"sm:max-w-md"},{default:a(()=>[s(t(J),null,{default:a(()=>[s(t(W),null,{default:a(()=>e[24]||(e[24]=[r("Self Check-in with Your QR Code",-1)])),_:1,__:[24]}),s(t(K),null,{default:a(()=>e[25]||(e[25]=[r(' Select your class, then scan your personal QR code containing your name and course (e.g., "Juan Dela Cruz,BSCS") ',-1)])),_:1,__:[25]})]),_:1}),o("div",at,[o("div",lt,[s(t(B),{for:"qr-class"},{default:a(()=>e[26]||(e[26]=[r("Select Class",-1)])),_:1,__:[26]}),s(t(G),{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value=l)},{default:a(()=>[s(t(Z),{id:"qr-class"},{default:a(()=>[s(t(ee),{placeholder:"Choose a class"})]),_:1}),s(t(te),null,{default:a(()=>[k.value.length===0?(d(),E(t(Y),{key:0,value:"",disabled:""},{default:a(()=>e[27]||(e[27]=[r(" No enrolled classes found ",-1)])),_:1,__:[27]})):N("",!0),(d(!0),c(P,null,A(k.value,l=>(d(),E(t(Y),{key:l.id,value:String(l.id)},{default:a(()=>[r(u(l.display_name||`${l.name} - ${l.course} ${l.section}`),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),k.value.length===0?(d(),c("div",ot,e[28]||(e[28]=[o("p",{class:"font-medium text-yellow-800"},"No enrolled classes found",-1),o("p",{class:"text-yellow-700"},"Please contact your teacher to be enrolled in a class.",-1)]))):N("",!0),i.value?(d(),c("div",nt,[e[30]||(e[30]=o("p",{class:"text-sm text-center p-2"},"Scan your personal QR code with your name and course",-1)),o("div",rt,[Q.value==="auto"?(d(),E(t(De),{key:0,camera:Q.value,onDetect:me,onError:ce,class:"w-full h-full object-cover"},null,8,["camera"])):N("",!0),h.value?(d(),c("div",ut,[o("div",null,[s(t(U),{class:"h-8 w-8 mx-auto mb-2"}),o("p",dt,u(h.value),1)])])):N("",!0),p.value?(d(),c("div",it,e[29]||(e[29]=[o("div",{class:"text-center"},[o("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),o("p",{class:"text-sm"},"Processing...")],-1)]))):N("",!0)])])):(d(),c("div",ct,[s(t(le),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),e[31]||(e[31]=o("p",null,"Select a class to start scanning",-1))]))])]),_:1})]),_:1},8,["open"]),s(t(X),{open:j.value,"onUpdate:open":e[4]||(e[4]=l=>j.value=l)},{default:a(()=>[s(t(H),{class:"sm:max-w-md"},{default:a(()=>[s(t(J),null,{default:a(()=>[s(t(W),null,{default:a(()=>e[32]||(e[32]=[r("Enter Session ID",-1)])),_:1,__:[32]}),s(t(K),null,{default:a(()=>e[33]||(e[33]=[r(" Select your class and enter the session ID provided by your teacher ",-1)])),_:1,__:[33]})]),_:1}),o("div",mt,[o("div",ft,[s(t(B),{for:"manual-class"},{default:a(()=>e[34]||(e[34]=[r("Select Class",-1)])),_:1,__:[34]}),s(t(G),{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value=l)},{default:a(()=>[s(t(Z),{id:"manual-class"},{default:a(()=>[s(t(ee),{placeholder:"Choose a class"})]),_:1}),s(t(te),null,{default:a(()=>[(d(!0),c(P,null,A(k.value,l=>(d(),E(t(Y),{key:l.id,value:String(l.id)},{default:a(()=>[r(u(l.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),o("div",_t,[s(t(B),{for:"session-id"},{default:a(()=>e[35]||(e[35]=[r("Session ID",-1)])),_:1,__:[35]}),s(t($e),{id:"session-id",modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=l=>w.value=l),type:"text",placeholder:"Enter session ID",disabled:!i.value||p.value},null,8,["modelValue","disabled"])]),s(t(z),{onClick:pe,class:"w-full",disabled:!i.value||!w.value||p.value},{default:a(()=>[r(u(p.value?"Processing...":"Submit Attendance"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{At as default};
