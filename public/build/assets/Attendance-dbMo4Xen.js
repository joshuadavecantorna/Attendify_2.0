import{S as ee,_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-CQKvJ_Ct.js";import{d as se,r as V,u as R,a as m,o as r,b as a,e as t,h as ne,w as l,f as n,i as d,t as i,F as S,g as j,j as x,k as c,m as v}from"./app-OXmU166Q.js";import{_ as g,b as y,c as b,a as k,d as Q}from"./CardTitle.vue_vue_type_script_setup_true_lang-FXh4yG6b.js";import{_}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CGIYOqcj.js";import{_ as F}from"./index-DpPOakUB.js";import{_ as E,a as N,b as D,c as T,d as M}from"./DialogTitle.vue_vue_type_script_setup_true_lang-6XzyZbOz.js";import{_ as z}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CqT1EXV_.js";import{_ as ae}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-evMMIE2_.js";import{_ as U}from"./Label.vue_vue_type_script_setup_true_lang-B0_ysysQ.js";import{_ as q}from"./Input.vue_vue_type_script_setup_true_lang-B7F0P19X.js";import{_ as le,a as oe,b as de,c as ie,d as ue}from"./SelectValue.vue_vue_type_script_setup_true_lang-DS3K1WjJ.js";import{P as re}from"./plus-CsFhKTFd.js";import{C as Y}from"./clock-BndlhL6d.js";import{U as fe}from"./users-CgcVcNzr.js";import"./useForwardExpose-Dn3oH0KL.js";import"./RovingFocusGroup-BlJuKAAH.js";import"./check-DxhJGc9p.js";const me={class:"container mx-auto p-6 space-y-6"},_e={class:"grid gap-4 md:grid-cols-4"},ce={class:"text-2xl font-bold"},ve={class:"text-2xl font-bold"},pe={class:"text-2xl font-bold"},xe={class:"text-2xl font-bold"},ge={class:"flex items-center justify-between"},ye={class:"grid gap-4 py-4"},be={class:"grid gap-2"},ke={class:"grid gap-2"},we={class:"grid gap-2"},Se={class:"grid gap-2"},Ce={class:"grid gap-4 md:grid-cols-2"},$e={class:"flex items-center justify-between"},Ae={class:"font-medium"},Ve={class:"text-sm text-muted-foreground"},je={class:"text-xs text-muted-foreground mt-1"},Fe={class:"space-y-4"},Ue={class:"flex items-center gap-3"},Ee={class:"font-medium"},Ne={class:"text-sm text-muted-foreground"},De={class:"flex items-center gap-2"},Te={class:"text-sm text-muted-foreground"},Me={key:0,class:"text-center py-8 text-muted-foreground"},ze={class:"text-center py-4"},qe={class:"py-4"},Le={class:"space-y-4"},Be={class:"flex items-center justify-between"},Pe={class:"flex gap-2"},Re={key:0,class:"text-center py-8 text-muted-foreground"},Qe={class:"mt-6 space-y-3"},Ye={key:0},Ge={class:"flex justify-center gap-2"},Ie={key:1},he={key:1,class:"space-y-2 max-h-60 overflow-y-auto"},He={class:"flex items-center gap-3"},Je={class:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-sm font-medium"},Ke={class:"font-medium"},Oe={class:"text-sm text-muted-foreground"},We={class:"flex items-center gap-2"},Xe=["value","onChange"],Ze={key:2,class:"border-t pt-4"},et={class:"grid grid-cols-4 gap-4 text-center"},tt={class:"text-lg font-semibold text-green-600"},st={class:"text-lg font-semibold text-yellow-600"},nt={class:"text-lg font-semibold text-red-600"},at={class:"text-lg font-semibold text-blue-600"},lt={class:"flex justify-between w-full"},ot={class:"flex gap-2"},Ct=se({__name:"Attendance",props:{teacher:{},classes:{},recent_sessions:{}},setup(G){const C=G,I=[{title:"Teacher Dashboard",href:"/teacher/dashboard"},{title:"Attendance",href:"/teacher/attendance"}],$=V(!1),p=V(!1),A=V(!1),o=V(null),f=R({class_id:"",session_name:"",duration:60,location_required:!1,qr_enabled:!0,notes:""});R({attendance_records:[]});const h=()=>{f.post("/teacher/attendance/sessions",{onSuccess:()=>{$.value=!1,f.reset()}})},H=async u=>{try{f.processing=!0,v.post("/teacher/attendance/quick-start",{class_id:u},{onSuccess:()=>{console.log("Quick session started successfully"),f.processing=!1},onError:e=>{console.error("Error starting quick session:",e),alert("Failed to start session: "+(e.message||"Unknown error")),f.processing=!1},preserveScroll:!0,preserveState:!1})}catch(e){console.error("Error starting quick session:",e),alert(e instanceof Error?e.message:"Failed to start session"),f.processing=!1}},L=async u=>{o.value=u;try{const e=await fetch(`/teacher/attendance/sessions/${u.id}`);if(e.ok){const s=await e.json();o.value={...u,attendance_records:s.attendance_records||[],students:s.students||[]}}}catch(e){console.error("Failed to load session data:",e)}p.value=!0},J=()=>{A.value=!0},B=()=>{if(!o.value)return;const e=`Are you sure you want to delete the attendance session "${o.value.class_name}"?

This action cannot be undone and will remove all attendance records for this session.`;confirm(e)&&v.delete(`/teacher/attendance/sessions/${o.value.id}`,{onSuccess:()=>{p.value=!1,o.value=null,v.reload()},onError:s=>{console.error("Failed to delete session:",s),alert("Failed to delete session: "+(s.message||"Unknown error"))}})},K=(u,e)=>{o.value&&v.post(`/teacher/attendance/${o.value.id}/mark`,{student_id:u,status:e,method:"manual"},{onSuccess:()=>{L(o.value)},onError:s=>{console.error("Failed to mark attendance:",s),alert("Failed to update attendance: "+(s.message||"Unknown error"))},preserveState:!0})},O=u=>{const e=u?.student?.name||u?.name;if(!e)return"??";const s=e.split(" ");return s.length>1?`${s[0][0]}${s[s.length-1][0]}`:s[0][0]+s[0][1]||s[0][0]},W=u=>{switch(u){case"present":return"default";case"late":return"secondary";case"absent":return"destructive";case"excused":return"outline";default:return"secondary"}},P=()=>{o.value&&v.visit(`/teacher/attendance/session/${o.value.id}`)},X=()=>{o.value&&confirm("Are you sure you want to end this attendance session?")&&v.put(`/teacher/attendance/sessions/${o.value.id}/end`,{},{onSuccess:()=>{p.value=!1,o.value=null,v.reload()},onError:u=>{console.error("Failed to end session:",u),alert("Failed to end session: "+(u.message||"Unknown error"))}})},Z=()=>{o.value&&window.open(`/teacher/attendance/sessions/${o.value.id}/export`,"_blank")};return(u,e)=>(r(),m(S,null,[a(t(ne),{title:"Teacher Attendance"}),a(te,{breadcrumbs:I},{default:l(()=>[n("div",me,[e[39]||(e[39]=n("div",{class:"space-y-2"},[n("h1",{class:"text-3xl font-bold tracking-tight"},"Attendance Management"),n("p",{class:"text-muted-foreground"}," Manage attendance sessions for your classes ")],-1)),n("div",_e,[a(t(g),null,{default:l(()=>[a(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(t(b),{class:"text-sm font-medium"},{default:l(()=>e[10]||(e[10]=[d("Total Classes",-1)])),_:1,__:[10]}),e[11]||(e[11]=n("span",{class:"text-xl"},"ðŸ“š",-1))]),_:1,__:[11]}),a(t(k),null,{default:l(()=>[n("div",ce,i(u.classes.length),1),e[12]||(e[12]=n("p",{class:"text-xs text-muted-foreground mt-1"}," Active classes ",-1))]),_:1,__:[12]})]),_:1}),a(t(g),null,{default:l(()=>[a(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(t(b),{class:"text-sm font-medium"},{default:l(()=>e[13]||(e[13]=[d("Recent Sessions",-1)])),_:1,__:[13]}),e[14]||(e[14]=n("span",{class:"text-xl"},"ðŸ“…",-1))]),_:1,__:[14]}),a(t(k),null,{default:l(()=>[n("div",ve,i(u.recent_sessions.length),1),e[15]||(e[15]=n("p",{class:"text-xs text-muted-foreground mt-1"}," Last 10 sessions ",-1))]),_:1,__:[15]})]),_:1}),a(t(g),null,{default:l(()=>[a(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(t(b),{class:"text-sm font-medium"},{default:l(()=>e[16]||(e[16]=[d("Total Students",-1)])),_:1,__:[16]}),e[17]||(e[17]=n("span",{class:"text-xl"},"ðŸ‘¥",-1))]),_:1,__:[17]}),a(t(k),null,{default:l(()=>[n("div",pe,i(u.classes.reduce((s,w)=>s+w.student_count,0)),1),e[18]||(e[18]=n("p",{class:"text-xs text-muted-foreground mt-1"}," Across all classes ",-1))]),_:1,__:[18]})]),_:1}),a(t(g),null,{default:l(()=>[a(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:l(()=>[a(t(b),{class:"text-sm font-medium"},{default:l(()=>e[19]||(e[19]=[d("Active Sessions",-1)])),_:1,__:[19]}),e[20]||(e[20]=n("span",{class:"text-xl"},"ðŸŸ¢",-1))]),_:1,__:[20]}),a(t(k),null,{default:l(()=>[n("div",xe,i(u.recent_sessions.filter(s=>s.status==="active").length),1),e[21]||(e[21]=n("p",{class:"text-xs text-muted-foreground mt-1"}," Currently active ",-1))]),_:1,__:[21]})]),_:1})]),a(t(g),null,{default:l(()=>[a(t(y),null,{default:l(()=>[n("div",ge,[n("div",null,[a(t(b),{class:"flex items-center gap-2"},{default:l(()=>[a(t(ee),{class:"h-5 w-5"}),e[22]||(e[22]=d(" Attendance Sessions ",-1))]),_:1,__:[22]}),a(t(Q),null,{default:l(()=>e[23]||(e[23]=[d("Create and manage attendance sessions for your classes",-1)])),_:1,__:[23]})]),a(t(E),{open:$.value,"onUpdate:open":e[5]||(e[5]=s=>$.value=s)},{default:l(()=>[a(t(ae),{"as-child":""},{default:l(()=>[a(t(_),{class:"flex items-center gap-2"},{default:l(()=>[a(t(re),{class:"h-4 w-4"}),e[24]||(e[24]=d(" New Session ",-1))]),_:1,__:[24]})]),_:1}),a(t(N),{class:"sm:max-w-[500px]"},{default:l(()=>[a(t(D),null,{default:l(()=>[a(t(T),null,{default:l(()=>e[25]||(e[25]=[d("Create Attendance Session",-1)])),_:1,__:[25]}),a(t(M),null,{default:l(()=>e[26]||(e[26]=[d("Set up a new attendance session for one of your classes.",-1)])),_:1,__:[26]})]),_:1}),n("div",ye,[n("div",be,[a(t(U),{for:"class"},{default:l(()=>e[27]||(e[27]=[d("Select Class",-1)])),_:1,__:[27]}),a(t(le),{modelValue:t(f).class_id,"onUpdate:modelValue":e[0]||(e[0]=s=>t(f).class_id=s)},{default:l(()=>[a(t(oe),null,{default:l(()=>[a(t(de),{placeholder:"Choose a class"})]),_:1}),a(t(ie),null,{default:l(()=>[(r(!0),m(S,null,j(C.classes,s=>(r(),x(t(ue),{key:s.id,value:s.id.toString()},{default:l(()=>[d(i(s.course_code)+" - "+i(s.class_name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),n("div",ke,[a(t(U),{for:"session_name"},{default:l(()=>e[28]||(e[28]=[d("Session Name",-1)])),_:1,__:[28]}),a(t(q),{id:"session_name",modelValue:t(f).session_name,"onUpdate:modelValue":e[1]||(e[1]=s=>t(f).session_name=s),placeholder:"e.g., Midterm Attendance"},null,8,["modelValue"])]),n("div",we,[a(t(U),{for:"duration"},{default:l(()=>e[29]||(e[29]=[d("Duration (minutes)",-1)])),_:1,__:[29]}),a(t(q),{id:"duration",type:"number",modelValue:t(f).duration,"onUpdate:modelValue":e[2]||(e[2]=s=>t(f).duration=s),min:"5",max:"240"},null,8,["modelValue"])]),n("div",Se,[a(t(U),{for:"notes"},{default:l(()=>e[30]||(e[30]=[d("Notes (optional)",-1)])),_:1,__:[30]}),a(t(q),{id:"notes",modelValue:t(f).notes,"onUpdate:modelValue":e[3]||(e[3]=s=>t(f).notes=s),placeholder:"Any additional notes..."},null,8,["modelValue"])])]),a(t(z),null,{default:l(()=>[a(t(_),{variant:"outline",onClick:e[4]||(e[4]=s=>$.value=!1)},{default:l(()=>e[31]||(e[31]=[d("Cancel",-1)])),_:1,__:[31]}),a(t(_),{onClick:h,disabled:t(f).processing},{default:l(()=>[d(i(t(f).processing?"Creating...":"Create Session"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1}),a(t(k),null,{default:l(()=>[n("div",Ce,[(r(!0),m(S,null,j(C.classes,s=>(r(),m("div",{key:s.id,class:"border rounded-lg p-4"},[n("div",$e,[n("div",null,[n("h3",Ae,i(s.course_code),1),n("p",Ve,i(s.class_name),1),n("p",je,i(s.student_count)+" students",1)]),a(t(_),{size:"sm",onClick:w=>H(s.id)},{default:l(()=>e[32]||(e[32]=[d(" Quick Start ",-1)])),_:2,__:[32]},1032,["onClick"])])]))),128))])]),_:1})]),_:1}),a(t(g),null,{default:l(()=>[a(t(y),null,{default:l(()=>[a(t(b),null,{default:l(()=>e[33]||(e[33]=[d("Recent Attendance Sessions",-1)])),_:1,__:[33]}),a(t(Q),null,{default:l(()=>e[34]||(e[34]=[d("Your latest attendance activities",-1)])),_:1,__:[34]})]),_:1}),a(t(k),null,{default:l(()=>[n("div",Fe,[(r(!0),m(S,null,j(C.recent_sessions,s=>(r(),m("div",{key:s.id,class:"flex items-center justify-between p-4 border rounded-lg"},[n("div",Ue,[a(t(F),{variant:"secondary"},{default:l(()=>[d(i(s.course_code),1)]),_:2},1024),n("div",null,[n("p",Ee,i(s.class_name),1),n("p",Ne,i(s.date)+" at "+i(s.time),1)])]),n("div",De,[n("span",Te,i(s.present_count)+"/"+i(s.total_count)+" students",1),a(t(F),{variant:s.status==="completed"?"default":"secondary"},{default:l(()=>[d(i(s.status),1)]),_:2},1032,["variant"]),a(t(_),{size:"sm",variant:"outline",onClick:w=>L(s)},{default:l(()=>e[35]||(e[35]=[d(" Manage ",-1)])),_:2,__:[35]},1032,["onClick"])])]))),128)),C.recent_sessions.length===0?(r(),m("div",Me,[a(t(Y),{class:"h-12 w-12 mx-auto mb-4 opacity-50"}),e[36]||(e[36]=n("p",null,"No recent attendance sessions",-1)),e[37]||(e[37]=n("p",{class:"text-sm"},"Create your first session to get started",-1))])):c("",!0),n("div",ze,[a(t(_),{variant:"outline",onClick:J},{default:l(()=>e[38]||(e[38]=[d(" View All Sessions ",-1)])),_:1,__:[38]})])])]),_:1})]),_:1})]),a(t(E),{open:p.value,"onUpdate:open":e[7]||(e[7]=s=>p.value=s)},{default:l(()=>[a(t(N),{class:"sm:max-w-[600px]"},{default:l(()=>[a(t(D),null,{default:l(()=>[o.value?(r(),x(t(T),{key:0},{default:l(()=>[d("Manage: "+i(o.value.class_name),1)]),_:1})):c("",!0),o.value?(r(),x(t(M),{key:1},{default:l(()=>[d(i(o.value.date)+" at "+i(o.value.time)+" - "+i(o.value.present_count)+"/"+i(o.value.total_count)+" students present ",1)]),_:1})):c("",!0)]),_:1}),n("div",qe,[n("div",Le,[n("div",Be,[e[41]||(e[41]=n("h4",{class:"font-medium"},"Attendance Records",-1)),n("div",Pe,[o.value?(r(),x(t(_),{key:0,size:"sm",variant:"outline",onClick:Z},{default:l(()=>e[40]||(e[40]=[d(" Export Report ",-1)])),_:1,__:[40]})):c("",!0),a(t(F),{variant:o.value?.status==="active"?"default":"secondary"},{default:l(()=>[d(i(o.value?.status||"Unknown"),1)]),_:1},8,["variant"])])]),!o.value?.attendance_records||o.value.attendance_records.length===0?(r(),m("div",Re,[a(t(fe),{class:"h-12 w-12 mx-auto mb-4 opacity-50"}),e[47]||(e[47]=n("p",{class:"font-medium"},"No attendance records found",-1)),e[48]||(e[48]=n("p",{class:"text-sm"},"No students have been marked for this session yet.",-1)),n("div",Qe,[o.value?.status==="active"?(r(),m("div",Ye,[e[44]||(e[44]=n("p",{class:"text-sm text-blue-600 mb-2"},"This session is still active. You can:",-1)),n("div",Ge,[a(t(_),{onClick:P,size:"sm"},{default:l(()=>e[42]||(e[42]=[d(" Manage Session ",-1)])),_:1,__:[42]}),a(t(_),{onClick:X,variant:"outline",size:"sm"},{default:l(()=>e[43]||(e[43]=[d(" End Session ",-1)])),_:1,__:[43]})])])):(r(),m("div",Ie,[e[46]||(e[46]=n("p",{class:"text-sm text-orange-600 mb-2"},"This completed session has no records.",-1)),a(t(_),{onClick:B,variant:"destructive",size:"sm"},{default:l(()=>e[45]||(e[45]=[d(" Delete Empty Session ",-1)])),_:1,__:[45]})]))])])):(r(),m("div",he,[(r(!0),m(S,null,j(o.value.attendance_records,s=>(r(),m("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg"},[n("div",He,[n("div",Je,i(O(s)),1),n("div",null,[n("p",Ke,i(s.student?.name||s.name),1),n("p",Oe,i(s.student?.student_id||s.student_id),1)])]),n("div",We,[a(t(F),{variant:W(s.status)},{default:l(()=>[d(i(s.status),1)]),_:2},1032,["variant"]),n("select",{value:s.status,onChange:w=>K(s.student?.student_id||s.student_id,w.target.value),class:"text-sm border rounded px-2 py-1"},e[49]||(e[49]=[n("option",{value:"present"},"Present",-1),n("option",{value:"absent"},"Absent",-1),n("option",{value:"late"},"Late",-1),n("option",{value:"excused"},"Excused",-1)]),40,Xe)])]))),128))])),o.value?.attendance_records&&o.value.attendance_records.length>0?(r(),m("div",Ze,[n("div",et,[n("div",null,[n("div",tt,i(o.value.attendance_records.filter(s=>s.status==="present").length),1),e[50]||(e[50]=n("div",{class:"text-xs text-muted-foreground"},"Present",-1))]),n("div",null,[n("div",st,i(o.value.attendance_records.filter(s=>s.status==="late").length),1),e[51]||(e[51]=n("div",{class:"text-xs text-muted-foreground"},"Late",-1))]),n("div",null,[n("div",nt,i(o.value.attendance_records.filter(s=>s.status==="absent").length),1),e[52]||(e[52]=n("div",{class:"text-xs text-muted-foreground"},"Absent",-1))]),n("div",null,[n("div",at,i(o.value.attendance_records.filter(s=>s.status==="excused").length),1),e[53]||(e[53]=n("div",{class:"text-xs text-muted-foreground"},"Excused",-1))])])])):c("",!0)])]),a(t(z),null,{default:l(()=>[n("div",lt,[o.value?(r(),x(t(_),{key:0,variant:"destructive",onClick:B,size:"sm"},{default:l(()=>e[54]||(e[54]=[d(" Delete Session ",-1)])),_:1,__:[54]})):c("",!0),n("div",ot,[a(t(_),{variant:"outline",onClick:e[6]||(e[6]=s=>p.value=!1)},{default:l(()=>e[55]||(e[55]=[d("Close",-1)])),_:1,__:[55]}),o.value?.status==="active"?(r(),x(t(_),{key:0,onClick:P},{default:l(()=>e[56]||(e[56]=[d(" Manage Live Session ",-1)])),_:1,__:[56]})):c("",!0)])])]),_:1})]),_:1})]),_:1},8,["open"]),a(t(E),{open:A.value,"onUpdate:open":e[9]||(e[9]=s=>A.value=s)},{default:l(()=>[a(t(N),{class:"sm:max-w-[400px]"},{default:l(()=>[a(t(D),null,{default:l(()=>[a(t(T),{class:"flex items-center gap-2"},{default:l(()=>[a(t(Y),{class:"h-5 w-5 text-blue-500"}),e[57]||(e[57]=d(" Coming Soon ",-1))]),_:1,__:[57]}),a(t(M),null,{default:l(()=>e[58]||(e[58]=[d(' The "View All Sessions" feature is currently under development and will be available in a future update. ',-1)])),_:1,__:[58]})]),_:1}),a(t(z),null,{default:l(()=>[a(t(_),{onClick:e[8]||(e[8]=s=>A.value=!1)},{default:l(()=>e[59]||(e[59]=[d(" Got it ",-1)])),_:1,__:[59]})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{Ct as default};
