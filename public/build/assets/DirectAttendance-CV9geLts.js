import{d as H,r as g,u as W,c as P,s as Y,a as c,o as m,b as s,e as t,h as Z,w as n,f as a,t as d,i as o,k as j,F as D,g as L}from"./app-DW-4G1vZ.js";import{_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-BS7ImaE2.js";import{_ as b,b as h,c as k,d as O,a as w}from"./CardTitle.vue_vue_type_script_setup_true_lang-BcDEr4TB.js";import{_ as V}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-T0P3N6mj.js";import{_ as S}from"./index-r1g3ib2J.js";import{_ as T}from"./Input.vue_vue_type_script_setup_true_lang-DnmVy0AL.js";import{_ as E}from"./Label.vue_vue_type_script_setup_true_lang-PYw3eRzO.js";import{_ as te,a as se,b as ae,c as ne,d as C}from"./SelectValue.vue_vue_type_script_setup_true_lang-DqZ9_JK4.js";import{_ as oe,a as le,b as re,c as de,d as ie}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B2g3MDQd.js";import{E as ue,S as ce,Q as me,f as fe}from"./browser-Qmw0utpk.js";import{Q as _e}from"./qr-code-DtmqAAPy.js";import{U as pe}from"./user--A7oqBxk.js";import{C as N}from"./circle-check-big-BJq8CkBX.js";import{C as U}from"./circle-x-DdLfTClc.js";import{L as ge}from"./loader-circle-rDvplQIg.js";import"./useForwardExpose-CYdwRePy.js";import"./users-BhZaHBdP.js";import"./RovingFocusGroup-Dsi-dyvh.js";import"./check-DCQm1Fl6.js";import"./vue-qrcode-reader-DmduyMv5.js";import"./RovingFocusItem-Jd1FEocZ.js";import"./Textarea.vue_vue_type_script_setup_true_lang-CjQRaqiI.js";import"./zap-DjVR6z_V.js";import"./circle-alert-BcdFzL-g.js";import"./hash-1DI9CPPd.js";import"./calendar-hrTOBv_O.js";const ve={class:"container mx-auto p-6 space-y-6"},ye={class:"space-y-2"},xe={class:"flex items-center justify-between"},be={class:"text-muted-foreground"},he={class:"grid gap-6 md:grid-cols-2"},ke={class:"flex gap-2"},we={class:"space-y-2"},Se={class:"space-y-2"},Ce={class:"space-y-2"},$e={class:"grid gap-6 lg:grid-cols-2"},Qe={class:"space-y-3 max-h-80 overflow-y-auto"},Re={class:"flex-1 min-w-0"},Ae={class:"font-medium text-gray-900 truncate"},Fe={class:"text-sm text-green-700 font-mono"},Ie={key:0,class:"text-center py-8 text-muted-foreground"},je={class:"space-y-3 max-h-80 overflow-y-auto"},De={class:"flex-1 min-w-0"},Ve={class:"font-medium text-gray-900 truncate"},Ee={class:"text-sm text-red-700 font-mono"},Ne={key:0,class:"text-center py-8 text-muted-foreground"},Pe={key:0,class:"flex items-center justify-center py-8"},Le={key:1,class:"space-y-6"},Oe={class:"text-center"},Te={class:"font-semibold text-lg"},Ue={class:"text-sm text-gray-600"},qe={class:"flex flex-col items-center space-y-4"},Me={class:"w-64 h-64 bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center"},Be=["src"],Je={class:"bg-gray-50 rounded-lg p-4"},Xe={class:"grid grid-cols-2 gap-4 text-center"},Ge={class:"text-2xl font-bold text-green-600"},Ke={class:"text-2xl font-bold text-gray-600"},ht=H({__name:"DirectAttendance",props:{teacher:{},classInfo:{},session:{},students:{},attendance_records:{}},setup(q){const i=q,M=[{title:"Teacher Dashboard",href:"/teacher/dashboard"},{title:"Classes",href:"/teacher/classes"},{title:"Direct Attendance",href:"#"}],$=g(!1),Q=g(!1),R=g(""),A=g(!1),f=g({present:0,total:i.students.length}),u=W({student_id:"",name:"",status:"present"}),v=P(()=>i.students.filter(l=>i.attendance_records.includes(l.id))),F=P(()=>i.students.filter(l=>!i.attendance_records.includes(l.id))),I=()=>{f.value.present=v.value.length},B=async()=>{var l;if((l=i.session)!=null&&l.qr_code)try{A.value=!0;const e={session_id:i.session.id,class_id:i.classInfo.id,timestamp:Date.now()};R.value=await fe.toDataURL(JSON.stringify(e),{width:300,margin:2,color:{dark:"#000000",light:"#FFFFFF"}})}catch(e){console.error("Error generating QR code:",e)}finally{A.value=!1}},J=()=>{Q.value=!0},X=()=>{Q.value=!1},G=async l=>{},K=async l=>{try{const e=l.map(async p=>{var x;return(await fetch(`/teacher/attendance/${i.session.id}/mark`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((x=document.querySelector('meta[name="csrf-token"]'))==null?void 0:x.getAttribute("content"))||""},body:JSON.stringify({student_id:p.student_id,status:"present",method:"qr"})})).json()}),_=(await Promise.all(e)).filter(p=>p.success).length;l.forEach(p=>{const y=i.students.find(x=>x.student_id===p.student_id);y&&!i.attendance_records.includes(y.id)&&i.attendance_records.push(y.id)}),I(),_>0?alert(`✅ ${_} student${_>1?"s":""} marked as present`):alert("❌ Failed to mark attendance for any students")}catch(e){console.error("Error marking batch attendance:",e),alert("Failed to mark attendance")}},z=async()=>{var l;if(!u.student_id&&!u.name){alert("Please enter student ID or name");return}try{const r=await(await fetch(`/teacher/attendance/${i.session.id}/mark`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||""},body:JSON.stringify({student_id:u.student_id,name:u.name,status:u.status,method:"manual"})})).json();if(r.success){const _=r.student.id;i.attendance_records.includes(_)||(i.attendance_records.push(_),I()),alert("✅ Attendance marked successfully"),u.reset()}else alert(`❌ ${r.message}`)}catch(e){console.error("Error marking attendance:",e),alert("Failed to mark attendance")}};return Y(()=>{I(),B()}),(l,e)=>(m(),c(D,null,[s(t(Z),{title:"Direct Attendance"}),s(ee,{breadcrumbs:M},{default:n(()=>[a("div",ve,[a("div",ye,[a("div",xe,[a("div",null,[e[5]||(e[5]=a("h1",{class:"text-3xl font-bold tracking-tight"},"Direct Attendance",-1)),a("p",be,d(l.classInfo.name)+" • "+d(l.classInfo.course)+" - "+d(l.classInfo.section),1)]),s(t(S),{variant:"default",class:"text-sm"},{default:n(()=>[o(d(f.value.present)+"/"+d(f.value.total)+" Present ",1)]),_:1})])]),a("div",he,[s(t(b),null,{default:n(()=>[s(t(h),{class:"text-center"},{default:n(()=>[s(t(_e),{class:"h-12 w-12 mx-auto mb-2 text-primary"}),s(t(k),null,{default:n(()=>e[6]||(e[6]=[o("QR Code Attendance",-1)])),_:1,__:[6]}),s(t(O),null,{default:n(()=>e[7]||(e[7]=[o(" Students scan QR code with their phones to mark attendance ",-1)])),_:1,__:[7]})]),_:1}),s(t(w),{class:"space-y-4"},{default:n(()=>[a("div",ke,[s(t(V),{onClick:e[0]||(e[0]=r=>$.value=!0),class:"flex-1"},{default:n(()=>[s(t(ue),{class:"h-4 w-4 mr-2"}),e[8]||(e[8]=o(" Show QR Code ",-1))]),_:1,__:[8]}),s(t(V),{onClick:J,variant:"outline",class:"flex-1"},{default:n(()=>[s(t(ce),{class:"h-4 w-4 mr-2"}),e[9]||(e[9]=o(" Scan Student QR ",-1))]),_:1,__:[9]})])]),_:1})]),_:1}),s(t(b),null,{default:n(()=>[s(t(h),{class:"text-center"},{default:n(()=>[s(t(pe),{class:"h-12 w-12 mx-auto mb-2 text-primary"}),s(t(k),null,{default:n(()=>e[10]||(e[10]=[o("Manual Input",-1)])),_:1,__:[10]}),s(t(O),null,{default:n(()=>e[11]||(e[11]=[o(" Manually enter student information to mark attendance ",-1)])),_:1,__:[11]})]),_:1}),s(t(w),{class:"space-y-4"},{default:n(()=>[a("div",we,[s(t(E),{for:"student_id"},{default:n(()=>e[12]||(e[12]=[o("Student ID",-1)])),_:1,__:[12]}),s(t(T),{id:"student_id",modelValue:t(u).student_id,"onUpdate:modelValue":e[1]||(e[1]=r=>t(u).student_id=r),placeholder:"Enter student ID"},null,8,["modelValue"])]),a("div",Se,[s(t(E),{for:"name"},{default:n(()=>e[13]||(e[13]=[o("Or Student Name",-1)])),_:1,__:[13]}),s(t(T),{id:"name",modelValue:t(u).name,"onUpdate:modelValue":e[2]||(e[2]=r=>t(u).name=r),placeholder:"Enter student name"},null,8,["modelValue"])]),a("div",Ce,[s(t(E),{for:"status"},{default:n(()=>e[14]||(e[14]=[o("Status",-1)])),_:1,__:[14]}),s(t(te),{modelValue:t(u).status,"onUpdate:modelValue":e[3]||(e[3]=r=>t(u).status=r)},{default:n(()=>[s(t(se),null,{default:n(()=>[s(t(ae))]),_:1}),s(t(ne),null,{default:n(()=>[s(t(C),{value:"present"},{default:n(()=>e[15]||(e[15]=[o("Present",-1)])),_:1,__:[15]}),s(t(C),{value:"late"},{default:n(()=>e[16]||(e[16]=[o("Late",-1)])),_:1,__:[16]}),s(t(C),{value:"absent"},{default:n(()=>e[17]||(e[17]=[o("Absent",-1)])),_:1,__:[17]}),s(t(C),{value:"excused"},{default:n(()=>e[18]||(e[18]=[o("Excused",-1)])),_:1,__:[18]})]),_:1})]),_:1},8,["modelValue"])]),s(t(V),{onClick:z,class:"w-full",disabled:t(u).processing},{default:n(()=>[s(t(N),{class:"h-4 w-4 mr-2"}),e[19]||(e[19]=o(" Mark Attendance ",-1))]),_:1,__:[19]},8,["disabled"])]),_:1})]),_:1})]),a("div",$e,[s(t(b),{class:"h-fit"},{default:n(()=>[s(t(h),{class:"pb-3"},{default:n(()=>[s(t(k),{class:"flex items-center gap-2 text-green-700"},{default:n(()=>[s(t(N),{class:"h-5 w-5"}),o(" Present Students ("+d(v.value.length)+") ",1)]),_:1})]),_:1}),s(t(w),null,{default:n(()=>[a("div",Qe,[(m(!0),c(D,null,L(v.value,r=>(m(),c("div",{key:r.id,class:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors"},[a("div",Re,[a("p",Ae,d(r.name),1),a("p",Fe,d(r.student_id),1)]),s(t(S),{variant:"secondary",class:"bg-green-100 text-green-800 border-green-200 shrink-0"},{default:n(()=>e[20]||(e[20]=[o(" Present ",-1)])),_:1,__:[20]})]))),128)),v.value.length===0?(m(),c("div",Ie,[s(t(N),{class:"h-12 w-12 mx-auto mb-3 opacity-30"}),e[21]||(e[21]=a("p",{class:"font-medium"},"No students marked present yet",-1)),e[22]||(e[22]=a("p",{class:"text-sm"},"Use the QR scanner to mark attendance",-1))])):j("",!0)])]),_:1})]),_:1}),s(t(b),{class:"h-fit"},{default:n(()=>[s(t(h),{class:"pb-3"},{default:n(()=>[s(t(k),{class:"flex items-center gap-2 text-red-700"},{default:n(()=>[s(t(U),{class:"h-5 w-5"}),o(" Absent Students ("+d(F.value.length)+") ",1)]),_:1})]),_:1}),s(t(w),null,{default:n(()=>[a("div",je,[(m(!0),c(D,null,L(F.value,r=>(m(),c("div",{key:r.id,class:"flex items-center justify-between p-3 bg-red-50 border border-red-200 rounded-lg hover:bg-red-100 transition-colors"},[a("div",De,[a("p",Ve,d(r.name),1),a("p",Ee,d(r.student_id),1)]),s(t(S),{variant:"secondary",class:"bg-red-100 text-red-800 border-red-200 shrink-0"},{default:n(()=>e[23]||(e[23]=[o(" Absent ",-1)])),_:1,__:[23]})]))),128)),F.value.length===0?(m(),c("div",Ne,[s(t(U),{class:"h-12 w-12 mx-auto mb-3 opacity-30"}),e[24]||(e[24]=a("p",{class:"font-medium"},"All students are present!",-1)),e[25]||(e[25]=a("p",{class:"text-sm"},"Great job on attendance",-1))])):j("",!0)])]),_:1})]),_:1})])]),s(t(oe),{open:$.value,"onUpdate:open":e[4]||(e[4]=r=>$.value=r)},{default:n(()=>[s(t(le),{class:"max-w-md"},{default:n(()=>[s(t(re),null,{default:n(()=>[s(t(de),null,{default:n(()=>e[26]||(e[26]=[o("Attendance QR Code",-1)])),_:1,__:[26]}),s(t(ie),null,{default:n(()=>e[27]||(e[27]=[o(" Students can scan this QR code to mark their attendance ",-1)])),_:1,__:[27]})]),_:1}),A.value?(m(),c("div",Pe,[s(t(ge),{class:"h-8 w-8 animate-spin"})])):R.value?(m(),c("div",Le,[a("div",Oe,[a("h3",Te,d(l.classInfo.name),1),a("p",Ue,d(l.classInfo.section)+" • "+d(l.classInfo.course),1),s(t(S),{variant:"default",class:"mt-2"},{default:n(()=>[o(d(l.session.status),1)]),_:1})]),a("div",qe,[a("div",Me,[a("img",{src:R.value,alt:"Attendance QR Code",class:"w-full h-full object-contain"},null,8,Be)])]),e[31]||(e[31]=a("div",{class:"bg-blue-50 rounded-lg p-4"},[a("h4",{class:"font-medium text-blue-900 mb-2"},"Instructions for Students:"),a("ol",{class:"text-sm text-blue-800 space-y-1"},[a("li",null,"1. Open your camera app or QR code scanner"),a("li",null,"2. Point your camera at the QR code above"),a("li",null,"3. Tap the notification or link that appears"),a("li",null,"4. Confirm your attendance on the webpage")])],-1)),a("div",Je,[e[30]||(e[30]=a("h4",{class:"font-medium text-gray-900 mb-3"},"Live Attendance Count",-1)),a("div",Xe,[a("div",null,[a("div",Ge,d(f.value.present),1),e[28]||(e[28]=a("div",{class:"text-sm text-gray-600"},"Present",-1))]),a("div",null,[a("div",Ke,d(f.value.total-f.value.present),1),e[29]||(e[29]=a("div",{class:"text-sm text-gray-600"},"Absent",-1))])])])])):j("",!0)]),_:1})]),_:1},8,["open"]),s(me,{show:Q.value,onClose:X,onScanSuccess:G,onBatchScanSuccess:K},null,8,["show"])]),_:1})],64))}});export{ht as default};
