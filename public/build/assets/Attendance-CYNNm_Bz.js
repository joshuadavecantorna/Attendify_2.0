import{S as de,_ as ie}from"./AppLayout.vue_vue_type_script_setup_true_lang-BS7ImaE2.js";import{d as ue,r as j,u as H,a as _,o as f,b as n,e as t,h as re,w as a,f as s,i as d,t as i,F as C,g as F,j as y,k as p,m as x}from"./app-DW-4G1vZ.js";import{_ as b,b as k,c as w,a as S,d as J}from"./CardTitle.vue_vue_type_script_setup_true_lang-BcDEr4TB.js";import{_ as c}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-T0P3N6mj.js";import{_ as U}from"./index-r1g3ib2J.js";import{_ as D,a as T,b as M,c as z,d as q}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B2g3MDQd.js";import{_ as L}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DNdUMzvb.js";import{_ as fe}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-CaZf5xWh.js";import{_ as E}from"./Label.vue_vue_type_script_setup_true_lang-PYw3eRzO.js";import{_ as B}from"./Input.vue_vue_type_script_setup_true_lang-DnmVy0AL.js";import{_ as me,a as _e,b as ce,c as ve,d as pe}from"./SelectValue.vue_vue_type_script_setup_true_lang-DqZ9_JK4.js";import{P as xe}from"./plus-B7iORZUk.js";import{C as K}from"./clock-DQA8MFeI.js";import{U as ge}from"./users-BhZaHBdP.js";import"./useForwardExpose-CYdwRePy.js";import"./RovingFocusGroup-Dsi-dyvh.js";import"./check-DCQm1Fl6.js";const ye={class:"container mx-auto p-6 space-y-6"},be={class:"grid gap-4 md:grid-cols-4"},ke={class:"text-2xl font-bold"},we={class:"text-2xl font-bold"},Se={class:"text-2xl font-bold"},Ce={class:"text-2xl font-bold"},$e={class:"flex items-center justify-between"},Ae={class:"grid gap-4 py-4"},Ve={class:"grid gap-2"},je={class:"grid gap-2"},Fe={class:"grid gap-2"},Ue={class:"grid gap-2"},Ee={class:"grid gap-4 md:grid-cols-2"},Ne={class:"flex items-center justify-between"},De={class:"font-medium"},Te={class:"text-sm text-muted-foreground"},Me={class:"text-xs text-muted-foreground mt-1"},ze={class:"space-y-4"},qe={class:"flex items-center gap-3"},Le={class:"font-medium"},Be={class:"text-sm text-muted-foreground"},Pe={class:"flex items-center gap-2"},Re={class:"text-sm text-muted-foreground"},Qe={key:0,class:"text-center py-8 text-muted-foreground"},Ye={class:"text-center py-4"},Ge={class:"py-4"},Ie={class:"space-y-4"},he={class:"flex items-center justify-between"},He={class:"flex gap-2"},Je={key:0,class:"text-center py-8 text-muted-foreground"},Ke={class:"mt-6 space-y-3"},Oe={key:0},We={class:"flex justify-center gap-2"},Xe={key:1},Ze={key:1,class:"space-y-2 max-h-60 overflow-y-auto"},et={class:"flex items-center gap-3"},tt={class:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-sm font-medium"},st={class:"font-medium"},nt={class:"text-sm text-muted-foreground"},at={class:"flex items-center gap-2"},lt=["value","onChange"],ot={key:2,class:"border-t pt-4"},dt={class:"grid grid-cols-4 gap-4 text-center"},it={class:"text-lg font-semibold text-green-600"},ut={class:"text-lg font-semibold text-yellow-600"},rt={class:"text-lg font-semibold text-red-600"},ft={class:"text-lg font-semibold text-blue-600"},mt={class:"flex justify-between w-full"},_t={class:"flex gap-2"},Et=ue({__name:"Attendance",props:{teacher:{},classes:{},recent_sessions:{}},setup(O){const $=O,W=[{title:"Teacher Dashboard",href:"/teacher/dashboard"},{title:"Attendance",href:"/teacher/attendance"}],A=j(!1),g=j(!1),V=j(!1),o=j(null),m=H({class_id:"",session_name:"",duration:60,location_required:!1,qr_enabled:!0,notes:""});H({attendance_records:[]});const X=()=>{m.post("/teacher/attendance/sessions",{onSuccess:()=>{A.value=!1,m.reset()}})},Z=async u=>{try{m.processing=!0,x.post("/teacher/attendance/quick-start",{class_id:u},{onSuccess:()=>{console.log("Quick session started successfully"),m.processing=!1},onError:e=>{console.error("Error starting quick session:",e),alert("Failed to start session: "+(e.message||"Unknown error")),m.processing=!1},preserveScroll:!0,preserveState:!1})}catch(e){console.error("Error starting quick session:",e),alert(e instanceof Error?e.message:"Failed to start session"),m.processing=!1}},P=async u=>{o.value=u;try{const e=await fetch(`/teacher/attendance/sessions/${u.id}`);if(e.ok){const l=await e.json();o.value={...u,attendance_records:l.attendance_records||[],students:l.students||[]}}}catch(e){console.error("Failed to load session data:",e)}g.value=!0},ee=()=>{V.value=!0},R=()=>{if(!o.value)return;const e=`Are you sure you want to delete the attendance session "${o.value.class_name}"?

This action cannot be undone and will remove all attendance records for this session.`;confirm(e)&&x.delete(`/teacher/attendance/sessions/${o.value.id}`,{onSuccess:()=>{g.value=!1,o.value=null,x.reload()},onError:l=>{console.error("Failed to delete session:",l),alert("Failed to delete session: "+(l.message||"Unknown error"))}})},te=(u,e)=>{o.value&&x.post(`/teacher/attendance/${o.value.id}/mark`,{student_id:u,status:e,method:"manual"},{onSuccess:()=>{P(o.value)},onError:l=>{console.error("Failed to mark attendance:",l),alert("Failed to update attendance: "+(l.message||"Unknown error"))},preserveState:!0})},se=u=>{var v;const e=((v=u==null?void 0:u.student)==null?void 0:v.name)||(u==null?void 0:u.name);if(!e)return"??";const l=e.split(" ");return l.length>1?`${l[0][0]}${l[l.length-1][0]}`:l[0][0]+l[0][1]||l[0][0]},ne=u=>{switch(u){case"present":return"default";case"late":return"secondary";case"absent":return"destructive";case"excused":return"outline";default:return"secondary"}},Q=()=>{o.value&&x.visit(`/teacher/attendance/session/${o.value.id}`)},ae=()=>{o.value&&confirm("Are you sure you want to end this attendance session?")&&x.put(`/teacher/attendance/sessions/${o.value.id}/end`,{},{onSuccess:()=>{g.value=!1,o.value=null,x.reload()},onError:u=>{console.error("Failed to end session:",u),alert("Failed to end session: "+(u.message||"Unknown error"))}})},le=()=>{o.value&&window.open(`/teacher/attendance/sessions/${o.value.id}/export`,"_blank")};return(u,e)=>(f(),_(C,null,[n(t(re),{title:"Teacher Attendance"}),n(ie,{breadcrumbs:W},{default:a(()=>[s("div",ye,[e[39]||(e[39]=s("div",{class:"space-y-2"},[s("h1",{class:"text-3xl font-bold tracking-tight"},"Attendance Management"),s("p",{class:"text-muted-foreground"}," Manage attendance sessions for your classes ")],-1)),s("div",be,[n(t(b),null,{default:a(()=>[n(t(k),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[n(t(w),{class:"text-sm font-medium"},{default:a(()=>e[10]||(e[10]=[d("Total Classes",-1)])),_:1,__:[10]}),e[11]||(e[11]=s("span",{class:"text-xl"},"ðŸ“š",-1))]),_:1,__:[11]}),n(t(S),null,{default:a(()=>[s("div",ke,i(u.classes.length),1),e[12]||(e[12]=s("p",{class:"text-xs text-muted-foreground mt-1"}," Active classes ",-1))]),_:1,__:[12]})]),_:1}),n(t(b),null,{default:a(()=>[n(t(k),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[n(t(w),{class:"text-sm font-medium"},{default:a(()=>e[13]||(e[13]=[d("Recent Sessions",-1)])),_:1,__:[13]}),e[14]||(e[14]=s("span",{class:"text-xl"},"ðŸ“…",-1))]),_:1,__:[14]}),n(t(S),null,{default:a(()=>[s("div",we,i(u.recent_sessions.length),1),e[15]||(e[15]=s("p",{class:"text-xs text-muted-foreground mt-1"}," Last 10 sessions ",-1))]),_:1,__:[15]})]),_:1}),n(t(b),null,{default:a(()=>[n(t(k),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[n(t(w),{class:"text-sm font-medium"},{default:a(()=>e[16]||(e[16]=[d("Total Students",-1)])),_:1,__:[16]}),e[17]||(e[17]=s("span",{class:"text-xl"},"ðŸ‘¥",-1))]),_:1,__:[17]}),n(t(S),null,{default:a(()=>[s("div",Se,i(u.classes.reduce((l,v)=>l+v.student_count,0)),1),e[18]||(e[18]=s("p",{class:"text-xs text-muted-foreground mt-1"}," Across all classes ",-1))]),_:1,__:[18]})]),_:1}),n(t(b),null,{default:a(()=>[n(t(k),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[n(t(w),{class:"text-sm font-medium"},{default:a(()=>e[19]||(e[19]=[d("Active Sessions",-1)])),_:1,__:[19]}),e[20]||(e[20]=s("span",{class:"text-xl"},"ðŸŸ¢",-1))]),_:1,__:[20]}),n(t(S),null,{default:a(()=>[s("div",Ce,i(u.recent_sessions.filter(l=>l.status==="active").length),1),e[21]||(e[21]=s("p",{class:"text-xs text-muted-foreground mt-1"}," Currently active ",-1))]),_:1,__:[21]})]),_:1})]),n(t(b),null,{default:a(()=>[n(t(k),null,{default:a(()=>[s("div",$e,[s("div",null,[n(t(w),{class:"flex items-center gap-2"},{default:a(()=>[n(t(de),{class:"h-5 w-5"}),e[22]||(e[22]=d(" Attendance Sessions ",-1))]),_:1,__:[22]}),n(t(J),null,{default:a(()=>e[23]||(e[23]=[d("Create and manage attendance sessions for your classes",-1)])),_:1,__:[23]})]),n(t(D),{open:A.value,"onUpdate:open":e[5]||(e[5]=l=>A.value=l)},{default:a(()=>[n(t(fe),{"as-child":""},{default:a(()=>[n(t(c),{class:"flex items-center gap-2"},{default:a(()=>[n(t(xe),{class:"h-4 w-4"}),e[24]||(e[24]=d(" New Session ",-1))]),_:1,__:[24]})]),_:1}),n(t(T),{class:"sm:max-w-[500px]"},{default:a(()=>[n(t(M),null,{default:a(()=>[n(t(z),null,{default:a(()=>e[25]||(e[25]=[d("Create Attendance Session",-1)])),_:1,__:[25]}),n(t(q),null,{default:a(()=>e[26]||(e[26]=[d("Set up a new attendance session for one of your classes.",-1)])),_:1,__:[26]})]),_:1}),s("div",Ae,[s("div",Ve,[n(t(E),{for:"class"},{default:a(()=>e[27]||(e[27]=[d("Select Class",-1)])),_:1,__:[27]}),n(t(me),{modelValue:t(m).class_id,"onUpdate:modelValue":e[0]||(e[0]=l=>t(m).class_id=l)},{default:a(()=>[n(t(_e),null,{default:a(()=>[n(t(ce),{placeholder:"Choose a class"})]),_:1}),n(t(ve),null,{default:a(()=>[(f(!0),_(C,null,F($.classes,l=>(f(),y(t(pe),{key:l.id,value:l.id.toString()},{default:a(()=>[d(i(l.course_code)+" - "+i(l.class_name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),s("div",je,[n(t(E),{for:"session_name"},{default:a(()=>e[28]||(e[28]=[d("Session Name",-1)])),_:1,__:[28]}),n(t(B),{id:"session_name",modelValue:t(m).session_name,"onUpdate:modelValue":e[1]||(e[1]=l=>t(m).session_name=l),placeholder:"e.g., Midterm Attendance"},null,8,["modelValue"])]),s("div",Fe,[n(t(E),{for:"duration"},{default:a(()=>e[29]||(e[29]=[d("Duration (minutes)",-1)])),_:1,__:[29]}),n(t(B),{id:"duration",type:"number",modelValue:t(m).duration,"onUpdate:modelValue":e[2]||(e[2]=l=>t(m).duration=l),min:"5",max:"240"},null,8,["modelValue"])]),s("div",Ue,[n(t(E),{for:"notes"},{default:a(()=>e[30]||(e[30]=[d("Notes (optional)",-1)])),_:1,__:[30]}),n(t(B),{id:"notes",modelValue:t(m).notes,"onUpdate:modelValue":e[3]||(e[3]=l=>t(m).notes=l),placeholder:"Any additional notes..."},null,8,["modelValue"])])]),n(t(L),null,{default:a(()=>[n(t(c),{variant:"outline",onClick:e[4]||(e[4]=l=>A.value=!1)},{default:a(()=>e[31]||(e[31]=[d("Cancel",-1)])),_:1,__:[31]}),n(t(c),{onClick:X,disabled:t(m).processing},{default:a(()=>[d(i(t(m).processing?"Creating...":"Create Session"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1}),n(t(S),null,{default:a(()=>[s("div",Ee,[(f(!0),_(C,null,F($.classes,l=>(f(),_("div",{key:l.id,class:"border rounded-lg p-4"},[s("div",Ne,[s("div",null,[s("h3",De,i(l.course_code),1),s("p",Te,i(l.class_name),1),s("p",Me,i(l.student_count)+" students",1)]),n(t(c),{size:"sm",onClick:v=>Z(l.id)},{default:a(()=>e[32]||(e[32]=[d(" Quick Start ",-1)])),_:2,__:[32]},1032,["onClick"])])]))),128))])]),_:1})]),_:1}),n(t(b),null,{default:a(()=>[n(t(k),null,{default:a(()=>[n(t(w),null,{default:a(()=>e[33]||(e[33]=[d("Recent Attendance Sessions",-1)])),_:1,__:[33]}),n(t(J),null,{default:a(()=>e[34]||(e[34]=[d("Your latest attendance activities",-1)])),_:1,__:[34]})]),_:1}),n(t(S),null,{default:a(()=>[s("div",ze,[(f(!0),_(C,null,F($.recent_sessions,l=>(f(),_("div",{key:l.id,class:"flex items-center justify-between p-4 border rounded-lg"},[s("div",qe,[n(t(U),{variant:"secondary"},{default:a(()=>[d(i(l.course_code),1)]),_:2},1024),s("div",null,[s("p",Le,i(l.class_name),1),s("p",Be,i(l.date)+" at "+i(l.time),1)])]),s("div",Pe,[s("span",Re,i(l.present_count)+"/"+i(l.total_count)+" students",1),n(t(U),{variant:l.status==="completed"?"default":"secondary"},{default:a(()=>[d(i(l.status),1)]),_:2},1032,["variant"]),n(t(c),{size:"sm",variant:"outline",onClick:v=>P(l)},{default:a(()=>e[35]||(e[35]=[d(" Manage ",-1)])),_:2,__:[35]},1032,["onClick"])])]))),128)),$.recent_sessions.length===0?(f(),_("div",Qe,[n(t(K),{class:"h-12 w-12 mx-auto mb-4 opacity-50"}),e[36]||(e[36]=s("p",null,"No recent attendance sessions",-1)),e[37]||(e[37]=s("p",{class:"text-sm"},"Create your first session to get started",-1))])):p("",!0),s("div",Ye,[n(t(c),{variant:"outline",onClick:ee},{default:a(()=>e[38]||(e[38]=[d(" View All Sessions ",-1)])),_:1,__:[38]})])])]),_:1})]),_:1})]),n(t(D),{open:g.value,"onUpdate:open":e[7]||(e[7]=l=>g.value=l)},{default:a(()=>[n(t(T),{class:"sm:max-w-[600px]"},{default:a(()=>{var l,v,Y,G;return[n(t(M),null,{default:a(()=>[o.value?(f(),y(t(z),{key:0},{default:a(()=>[d("Manage: "+i(o.value.class_name),1)]),_:1})):p("",!0),o.value?(f(),y(t(q),{key:1},{default:a(()=>[d(i(o.value.date)+" at "+i(o.value.time)+" - "+i(o.value.present_count)+"/"+i(o.value.total_count)+" students present ",1)]),_:1})):p("",!0)]),_:1}),s("div",Ge,[s("div",Ie,[s("div",he,[e[41]||(e[41]=s("h4",{class:"font-medium"},"Attendance Records",-1)),s("div",He,[o.value?(f(),y(t(c),{key:0,size:"sm",variant:"outline",onClick:le},{default:a(()=>e[40]||(e[40]=[d(" Export Report ",-1)])),_:1,__:[40]})):p("",!0),n(t(U),{variant:((l=o.value)==null?void 0:l.status)==="active"?"default":"secondary"},{default:a(()=>{var r;return[d(i(((r=o.value)==null?void 0:r.status)||"Unknown"),1)]}),_:1},8,["variant"])])]),!((v=o.value)!=null&&v.attendance_records)||o.value.attendance_records.length===0?(f(),_("div",Je,[n(t(ge),{class:"h-12 w-12 mx-auto mb-4 opacity-50"}),e[47]||(e[47]=s("p",{class:"font-medium"},"No attendance records found",-1)),e[48]||(e[48]=s("p",{class:"text-sm"},"No students have been marked for this session yet.",-1)),s("div",Ke,[((Y=o.value)==null?void 0:Y.status)==="active"?(f(),_("div",Oe,[e[44]||(e[44]=s("p",{class:"text-sm text-blue-600 mb-2"},"This session is still active. You can:",-1)),s("div",We,[n(t(c),{onClick:Q,size:"sm"},{default:a(()=>e[42]||(e[42]=[d(" Manage Session ",-1)])),_:1,__:[42]}),n(t(c),{onClick:ae,variant:"outline",size:"sm"},{default:a(()=>e[43]||(e[43]=[d(" End Session ",-1)])),_:1,__:[43]})])])):(f(),_("div",Xe,[e[46]||(e[46]=s("p",{class:"text-sm text-orange-600 mb-2"},"This completed session has no records.",-1)),n(t(c),{onClick:R,variant:"destructive",size:"sm"},{default:a(()=>e[45]||(e[45]=[d(" Delete Empty Session ",-1)])),_:1,__:[45]})]))])])):(f(),_("div",Ze,[(f(!0),_(C,null,F(o.value.attendance_records,r=>{var N,I;return f(),_("div",{key:r.id,class:"flex items-center justify-between p-3 border rounded-lg"},[s("div",et,[s("div",tt,i(se(r)),1),s("div",null,[s("p",st,i(((N=r.student)==null?void 0:N.name)||r.name),1),s("p",nt,i(((I=r.student)==null?void 0:I.student_id)||r.student_id),1)])]),s("div",at,[n(t(U),{variant:ne(r.status)},{default:a(()=>[d(i(r.status),1)]),_:2},1032,["variant"]),s("select",{value:r.status,onChange:oe=>{var h;return te(((h=r.student)==null?void 0:h.student_id)||r.student_id,oe.target.value)},class:"text-sm border rounded px-2 py-1"},e[49]||(e[49]=[s("option",{value:"present"},"Present",-1),s("option",{value:"absent"},"Absent",-1),s("option",{value:"late"},"Late",-1),s("option",{value:"excused"},"Excused",-1)]),40,lt)])])}),128))])),(G=o.value)!=null&&G.attendance_records&&o.value.attendance_records.length>0?(f(),_("div",ot,[s("div",dt,[s("div",null,[s("div",it,i(o.value.attendance_records.filter(r=>r.status==="present").length),1),e[50]||(e[50]=s("div",{class:"text-xs text-muted-foreground"},"Present",-1))]),s("div",null,[s("div",ut,i(o.value.attendance_records.filter(r=>r.status==="late").length),1),e[51]||(e[51]=s("div",{class:"text-xs text-muted-foreground"},"Late",-1))]),s("div",null,[s("div",rt,i(o.value.attendance_records.filter(r=>r.status==="absent").length),1),e[52]||(e[52]=s("div",{class:"text-xs text-muted-foreground"},"Absent",-1))]),s("div",null,[s("div",ft,i(o.value.attendance_records.filter(r=>r.status==="excused").length),1),e[53]||(e[53]=s("div",{class:"text-xs text-muted-foreground"},"Excused",-1))])])])):p("",!0)])]),n(t(L),null,{default:a(()=>{var r;return[s("div",mt,[o.value?(f(),y(t(c),{key:0,variant:"destructive",onClick:R,size:"sm"},{default:a(()=>e[54]||(e[54]=[d(" Delete Session ",-1)])),_:1,__:[54]})):p("",!0),s("div",_t,[n(t(c),{variant:"outline",onClick:e[6]||(e[6]=N=>g.value=!1)},{default:a(()=>e[55]||(e[55]=[d("Close",-1)])),_:1,__:[55]}),((r=o.value)==null?void 0:r.status)==="active"?(f(),y(t(c),{key:0,onClick:Q},{default:a(()=>e[56]||(e[56]=[d(" Manage Live Session ",-1)])),_:1,__:[56]})):p("",!0)])])]}),_:1})]}),_:1})]),_:1},8,["open"]),n(t(D),{open:V.value,"onUpdate:open":e[9]||(e[9]=l=>V.value=l)},{default:a(()=>[n(t(T),{class:"sm:max-w-[400px]"},{default:a(()=>[n(t(M),null,{default:a(()=>[n(t(z),{class:"flex items-center gap-2"},{default:a(()=>[n(t(K),{class:"h-5 w-5 text-blue-500"}),e[57]||(e[57]=d(" Coming Soon ",-1))]),_:1,__:[57]}),n(t(q),null,{default:a(()=>e[58]||(e[58]=[d(' The "View All Sessions" feature is currently under development and will be available in a future update. ',-1)])),_:1,__:[58]})]),_:1}),n(t(L),null,{default:a(()=>[n(t(c),{onClick:e[8]||(e[8]=l=>V.value=!1)},{default:a(()=>e[59]||(e[59]=[d(" Got it ",-1)])),_:1,__:[59]})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{Et as default};
