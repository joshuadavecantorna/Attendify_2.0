import{d as ae,r as m,s as le,a as f,o as i,b as s,e as t,h as oe,w as a,f as o,i as n,t as u,v as N,z as U,F as V,g as F,j as ne,k as E,G as S,m as M}from"./app-DW-4G1vZ.js";import{_ as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-BS7ImaE2.js";import{_ as x,b as y,c as w,a as b,d as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-BcDEr4TB.js";import{_ as R}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-T0P3N6mj.js";import{_ as ue}from"./index-r1g3ib2J.js";import{_ as ie}from"./Separator.vue_vue_type_script_setup_true_lang-B2_Pp7m9.js";import{_ as de}from"./Input.vue_vue_type_script_setup_true_lang-DnmVy0AL.js";import{_ as j}from"./Label.vue_vue_type_script_setup_true_lang-PYw3eRzO.js";import{_ as B}from"./Textarea.vue_vue_type_script_setup_true_lang-CjQRaqiI.js";import{_ as L,a as T,b as z,c as G,d as O}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B2g3MDQd.js";import{_ as H}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DNdUMzvb.js";import"./useForwardExpose-CYdwRePy.js";import"./users-BhZaHBdP.js";import"./RovingFocusGroup-Dsi-dyvh.js";const fe={class:"container mx-auto p-6 space-y-6"},ce={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},pe={class:"text-2xl font-bold"},me={class:"text-2xl font-bold text-yellow-600"},ve={class:"text-2xl font-bold text-green-600"},_e={class:"text-2xl font-bold text-red-600"},ge={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},xe={class:"space-y-2"},be={class:"space-y-2"},ye=["value"],we={class:"space-y-2"},Re={key:0,class:"p-8 text-center text-muted-foreground"},ke={key:1,class:"p-8 text-center text-muted-foreground"},je={key:2,class:"space-y-4"},$e={class:"flex justify-between items-start mb-4"},he={class:"text-lg font-medium mb-2"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},Se={class:"space-y-2"},Ae={class:"space-y-2"},qe={key:0},Ve={key:1},Ee={class:"flex flex-col sm:flex-row gap-2 justify-between items-start sm:items-center"},De=["href"],Ne={key:0,class:"flex space-x-2"},Ue={key:1,class:"text-sm text-muted-foreground"},Fe={class:"space-y-4"},Me={class:"space-y-2"},Pe={class:"space-y-4"},Be={class:"space-y-2"},et=ae({__name:"ExcuseRequests",props:{teacher:{},requests:{},classes:{}},setup(I){const D=I,J=m([{title:"Dashboard",href:"/teacher/dashboard"},{title:"Excuse Requests",href:"/teacher/excuse-requests"}]),A=m(!1),p=m(!1),$=m(!1),h=m(!1),v=m(null),c=m(""),d=m({status:"",class_id:"",search:""}),_=m(D.requests),q=m(D.classes||[]),k=async()=>{A.value=!0;try{const r=new URLSearchParams;d.value.status&&r.append("status",d.value.status),d.value.class_id&&r.append("class_id",d.value.class_id),d.value.search&&r.append("search",d.value.search);const e=await S.get(`/teacher/excuse-requests?${r}`);_.value=e.data.requests}catch(r){console.error("Error fetching requests:",r)}finally{A.value=!1}},K=(()=>{let r;return()=>{clearTimeout(r),r=setTimeout(k,500)}})(),Q=r=>{v.value=r,c.value="",$.value=!0},W=r=>{v.value=r,c.value="",h.value=!0},C=()=>{$.value=!1,h.value=!1,v.value=null,c.value=""},X=async()=>{if(v.value){p.value=!0;try{await S.post(`/teacher/excuse-requests/${v.value.id}/approve`,{review_notes:c.value}),C(),k(),M.visit(window.location.pathname,{method:"get",data:{},preserveState:!0,preserveScroll:!0,onSuccess:()=>{}})}catch(r){console.error("Error approving request:",r),alert("Failed to approve request. Please try again.")}finally{p.value=!1}}},Y=async()=>{if(!(!v.value||!c.value.trim())){p.value=!0;try{await S.post(`/teacher/excuse-requests/${v.value.id}/reject`,{review_notes:c.value}),C(),k(),M.visit(window.location.pathname,{method:"get",data:{},preserveState:!0,preserveScroll:!0,onSuccess:()=>{}})}catch(r){console.error("Error rejecting request:",r),alert("Failed to reject request. Please try again.")}finally{p.value=!1}}},Z=r=>{switch(r){case"pending":return"secondary";case"approved":return"default";case"rejected":return"destructive";default:return"outline"}},ee=r=>new Date(r).toLocaleDateString(),te=r=>new Date(r).toLocaleString(),se=async()=>{try{const r=await S.get("/teacher/classes");q.value=r.data.classes||[]}catch(r){console.error("Error fetching classes:",r)}};return le(()=>{q.value.length===0&&se()}),(r,e)=>(i(),f(V,null,[s(t(oe),{title:"Excuse Requests"}),s(re,{breadcrumbs:J.value},{default:a(()=>[o("div",fe,[e[37]||(e[37]=o("div",{class:"space-y-2"},[o("h1",{class:"text-3xl font-bold tracking-tight"},"Excuse Requests"),o("p",{class:"text-muted-foreground"}," Review and manage student excuse requests for your classes ")],-1)),o("div",ce,[s(t(x),null,{default:a(()=>[s(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(w),{class:"text-sm font-medium"},{default:a(()=>e[7]||(e[7]=[n("Total Requests",-1)])),_:1,__:[7]}),e[8]||(e[8]=o("span",{class:"text-xl"},"ðŸ“‹",-1))]),_:1,__:[8]}),s(t(b),null,{default:a(()=>[o("div",pe,u(_.value.total),1),e[9]||(e[9]=o("p",{class:"text-xs text-muted-foreground mt-1"}," All requests ",-1))]),_:1,__:[9]})]),_:1}),s(t(x),null,{default:a(()=>[s(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(w),{class:"text-sm font-medium"},{default:a(()=>e[10]||(e[10]=[n("Pending",-1)])),_:1,__:[10]}),e[11]||(e[11]=o("span",{class:"text-xl"},"â³",-1))]),_:1,__:[11]}),s(t(b),null,{default:a(()=>[o("div",me,u(_.value.data.filter(l=>l.status==="pending").length),1),e[12]||(e[12]=o("p",{class:"text-xs text-muted-foreground mt-1"}," Awaiting review ",-1))]),_:1,__:[12]})]),_:1}),s(t(x),null,{default:a(()=>[s(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(w),{class:"text-sm font-medium"},{default:a(()=>e[13]||(e[13]=[n("Approved",-1)])),_:1,__:[13]}),e[14]||(e[14]=o("span",{class:"text-xl"},"âœ…",-1))]),_:1,__:[14]}),s(t(b),null,{default:a(()=>[o("div",ve,u(_.value.data.filter(l=>l.status==="approved").length),1),e[15]||(e[15]=o("p",{class:"text-xs text-muted-foreground mt-1"}," Approved requests ",-1))]),_:1,__:[15]})]),_:1}),s(t(x),null,{default:a(()=>[s(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(w),{class:"text-sm font-medium"},{default:a(()=>e[16]||(e[16]=[n("Rejected",-1)])),_:1,__:[16]}),e[17]||(e[17]=o("span",{class:"text-xl"},"âŒ",-1))]),_:1,__:[17]}),s(t(b),null,{default:a(()=>[o("div",_e,u(_.value.data.filter(l=>l.status==="rejected").length),1),e[18]||(e[18]=o("p",{class:"text-xs text-muted-foreground mt-1"}," Rejected requests ",-1))]),_:1,__:[18]})]),_:1})]),s(t(x),null,{default:a(()=>[s(t(y),null,{default:a(()=>[s(t(w),null,{default:a(()=>e[19]||(e[19]=[n("Filters",-1)])),_:1,__:[19]}),s(t(P),null,{default:a(()=>e[20]||(e[20]=[n("Filter excuse requests by status, class, or student name",-1)])),_:1,__:[20]})]),_:1}),s(t(b),null,{default:a(()=>[o("div",ge,[o("div",xe,[s(t(j),{for:"status-filter"},{default:a(()=>e[21]||(e[21]=[n("Status",-1)])),_:1,__:[21]}),N(o("select",{id:"status-filter","onUpdate:modelValue":e[0]||(e[0]=l=>d.value.status=l),onChange:k,class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},e[22]||(e[22]=[o("option",{value:""},"All Status",-1),o("option",{value:"pending"},"Pending",-1),o("option",{value:"approved"},"Approved",-1),o("option",{value:"rejected"},"Rejected",-1)]),544),[[U,d.value.status]])]),o("div",be,[s(t(j),{for:"class-filter"},{default:a(()=>e[23]||(e[23]=[n("Class",-1)])),_:1,__:[23]}),N(o("select",{id:"class-filter","onUpdate:modelValue":e[1]||(e[1]=l=>d.value.class_id=l),onChange:k,class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},[e[24]||(e[24]=o("option",{value:""},"All Classes",-1)),(i(!0),f(V,null,F(q.value,l=>(i(),f("option",{key:l.id,value:l.id.toString()},u(l.name)+" - "+u(l.course),9,ye))),128))],544),[[U,d.value.class_id]])]),o("div",we,[s(t(j),{for:"search-filter"},{default:a(()=>e[25]||(e[25]=[n("Search",-1)])),_:1,__:[25]}),s(t(de),{id:"search-filter",modelValue:d.value.search,"onUpdate:modelValue":e[2]||(e[2]=l=>d.value.search=l),onInput:t(K),type:"text",placeholder:"Search by student name...",class:"w-full"},null,8,["modelValue","onInput"])])])]),_:1})]),_:1}),s(t(x),null,{default:a(()=>[s(t(y),null,{default:a(()=>[s(t(w),null,{default:a(()=>e[26]||(e[26]=[n("Excuse Requests",-1)])),_:1,__:[26]}),s(t(P),null,{default:a(()=>e[27]||(e[27]=[n("Review and manage student excuse requests",-1)])),_:1,__:[27]})]),_:1}),s(t(b),null,{default:a(()=>[A.value?(i(),f("div",Re," Loading requests... ")):_.value.data.length===0?(i(),f("div",ke," No excuse requests to review at this time. ")):(i(),f("div",je,[(i(!0),f(V,null,F(_.value.data,l=>(i(),ne(t(x),{key:l.id,class:"transition-all hover:shadow-md"},{default:a(()=>[s(t(b),{class:"p-6"},{default:a(()=>[o("div",$e,[o("div",null,[o("h3",he,u(l.student.name),1),s(t(ue),{variant:Z(l.status),class:"mb-3"},{default:a(()=>[n(u(l.status.charAt(0).toUpperCase()+l.status.slice(1)),1)]),_:2},1032,["variant"])])]),o("div",Ce,[o("div",Se,[o("p",null,[e[28]||(e[28]=o("span",{class:"font-medium"},"Student ID:",-1)),n(" "+u(l.student.student_id),1)]),o("p",null,[e[29]||(e[29]=o("span",{class:"font-medium"},"Class:",-1)),n(" "+u(l.attendance_session.class.name)+" - "+u(l.attendance_session.class.course),1)]),o("p",null,[e[30]||(e[30]=o("span",{class:"font-medium"},"Session:",-1)),n(" "+u(l.attendance_session.session_name),1)]),o("p",null,[e[31]||(e[31]=o("span",{class:"font-medium"},"Date:",-1)),n(" "+u(ee(l.attendance_session.session_date)),1)])]),o("div",Ae,[o("p",null,[e[32]||(e[32]=o("span",{class:"font-medium"},"Reason:",-1)),n(" "+u(l.reason),1)]),l.review_notes?(i(),f("p",qe,[e[33]||(e[33]=o("span",{class:"font-medium"},"Review Notes:",-1)),n(" "+u(l.review_notes),1)])):E("",!0),l.reviewed_at?(i(),f("p",Ve,[e[34]||(e[34]=o("span",{class:"font-medium"},"Reviewed:",-1)),n(" "+u(te(l.reviewed_at)),1)])):E("",!0)])]),s(t(ie),{class:"my-4"}),o("div",Ee,[o("div",null,[l.attachment_path?(i(),f("a",{key:0,href:`/teacher/excuse-requests/${l.id}/download-attachment`,target:"_blank",class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"}," ðŸ“Ž Download Attachment ",8,De)):E("",!0)]),l.status==="pending"?(i(),f("div",Ne,[s(t(R),{onClick:g=>Q(l),variant:"default",size:"sm",class:"bg-green-600 hover:bg-green-700"},{default:a(()=>e[35]||(e[35]=[n(" âœ“ Approve ",-1)])),_:2,__:[35]},1032,["onClick"]),s(t(R),{onClick:g=>W(l),variant:"destructive",size:"sm"},{default:a(()=>e[36]||(e[36]=[n(" âœ— Reject ",-1)])),_:2,__:[36]},1032,["onClick"])])):(i(),f("div",Ue,u(l.status==="approved"?"âœ“ Approved":"âœ— Rejected"),1))])]),_:2},1024)]),_:2},1024))),128))]))]),_:1})]),_:1})]),s(t(L),{open:$.value,"onUpdate:open":e[4]||(e[4]=l=>$.value=l)},{default:a(()=>[s(t(T),{class:"sm:max-w-md"},{default:a(()=>[s(t(z),null,{default:a(()=>[s(t(G),null,{default:a(()=>e[38]||(e[38]=[n("Approve Excuse Request",-1)])),_:1,__:[38]}),s(t(O),null,{default:a(()=>{var l,g;return[n(" Are you sure you want to approve this excuse request from "+u((g=(l=v.value)==null?void 0:l.student)==null?void 0:g.name)+"? ",1)]}),_:1})]),_:1}),o("div",Fe,[o("div",Me,[s(t(j),{for:"approve-notes"},{default:a(()=>e[39]||(e[39]=[n("Review Notes (Optional)",-1)])),_:1,__:[39]}),s(t(B),{id:"approve-notes",modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=l=>c.value=l),rows:"3",placeholder:"Add any notes about your approval..."},null,8,["modelValue"])])]),s(t(H),null,{default:a(()=>[s(t(R),{variant:"outline",onClick:C,disabled:p.value},{default:a(()=>e[40]||(e[40]=[n(" Cancel ",-1)])),_:1,__:[40]},8,["disabled"]),s(t(R),{onClick:X,disabled:p.value,class:"bg-green-600 hover:bg-green-700"},{default:a(()=>[n(u(p.value?"Approving...":"Approve"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),s(t(L),{open:h.value,"onUpdate:open":e[6]||(e[6]=l=>h.value=l)},{default:a(()=>[s(t(T),{class:"sm:max-w-md"},{default:a(()=>[s(t(z),null,{default:a(()=>[s(t(G),null,{default:a(()=>e[41]||(e[41]=[n("Reject Excuse Request",-1)])),_:1,__:[41]}),s(t(O),null,{default:a(()=>{var l,g;return[n(" Are you sure you want to reject this excuse request from "+u((g=(l=v.value)==null?void 0:l.student)==null?void 0:g.name)+"? ",1)]}),_:1})]),_:1}),o("div",Pe,[o("div",Be,[s(t(j),{for:"reject-notes"},{default:a(()=>e[42]||(e[42]=[n("Review Notes (Required)",-1)])),_:1,__:[42]}),s(t(B),{id:"reject-notes",modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=l=>c.value=l),rows:"3",placeholder:"Please provide a reason for rejection...",required:""},null,8,["modelValue"])])]),s(t(H),null,{default:a(()=>[s(t(R),{variant:"outline",onClick:C,disabled:p.value},{default:a(()=>e[43]||(e[43]=[n(" Cancel ",-1)])),_:1,__:[43]},8,["disabled"]),s(t(R),{variant:"destructive",onClick:Y,disabled:p.value||!c.value.trim()},{default:a(()=>[n(u(p.value?"Rejecting...":"Reject"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1},8,["breadcrumbs"])],64))}});export{et as default};
