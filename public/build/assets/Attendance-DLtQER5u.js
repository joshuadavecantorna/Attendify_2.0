import{d as Ie,q as Be,r as g,c as Xe,s as He,a as m,o as i,b as s,e as t,h as Ke,w as a,f as l,k as _,t as r,i as d,n as N,F as L,g as K,j,v as Qe,x as Je,m as Q}from"./app-DW-4G1vZ.js";import{B as ne,C as Ge,F as Ze,S as qe,_ as We}from"./AppLayout.vue_vue_type_script_setup_true_lang-BS7ImaE2.js";import{d as Ye}from"./index-B0Ham5Fk.js";import{_ as b,b as h,c as k,a as w,d as z}from"./CardTitle.vue_vue_type_script_setup_true_lang-BcDEr4TB.js";import{c as ke,_ as x}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-T0P3N6mj.js";import{_ as J}from"./index-r1g3ib2J.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-DnmVy0AL.js";import{_ as A}from"./Label.vue_vue_type_script_setup_true_lang-PYw3eRzO.js";import{_ as oe,a as de,b as re,c as ue,d as C}from"./SelectValue.vue_vue_type_script_setup_true_lang-DqZ9_JK4.js";import{_ as me,a as pe,b as ve,c as _e,d as xe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B2g3MDQd.js";import{_ as ye}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DNdUMzvb.js";import{D as se}from"./download-r_jayyTT.js";import{U}from"./users-BhZaHBdP.js";import{U as ge}from"./user-check-D5nAARhN.js";import{U as et}from"./user-x-DRVKnuMx.js";import{Z as tt}from"./zap-DjVR6z_V.js";import{Q as be}from"./qr-code-DtmqAAPy.js";import{C as I}from"./calendar-hrTOBv_O.js";import{C as we}from"./clock-DQA8MFeI.js";import{S as he}from"./search-s7xshAGp.js";import{C as st}from"./circle-check-big-BJq8CkBX.js";import{C as at}from"./circle-alert-BcdFzL-g.js";import"./useForwardExpose-CYdwRePy.js";import"./RovingFocusGroup-Dsi-dyvh.js";import"./check-DCQm1Fl6.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=ke("RefreshCwIcon",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=ke("SaveIcon",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),nt={class:"space-y-6 p-6"},ot={class:"flex items-center justify-between"},dt={class:"space-y-2"},rt={class:"text-3xl font-bold tracking-tight"},ut={class:"text-muted-foreground"},it={key:0,class:"flex gap-2"},ct={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},ft={class:"text-2xl font-bold"},mt={class:"text-2xl font-bold text-green-600"},pt={class:"text-xs text-muted-foreground mt-1"},vt={class:"text-green-600"},_t={class:"text-2xl font-bold text-red-600"},xt={class:"text-xs text-muted-foreground mt-1"},yt={class:"text-2xl font-bold"},gt={class:"lg:col-span-1 space-y-6"},bt={key:0,class:"space-y-3"},wt={key:1,class:"space-y-3"},ht={class:"flex gap-2"},kt={key:0,class:"space-y-2"},St={class:"flex items-center space-x-2"},Ct={key:1,class:"space-y-2"},Rt={key:0,class:"text-muted-foreground"},jt={key:1},At={class:"space-y-2"},Et={class:"relative"},Dt={key:2,class:"space-y-3 pt-3 border-t"},Tt={class:"grid grid-cols-2 gap-3"},Vt={class:"space-y-1"},$t={class:"relative"},Nt={class:"space-y-1"},Ut={class:"relative"},Pt={key:3,class:"pt-2 border-t"},Ot={class:"text-sm text-muted-foreground"},Ft={class:"flex justify-between"},Lt={class:"flex justify-between"},zt={class:"text-green-600"},Mt={class:"flex justify-between"},It={class:"text-red-600"},Bt={key:0,class:"flex justify-between"},Xt={class:"flex items-center justify-between"},Ht={class:"space-y-3"},Kt={class:"flex items-center gap-3"},Qt={class:"font-medium"},Jt={class:"text-sm text-muted-foreground"},Gt={class:"flex items-center gap-2"},Zt={key:0,class:"text-center py-8 text-muted-foreground"},qt={class:"flex items-center justify-between"},Wt={class:"flex gap-2"},Yt={class:"space-y-2"},es={class:"relative mb-4"},ts={class:"space-y-2 max-h-96 overflow-y-auto"},ss={class:"flex items-center gap-3"},as={class:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-sm font-medium"},ls={class:"font-medium"},ns={class:"text-sm text-muted-foreground"},os={class:"flex items-center gap-2"},ds={key:0,class:"text-center py-8 text-muted-foreground"},rs={class:"flex items-center justify-between"},us={class:"flex gap-2"},is={class:"space-y-6"},cs={class:"grid grid-cols-5 gap-3"},fs={class:"text-center p-3 bg-blue-50 rounded-lg border border-blue-100"},ms={class:"text-2xl font-bold text-blue-600"},ps={class:"text-center p-3 bg-green-50 rounded-lg border border-green-100"},vs={class:"text-2xl font-bold text-green-600"},_s={class:"text-center p-3 bg-red-50 rounded-lg border border-red-100"},xs={class:"text-2xl font-bold text-red-600"},ys={class:"text-center p-3 bg-yellow-50 rounded-lg border border-yellow-100"},gs={class:"text-2xl font-bold text-yellow-600"},bs={class:"text-center p-3 bg-gray-50 rounded-lg border border-gray-100"},ws={class:"text-2xl font-bold text-gray-600"},hs={class:"flex gap-3"},ks={class:"relative flex-1"},Ss={class:"space-y-2 max-h-80 overflow-y-auto"},Cs={class:"flex items-center gap-4"},Rs={class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium"},js={class:"font-semibold text-gray-900"},As={class:"text-sm text-gray-500"},Es={class:"flex items-center gap-3"},Ds={class:"text-right"},Ts={key:0,class:"text-center py-12 text-muted-foreground"},Vs={class:"text-lg font-semibold mb-2"},$s={class:"text-muted-foreground"},Ns={key:1,class:"space-y-6"},Us={class:"grid gap-4 md:grid-cols-4"},Ps={class:"text-2xl font-bold"},Os={class:"text-2xl font-bold text-green-600"},Fs={class:"text-xs text-muted-foreground mt-1"},Ls={class:"text-green-600"},zs={class:"text-2xl font-bold text-red-600"},Ms={class:"text-xs text-muted-foreground mt-1"},Is={class:"text-2xl font-bold"},Bs={class:"space-y-3"},Xs={class:"flex items-center gap-3"},Hs={class:"font-medium"},Ks={class:"text-sm text-muted-foreground"},Qs={key:0},Js={class:"flex items-center gap-2"},Gs={key:0,class:"text-center py-8 text-muted-foreground"},Zs={class:"flex justify-center py-6"},qs={class:"w-48 h-48 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center"},Ws={class:"text-center text-sm text-muted-foreground"},Ys={class:"space-y-4"},ea={class:"space-y-2"},ta={class:"space-y-2"},Aa=Ie({__name:"Attendance",props:{userRole:{},classes:{default:()=>[]},attendanceStats:{},todaySessions:{default:()=>[]},student:{},attendanceHistory:{default:()=>[]}},setup(Se){const c=Se,E=Be(),Ce=[{title:"Dashboard",href:Ye().url},{title:"Attendance",href:"#"}],p=g(""),y=g(new Date().toISOString().split("T")[0]),D=g(""),B=g("all"),X=g(!1),ae=g(""),S=g(!1),R=g([]),v=g(!1),H=g(!1),G=g(null),P=g(""),Z=g(null),T=g({total:0,present:0,absent:0,excused:0,no_record:0,attendance_rate:0}),V=g(new Date().toISOString().split("T")[0]),$=g(new Date().toISOString().split("T")[0]),q=Xe(()=>{let o=R.value;if(D.value){const e=D.value.toLowerCase();o=o.filter(n=>n.name.toLowerCase().includes(e)||n.studentId.toLowerCase().includes(e))}return B.value&&B.value!=="all"&&(o=o.filter(e=>e.status===B.value)),o}),W=o=>new Date(o).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),O=o=>{var e;return(e=c.classes)==null?void 0:e.find(n=>n.id===o)},Re=async o=>{console.log("Class changed to:",o),D.value="",o&&c.userRole!=="student"&&await Y(o,y.value)},je=async()=>{console.log("Date changed to:",y.value),S.value&&c.userRole==="admin"?await le():p.value&&c.userRole!=="student"&&await Y(p.value,y.value)},Y=async(o,e)=>{try{v.value=!0;const n=await fetch(`/attendance/class/${o}/students?date=${e}`,{method:"GET",headers:{"X-CSRF-TOKEN":E.props.csrf_token,Accept:"application/json"}});if(n.ok){const f=await n.json();R.value=f}else console.error("Failed to load students")}catch(n){console.error("Error loading students:",n)}finally{v.value=!1}},Ae=()=>{if(!p.value){alert("Please select a class first");return}ae.value="SESSION-"+Date.now(),X.value=!0},Ee=()=>{Q.visit("/reports")},De=async()=>{var o;if(!p.value){alert("Please select a class first");return}try{v.value=!0;const e=await fetch("/attendance/export",{method:"POST",headers:{"X-CSRF-TOKEN":E.props.csrf_token,"Content-Type":"application/json",Accept:"text/csv"},body:JSON.stringify({class_id:p.value,start_date:y.value,end_date:y.value,format:"class"})});if(e.ok){const n=await e.blob(),f=window.URL.createObjectURL(n),u=document.createElement("a");u.href=f;const F=e.headers.get("Content-Disposition");let ee="attendance_export.csv";if(F){const te=F.match(/filename="(.+)"/);te&&(ee=te[1])}else ee=`attendance_${(((o=O(p.value))==null?void 0:o.name)||"class").replace(/[^a-zA-Z0-9]/g,"_")}_${y.value}.csv`;u.download=ee,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(f),alert("Attendance data exported successfully!")}else{const n=await e.json().catch(()=>({error:"Export failed"}));alert(n.error||"Export failed. Please try again.")}}catch(e){console.error("Export error:",e),alert("Export failed. Please try again.")}finally{v.value=!1}},Te=(o,e)=>{const n=R.value.find(f=>f.id===o);n&&(n.status=e)},Ve=()=>{R.value.forEach(o=>{o.status="present"})},$e=async()=>{if(!p.value||R.value.length===0){alert("No students to save attendance for");return}try{v.value=!0;const o=await fetch("/attendance/record",{method:"POST",headers:{"X-CSRF-TOKEN":E.props.csrf_token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({class_id:p.value,date:y.value,students:R.value.map(e=>({student_id:e.id,status:e.status,time_in:e.status==="present"?"08:00":null,time_out:e.status==="present"?"10:00":null}))})});if(o.ok){const e=await o.json();alert(e.message)}else{const e=await o.json();alert(e.error||"Failed to save attendance")}}catch(o){console.error("Save error:",o),alert("Failed to save attendance. Please try again.")}finally{v.value=!1}},Ne=async()=>{if(!G.value||!P.value.trim()){alert("Please provide a reason for the excuse");return}try{v.value=!0;const o=new FormData;o.append("attendance_id",G.value.id),o.append("reason",P.value),Z.value&&o.append("supporting_document",Z.value);const e=await fetch("/attendance/excuse",{method:"POST",headers:{"X-CSRF-TOKEN":E.props.csrf_token,Accept:"application/json"},body:o});if(e.ok){const n=await e.json();alert(n.message),H.value=!1,P.value="",Z.value=null,G.value=null,Q.reload()}else{const n=await e.json();alert(n.error||"Failed to submit excuse")}}catch(o){console.error("Excuse submission error:",o),alert("Failed to submit excuse. Please try again.")}finally{v.value=!1}},Ue=()=>{Q.reload()},Pe=o=>{p.value=o.classId,c.userRole!=="student"&&Y(o.classId,y.value)},Oe=()=>{X.value=!1,ae.value="",alert("Attendance session ended")},Fe=o=>{G.value=o,H.value=!0},Le=()=>{S.value=!0,p.value="",le()},ze=()=>{Q.visit("/reports")},Me=async()=>{try{v.value=!0;const o=await fetch("/attendance/export",{method:"POST",headers:{"X-CSRF-TOKEN":E.props.csrf_token,"Content-Type":"application/json",Accept:"text/csv"},body:JSON.stringify({export_all:!0,start_date:y.value,end_date:y.value,format:"system"})});if(o.ok){const e=await o.blob(),n=window.URL.createObjectURL(e),f=document.createElement("a");f.href=n;const u=`system_attendance_${y.value}.csv`;f.download=u,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(n),alert("System attendance data exported successfully!")}else{const e=await o.json().catch(()=>({error:"Export failed"}));alert(e.error||"Export failed. Please try again.")}}catch(o){console.error("Export error:",o),alert("Export failed. Please try again.")}finally{v.value=!1}},le=async()=>{if(c.userRole==="admin")try{v.value=!0;const o=await fetch(`/attendance/system-overview?date=${y.value}`,{method:"GET",headers:{"X-CSRF-TOKEN":E.props.csrf_token,Accept:"application/json"}});if(o.ok){const e=await o.json();R.value=e.students||[],T.value=e.summary||T.value}else console.error("Failed to load system attendance")}catch(o){console.error("Error loading system attendance:",o)}finally{v.value=!1}},ce=()=>{S.value&&c.userRole==="admin"?le():Q.reload()},fe=async()=>{var o;if(!V.value||!$.value){alert("Please select both start and end dates");return}if(new Date(V.value)>new Date($.value)){alert("Start date cannot be after end date");return}try{v.value=!0;const e=await fetch("/attendance/export",{method:"POST",headers:{"X-CSRF-TOKEN":E.props.csrf_token,"Content-Type":"application/json",Accept:"text/csv"},body:JSON.stringify({class_id:p.value||null,start_date:V.value,end_date:$.value,format:p.value?"class":"teacher"})});if(e.ok){const n=await e.blob(),f=window.URL.createObjectURL(n),u=document.createElement("a");u.href=f;let F;p.value?F=`attendance_${(((o=O(p.value))==null?void 0:o.name)||"class").replace(/[^a-zA-Z0-9]/g,"_")}_${V.value}_to_${$.value}.csv`:F=`attendance_all_classes_${V.value}_to_${$.value}.csv`,u.download=F,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(f),alert("Attendance data exported successfully!")}else{const n=await e.json().catch(()=>({error:"Export failed"}));alert(n.error||"Export failed. Please try again.")}}catch(e){console.error("Export error:",e),alert("Export failed. Please try again.")}finally{v.value=!1}};return He(async()=>{c.classes&&c.classes.length>0&&c.userRole!=="student"&&(p.value=c.classes[0].id,await Y(p.value,y.value))}),(o,e)=>(i(),m(L,null,[s(t(Ke),{title:"Attendance"}),s(We,{breadcrumbs:Ce},{default:a(()=>[l("div",nt,[l("div",ot,[l("div",dt,[l("h1",rt,r(c.userRole==="admin"?"System Attendance Management":"Attendance Management"),1),l("p",ut,r(c.userRole==="admin"?"Monitor and manage attendance across all classes and students":"Track, manage, and monitor student attendance for all your classes"),1)]),c.userRole==="admin"?(i(),m("div",it,[s(t(x),{onClick:ce,variant:"outline"},{default:a(()=>[s(t(ie),{class:"h-4 w-4 mr-2"}),e[15]||(e[15]=d(" Refresh Data ",-1))]),_:1,__:[15]}),s(t(x),{onClick:Me},{default:a(()=>[s(t(se),{class:"h-4 w-4 mr-2"}),e[16]||(e[16]=d(" Export All ",-1))]),_:1,__:[16]})])):_("",!0)]),l("div",ct,[s(t(b),null,{default:a(()=>[s(t(h),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(k),{class:"text-sm font-medium"},{default:a(()=>e[17]||(e[17]=[d("Total Students",-1)])),_:1,__:[17]}),s(t(U),{class:"h-5 w-5 text-blue-500"})]),_:1}),s(t(w),null,{default:a(()=>[l("div",ft,r(o.attendanceStats.totalStudents||0),1),e[18]||(e[18]=l("p",{class:"text-xs text-muted-foreground mt-1"}," Across all classes ",-1))]),_:1,__:[18]})]),_:1}),s(t(b),null,{default:a(()=>[s(t(h),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(k),{class:"text-sm font-medium"},{default:a(()=>e[19]||(e[19]=[d("Present Today",-1)])),_:1,__:[19]}),s(t(ge),{class:"h-5 w-5 text-green-500"})]),_:1}),s(t(w),null,{default:a(()=>[l("div",mt,r(o.attendanceStats.presentToday||0),1),l("p",pt,[l("span",vt,r(o.attendanceStats.totalStudents&&o.attendanceStats.presentToday?(o.attendanceStats.presentToday/o.attendanceStats.totalStudents*100).toFixed(1):0)+"%",1),e[20]||(e[20]=d(" attendance rate ",-1))])]),_:1})]),_:1}),s(t(b),null,{default:a(()=>[s(t(h),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(k),{class:"text-sm font-medium"},{default:a(()=>e[21]||(e[21]=[d("Absent Today",-1)])),_:1,__:[21]}),s(t(et),{class:"h-5 w-5 text-red-500"})]),_:1}),s(t(w),null,{default:a(()=>[l("div",_t,r(o.attendanceStats.absentToday||0),1),l("p",xt,r(o.attendanceStats.excusedToday||0)+" excused absences ",1)]),_:1})]),_:1}),s(t(b),null,{default:a(()=>[s(t(h),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(k),{class:"text-sm font-medium"},{default:a(()=>e[22]||(e[22]=[d("Active Classes",-1)])),_:1,__:[22]}),s(t(ne),{class:"h-5 w-5 text-purple-500"})]),_:1}),s(t(w),null,{default:a(()=>[l("div",yt,r(o.attendanceStats.activeClasses||0),1),e[23]||(e[23]=l("p",{class:"text-xs text-muted-foreground mt-1"}," Classes today ",-1))]),_:1,__:[23]})]),_:1})]),c.userRole!=="student"?(i(),m("div",{key:0,class:N(["grid gap-6",c.userRole==="admin"?"lg:grid-cols-4":"lg:grid-cols-3"])},[l("div",gt,[s(t(b),null,{default:a(()=>[s(t(h),null,{default:a(()=>[s(t(k),{class:"flex items-center gap-2"},{default:a(()=>[s(t(tt),{class:"h-5 w-5"}),e[24]||(e[24]=d(" Quick Actions ",-1))]),_:1,__:[24]}),s(t(z),null,{default:a(()=>[d(r(c.userRole==="admin"?"System administration and oversight":"Start attendance or manage students"),1)]),_:1})]),_:1}),s(t(w),{class:"space-y-3"},{default:a(()=>[c.userRole==="admin"?(i(),m("div",bt,[s(t(x),{onClick:Le,class:"w-full justify-start",size:"sm"},{default:a(()=>[s(t(U),{class:"mr-2 h-4 w-4"}),e[25]||(e[25]=d(" All Attendance ",-1))]),_:1,__:[25]}),s(t(x),{onClick:ze,variant:"outline",class:"justify-start w-full",size:"sm"},{default:a(()=>[s(t(Ge),{class:"mr-2 h-4 w-4"}),e[26]||(e[26]=d(" Reports ",-1))]),_:1,__:[26]})])):(i(),m("div",wt,[s(t(x),{onClick:Ae,class:"w-full justify-start",size:"lg"},{default:a(()=>[s(t(be),{class:"mr-2 h-4 w-4"}),e[27]||(e[27]=d(" Start QR Attendance ",-1))]),_:1,__:[27]}),s(t(x),{onClick:Ee,variant:"outline",class:"w-full justify-start",size:"lg"},{default:a(()=>[s(t(Ze),{class:"mr-2 h-4 w-4"}),e[28]||(e[28]=d(" View Reports ",-1))]),_:1,__:[28]}),l("div",ht,[s(t(x),{onClick:De,variant:"outline",class:"flex-1 justify-start",size:"lg",disabled:!p.value||v.value},{default:a(()=>[s(t(se),{class:"mr-2 h-4 w-4"}),d(" "+r(v.value?"Exporting...":"Export Today"),1)]),_:1},8,["disabled"]),s(t(x),{onClick:fe,variant:"outline",class:"flex-1 justify-start",size:"lg",disabled:v.value},{default:a(()=>[s(t(se),{class:"mr-2 h-4 w-4"}),d(" "+r(v.value?"Exporting...":"Export Range"),1)]),_:1},8,["disabled"])])]))]),_:1})]),_:1}),s(t(b),null,{default:a(()=>[s(t(h),null,{default:a(()=>[s(t(k),{class:"flex items-center gap-2"},{default:a(()=>[s(t(ne),{class:"h-5 w-5"}),d(" "+r(c.userRole==="admin"?"Select Class (All System)":"Select Class"),1)]),_:1}),s(t(z),null,{default:a(()=>[d(r(c.userRole==="admin"?"View attendance for any class in the system":"Choose a class to view attendance"),1)]),_:1})]),_:1}),s(t(w),{class:"space-y-3"},{default:a(()=>{var n,f;return[c.userRole==="admin"?(i(),m("div",kt,[s(t(A),{for:"all-classes-toggle"},{default:a(()=>e[29]||(e[29]=[d("View Mode",-1)])),_:1,__:[29]}),l("div",St,[s(t(x),{onClick:e[0]||(e[0]=u=>S.value=!S.value),variant:"outline",size:"sm",class:"w-full"},{default:a(()=>[d(r(S.value?"Show Individual Class":"Show All Classes"),1)]),_:1})])])):_("",!0),!S.value||c.userRole!=="admin"?(i(),m("div",Ct,[s(t(A),{for:"class-select"},{default:a(()=>e[30]||(e[30]=[d("Class",-1)])),_:1,__:[30]}),s(t(oe),{modelValue:p.value,"onUpdate:modelValue":[e[1]||(e[1]=u=>p.value=u),e[2]||(e[2]=u=>Re(u))]},{default:a(()=>[s(t(de),null,{default:a(()=>[s(t(re),{placeholder:"Select a class"})]),_:1}),s(t(ue),null,{default:a(()=>[(i(!0),m(L,null,K(o.classes,u=>(i(),j(t(C),{key:u.id,value:u.id},{default:a(()=>[d(r(u.name)+" ",1),c.userRole==="admin"?(i(),m("span",Rt," ("+r(u.teacher)+") - "+r(u.studentCount)+" students ",1)):(i(),m("span",jt," ("+r(u.studentCount)+" students) ",1))]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])):_("",!0),l("div",At,[s(t(A),{for:"date-select",class:"text-sm font-medium"},{default:a(()=>e[31]||(e[31]=[d("Date",-1)])),_:1,__:[31]}),l("div",Et,[s(t(I),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4 pointer-events-none"}),s(t(M),{type:"date",modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=u=>y.value=u),onChange:je,id:"date-select",class:"pl-10 [&::-webkit-calendar-picker-indicator]:hidden [&::-webkit-calendar-picker-indicator]:absolute [&::-webkit-calendar-picker-indicator]:right-2 [&::-webkit-calendar-picker-indicator]:top-1/2 [&::-webkit-calendar-picker-indicator]:transform [&::-webkit-calendar-picker-indicator]:-translate-y-1/2",placeholder:"Select date"},null,8,["modelValue"])])]),c.userRole!=="student"?(i(),m("div",Dt,[s(t(A),{class:"text-sm font-medium"},{default:a(()=>e[32]||(e[32]=[d("Export Date Range",-1)])),_:1,__:[32]}),l("div",Tt,[l("div",Vt,[s(t(A),{for:"export-start-date",class:"text-xs text-gray-600"},{default:a(()=>e[33]||(e[33]=[d("From Date",-1)])),_:1,__:[33]}),l("div",$t,[s(t(I),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4 pointer-events-none"}),s(t(M),{type:"date",modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=u=>V.value=u),id:"export-start-date",class:"text-sm pl-10 [&::-webkit-calendar-picker-indicator]:opacity-0",placeholder:"Select start date"},null,8,["modelValue"])])]),l("div",Nt,[s(t(A),{for:"export-end-date",class:"text-xs text-gray-600"},{default:a(()=>e[34]||(e[34]=[d("To Date",-1)])),_:1,__:[34]}),l("div",Ut,[s(t(I),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4 pointer-events-none"}),s(t(M),{type:"date",modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=u=>$.value=u),id:"export-end-date",class:"text-sm pl-10 [&::-webkit-calendar-picker-indicator]:opacity-0",placeholder:"Select end date"},null,8,["modelValue"])])])]),s(t(x),{onClick:fe,variant:"outline",size:"sm",class:"w-full mt-2",disabled:v.value},{default:a(()=>[s(t(se),{class:"h-4 w-4 mr-2"}),d(" "+r(v.value?"Exporting...":"Export Range to CSV"),1)]),_:1},8,["disabled"])])):_("",!0),p.value&&!S.value?(i(),m("div",Pt,[l("div",Ot,[l("div",Ft,[e[35]||(e[35]=l("span",null,"Students:",-1)),l("span",null,r(((n=O(p.value))==null?void 0:n.studentCount)||0),1)]),l("div",Lt,[e[36]||(e[36]=l("span",null,"Present:",-1)),l("span",zt,r(R.value.filter(u=>u.status==="present").length),1)]),l("div",Mt,[e[37]||(e[37]=l("span",null,"Absent:",-1)),l("span",It,r(R.value.filter(u=>u.status==="absent").length),1)]),c.userRole==="admin"?(i(),m("div",Bt,[e[38]||(e[38]=l("span",null,"Teacher:",-1)),l("span",null,r(((f=O(p.value))==null?void 0:f.teacher)||"N/A"),1)])):_("",!0)])])):_("",!0)]}),_:1})]),_:1})]),l("div",{class:N([c.userRole==="admin"?"lg:col-span-3":"lg:col-span-2","space-y-6"])},[o.userRole==="teacher"?(i(),j(t(b),{key:0},{default:a(()=>[s(t(h),null,{default:a(()=>[l("div",Xt,[l("div",null,[s(t(k),{class:"flex items-center gap-2"},{default:a(()=>[s(t(we),{class:"h-5 w-5"}),e[39]||(e[39]=d(" Today's Sessions ",-1))]),_:1,__:[39]}),s(t(z),null,{default:a(()=>[d(r(W(y.value)),1)]),_:1})]),s(t(x),{onClick:Ue,variant:"outline",size:"sm"},{default:a(()=>[s(t(ie),{class:"h-4 w-4 mr-1"}),e[40]||(e[40]=d(" Refresh ",-1))]),_:1,__:[40]})])]),_:1}),s(t(w),null,{default:a(()=>[l("div",Ht,[(i(!0),m(L,null,K(o.todaySessions,n=>(i(),m("div",{key:n.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors"},[l("div",Kt,[l("div",{class:N(["w-2 h-2 rounded-full",{"bg-green-500":n.status==="completed","bg-blue-500":n.status==="active","bg-gray-400":n.status==="scheduled"}])},null,2),l("div",null,[l("p",Qt,r(n.className),1),l("p",Jt,r(n.time)+" • "+r(n.presentCount)+"/"+r(n.totalStudents)+" present ",1)])]),l("div",Gt,[s(t(J),{variant:n.status==="completed"?"default":n.status==="active"?"secondary":"outline"},{default:a(()=>[d(r(n.status==="completed"?"Completed":n.status==="active"?"Active":"Scheduled"),1)]),_:2},1032,["variant"]),n.status!=="completed"?(i(),j(t(x),{key:0,onClick:f=>Pe(n),variant:"ghost",size:"sm"},{default:a(()=>[s(t(qe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):_("",!0)])]))),128)),o.todaySessions.length===0?(i(),m("div",Zt,[s(t(I),{class:"mx-auto h-8 w-8 mb-2"}),e[41]||(e[41]=l("p",null,"No sessions scheduled for today",-1))])):_("",!0)])]),_:1})]),_:1})):_("",!0),p.value&&!S.value?(i(),j(t(b),{key:1},{default:a(()=>[s(t(h),null,{default:a(()=>[l("div",qt,[l("div",null,[s(t(k),{class:"flex items-center gap-2"},{default:a(()=>[s(t(U),{class:"h-5 w-5"}),e[42]||(e[42]=d(" Student Attendance ",-1))]),_:1,__:[42]}),s(t(z),null,{default:a(()=>{var n;return[d(r((n=O(p.value))==null?void 0:n.name)+" - "+r(W(y.value)),1)]}),_:1})]),l("div",Wt,[s(t(x),{onClick:Ve,variant:"outline",size:"sm"},{default:a(()=>[s(t(ge),{class:"h-4 w-4 mr-1"}),e[43]||(e[43]=d(" Mark All Present ",-1))]),_:1,__:[43]}),s(t(x),{onClick:$e,size:"sm"},{default:a(()=>[s(t(lt),{class:"h-4 w-4 mr-1"}),e[44]||(e[44]=d(" Save Changes ",-1))]),_:1,__:[44]})])])]),_:1}),s(t(w),null,{default:a(()=>[l("div",Yt,[l("div",es,[s(t(he),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),s(t(M),{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=n=>D.value=n),placeholder:"Search students...",class:"pl-10"},null,8,["modelValue"])]),l("div",ts,[(i(!0),m(L,null,K(q.value,n=>(i(),m("div",{key:n.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors"},[l("div",ss,[l("div",as,r(n.name.charAt(0)),1),l("div",null,[l("p",ls,r(n.name),1),l("p",ns,r(n.studentId),1)])]),l("div",os,[s(t(oe),{modelValue:n.status,"onUpdate:modelValue":[f=>n.status=f,f=>Te(n.id,f)]},{default:a(()=>[s(t(de),{class:"w-32"},{default:a(()=>[s(t(re))]),_:1}),s(t(ue),null,{default:a(()=>[s(t(C),{value:"present"},{default:a(()=>e[45]||(e[45]=[d("Present",-1)])),_:1,__:[45]}),s(t(C),{value:"absent"},{default:a(()=>e[46]||(e[46]=[d("Absent",-1)])),_:1,__:[46]}),s(t(C),{value:"excused"},{default:a(()=>e[47]||(e[47]=[d("Excused",-1)])),_:1,__:[47]}),s(t(C),{value:"late"},{default:a(()=>e[48]||(e[48]=[d("Late",-1)])),_:1,__:[48]})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"]),s(t(J),{class:N({"bg-green-100 text-green-800":n.status==="present","bg-red-100 text-red-800":n.status==="absent","bg-yellow-100 text-yellow-800":n.status==="excused","bg-orange-100 text-orange-800":n.status==="late"})},{default:a(()=>[d(r(n.status),1)]),_:2},1032,["class"])])]))),128))]),q.value.length===0?(i(),m("div",ds,[s(t(U),{class:"mx-auto h-8 w-8 mb-2"}),e[49]||(e[49]=l("p",null,"No students found",-1))])):_("",!0)])]),_:1})]),_:1})):_("",!0),S.value&&c.userRole==="admin"?(i(),j(t(b),{key:2},{default:a(()=>[s(t(h),null,{default:a(()=>[l("div",rs,[l("div",null,[s(t(k),{class:"flex items-center gap-2"},{default:a(()=>[s(t(U),{class:"h-5 w-5"}),e[50]||(e[50]=d(" System Overview ",-1))]),_:1,__:[50]}),s(t(z),null,{default:a(()=>[d("All students - "+r(W(y.value)),1)]),_:1})]),l("div",us,[s(t(x),{onClick:ce,variant:"outline",size:"sm"},{default:a(()=>[s(t(ie),{class:"h-4 w-4"})]),_:1})])])]),_:1}),s(t(w),null,{default:a(()=>[l("div",is,[l("div",cs,[l("div",fs,[l("div",ms,r(T.value.total||0),1),e[51]||(e[51]=l("div",{class:"text-xs text-blue-600 font-medium"},"Total",-1))]),l("div",ps,[l("div",vs,r(T.value.present||0),1),e[52]||(e[52]=l("div",{class:"text-xs text-green-600 font-medium"},"Present",-1))]),l("div",_s,[l("div",xs,r(T.value.absent||0),1),e[53]||(e[53]=l("div",{class:"text-xs text-red-600 font-medium"},"Absent",-1))]),l("div",ys,[l("div",gs,r(T.value.excused||0),1),e[54]||(e[54]=l("div",{class:"text-xs text-yellow-600 font-medium"},"Excused",-1))]),l("div",bs,[l("div",ws,r(T.value.no_record||0),1),e[55]||(e[55]=l("div",{class:"text-xs text-gray-600 font-medium"},"No Record",-1))])]),l("div",hs,[l("div",ks,[s(t(he),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),s(t(M),{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=n=>D.value=n),placeholder:"Search students...",class:"pl-10"},null,8,["modelValue"])]),s(t(oe),{modelValue:B.value,"onUpdate:modelValue":e[8]||(e[8]=n=>B.value=n)},{default:a(()=>[s(t(de),{class:"w-32"},{default:a(()=>[s(t(re),{placeholder:"Status"})]),_:1}),s(t(ue),null,{default:a(()=>[s(t(C),{value:"all"},{default:a(()=>e[56]||(e[56]=[d("All",-1)])),_:1,__:[56]}),s(t(C),{value:"present"},{default:a(()=>e[57]||(e[57]=[d("Present",-1)])),_:1,__:[57]}),s(t(C),{value:"absent"},{default:a(()=>e[58]||(e[58]=[d("Absent",-1)])),_:1,__:[58]}),s(t(C),{value:"excused"},{default:a(()=>e[59]||(e[59]=[d("Excused",-1)])),_:1,__:[59]}),s(t(C),{value:"no-record"},{default:a(()=>e[60]||(e[60]=[d("No Record",-1)])),_:1,__:[60]})]),_:1})]),_:1},8,["modelValue"])]),l("div",Ss,[(i(!0),m(L,null,K(q.value,n=>(i(),m("div",{key:n.id,class:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors bg-white"},[l("div",Cs,[l("div",Rs,r(n.name.charAt(0).toUpperCase()),1),l("div",null,[l("p",js,r(n.name),1),l("p",As,r(n.studentId),1)])]),l("div",Es,[l("div",Ds,[s(t(J),{class:N([{"bg-green-100 text-green-800 border-green-200":n.status==="present","bg-red-100 text-red-800 border-red-200":n.status==="absent","bg-yellow-100 text-yellow-800 border-yellow-200":n.status==="excused","bg-orange-100 text-orange-800 border-orange-200":n.status==="late","bg-gray-100 text-gray-800 border-gray-200":n.status==="no-record"},"font-medium"])},{default:a(()=>[d(r(n.status==="no-record"?"No Record":n.status.charAt(0).toUpperCase()+n.status.slice(1)),1)]),_:2},1032,["class"])])])]))),128))]),q.value.length===0?(i(),m("div",Ts,[s(t(U),{class:"mx-auto h-12 w-12 mb-3 text-gray-300"}),e[61]||(e[61]=l("p",{class:"text-lg font-medium mb-1"},"No students found",-1)),e[62]||(e[62]=l("p",{class:"text-sm"},"Try adjusting your search or filter criteria",-1))])):_("",!0)])]),_:1})]),_:1})):_("",!0),!p.value&&!S.value?(i(),j(t(b),{key:3},{default:a(()=>[s(t(w),{class:"text-center py-12"},{default:a(()=>[s(t(ne),{class:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),l("h3",Vs,r(c.userRole==="admin"?"Select View Mode":"Select a Class"),1),l("p",$s,r(c.userRole==="admin"?"Choose to view individual class attendance or system-wide overview":"Choose a class from the sidebar to view and manage attendance"),1)]),_:1})]),_:1})):_("",!0)],2)],2)):_("",!0),c.userRole==="student"?(i(),m("div",Ns,[l("div",Us,[s(t(b),null,{default:a(()=>[s(t(h),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(k),{class:"text-sm font-medium"},{default:a(()=>e[63]||(e[63]=[d("Total Days",-1)])),_:1,__:[63]}),s(t(I),{class:"h-5 w-5 text-blue-500"})]),_:1}),s(t(w),null,{default:a(()=>[l("div",Ps,r(o.attendanceStats.totalDays||0),1),e[64]||(e[64]=l("p",{class:"text-xs text-muted-foreground mt-1"}," This semester ",-1))]),_:1,__:[64]})]),_:1}),s(t(b),null,{default:a(()=>[s(t(h),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(k),{class:"text-sm font-medium"},{default:a(()=>e[65]||(e[65]=[d("Present Days",-1)])),_:1,__:[65]}),s(t(st),{class:"h-5 w-5 text-green-500"})]),_:1}),s(t(w),null,{default:a(()=>[l("div",Os,r(o.attendanceStats.presentDays||0),1),l("p",Fs,[l("span",Ls,r(o.attendanceStats.attendanceRate||0)+"%",1),e[66]||(e[66]=d(" attendance rate ",-1))])]),_:1})]),_:1}),s(t(b),null,{default:a(()=>[s(t(h),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(k),{class:"text-sm font-medium"},{default:a(()=>e[67]||(e[67]=[d("Absent Days",-1)])),_:1,__:[67]}),s(t(at),{class:"h-5 w-5 text-red-500"})]),_:1}),s(t(w),null,{default:a(()=>[l("div",zs,r(o.attendanceStats.absentDays||0),1),l("p",Ms,r(o.attendanceStats.excusedDays||0)+" excused ",1)]),_:1})]),_:1}),s(t(b),null,{default:a(()=>[s(t(h),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(k),{class:"text-sm font-medium"},{default:a(()=>e[68]||(e[68]=[d("Attendance Rate",-1)])),_:1,__:[68]}),s(t(U),{class:"h-5 w-5 text-purple-500"})]),_:1}),s(t(w),null,{default:a(()=>[l("div",Is,r(o.attendanceStats.attendanceRate||0)+"%",1),e[69]||(e[69]=l("p",{class:"text-xs text-muted-foreground mt-1"}," Overall performance ",-1))]),_:1,__:[69]})]),_:1})]),s(t(b),null,{default:a(()=>[s(t(h),null,{default:a(()=>[s(t(k),{class:"flex items-center gap-2"},{default:a(()=>[s(t(we),{class:"h-5 w-5"}),e[70]||(e[70]=d(" My Attendance History ",-1))]),_:1,__:[70]}),s(t(z),null,{default:a(()=>e[71]||(e[71]=[d("View your attendance records and submit excuses",-1)])),_:1,__:[71]})]),_:1}),s(t(w),null,{default:a(()=>[l("div",Bs,[(i(!0),m(L,null,K(c.attendanceHistory,n=>(i(),m("div",{key:n.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors"},[l("div",Xs,[l("div",{class:N(["w-2 h-2 rounded-full",{"bg-green-500":n.status==="present","bg-red-500":n.status==="absent","bg-yellow-500":n.status==="excused","bg-orange-500":n.status==="late"}])},null,2),l("div",null,[l("p",Hs,r(n.class_name),1),l("p",Ks,[d(r(W(n.date))+" ",1),n.time_in?(i(),m("span",Qs," • "+r(n.time_in),1)):_("",!0)])])]),l("div",Js,[s(t(J),{class:N({"bg-green-100 text-green-800":n.status==="present","bg-red-100 text-red-800":n.status==="absent","bg-yellow-100 text-yellow-800":n.status==="excused","bg-orange-100 text-orange-800":n.status==="late"})},{default:a(()=>[d(r(n.status),1)]),_:2},1032,["class"]),n.status==="absent"&&!n.excuse?(i(),j(t(x),{key:0,onClick:f=>Fe(n),variant:"outline",size:"sm"},{default:a(()=>e[72]||(e[72]=[d(" Submit Excuse ",-1)])),_:2,__:[72]},1032,["onClick"])):_("",!0),n.excuse?(i(),j(t(J),{key:1,variant:n.excuse.status==="approved"?"default":n.excuse.status==="pending"?"secondary":"destructive"},{default:a(()=>[d(" Excuse "+r(n.excuse.status),1)]),_:2},1032,["variant"])):_("",!0)])]))),128)),c.attendanceHistory.length===0?(i(),m("div",Gs,[s(t(I),{class:"mx-auto h-8 w-8 mb-2"}),e[73]||(e[73]=l("p",null,"No attendance records found",-1))])):_("",!0)])]),_:1})]),_:1})])):_("",!0)]),s(t(me),{open:X.value,"onUpdate:open":e[10]||(e[10]=n=>X.value=n)},{default:a(()=>[s(t(pe),{class:"sm:max-w-md"},{default:a(()=>{var n;return[s(t(ve),null,{default:a(()=>[s(t(_e),null,{default:a(()=>e[74]||(e[74]=[d("QR Code Attendance",-1)])),_:1,__:[74]}),s(t(xe),null,{default:a(()=>e[75]||(e[75]=[d(" Students can scan this QR code to mark their attendance ",-1)])),_:1,__:[75]})]),_:1}),l("div",Zs,[l("div",qs,[s(t(be),{class:"h-16 w-16 text-gray-400"})])]),l("div",Ws,[d(" Class: "+r((n=O(p.value))==null?void 0:n.name),1),e[76]||(e[76]=l("br",null,null,-1)),d(" Session ID: "+r(ae.value),1)]),s(t(ye),null,{default:a(()=>[s(t(x),{onClick:e[9]||(e[9]=f=>X.value=!1),variant:"outline"},{default:a(()=>e[77]||(e[77]=[d("Close",-1)])),_:1,__:[77]}),s(t(x),{onClick:Oe},{default:a(()=>e[78]||(e[78]=[d("End Session",-1)])),_:1,__:[78]})]),_:1})]}),_:1})]),_:1},8,["open"]),s(t(me),{open:H.value,"onUpdate:open":e[14]||(e[14]=n=>H.value=n)},{default:a(()=>[s(t(pe),{class:"sm:max-w-md"},{default:a(()=>[s(t(ve),null,{default:a(()=>[s(t(_e),null,{default:a(()=>e[79]||(e[79]=[d("Submit Excuse",-1)])),_:1,__:[79]}),s(t(xe),null,{default:a(()=>e[80]||(e[80]=[d(" Provide a reason for your absence and any supporting documentation ",-1)])),_:1,__:[80]})]),_:1}),l("div",Ys,[l("div",ea,[s(t(A),{for:"excuse-reason"},{default:a(()=>e[81]||(e[81]=[d("Reason for Absence",-1)])),_:1,__:[81]}),Qe(l("textarea",{id:"excuse-reason","onUpdate:modelValue":e[11]||(e[11]=n=>P.value=n),placeholder:"Please explain the reason for your absence...",class:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},null,512),[[Je,P.value]])]),l("div",ta,[s(t(A),{for:"supporting-doc"},{default:a(()=>e[82]||(e[82]=[d("Supporting Document (Optional)",-1)])),_:1,__:[82]}),s(t(M),{id:"supporting-doc",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:e[12]||(e[12]=n=>{var f,u;return Z.value=((u=(f=n.target)==null?void 0:f.files)==null?void 0:u[0])||null})}),e[83]||(e[83]=l("p",{class:"text-xs text-muted-foreground"}," PDF, JPG, JPEG, or PNG files only (max 2MB) ",-1))])]),s(t(ye),null,{default:a(()=>[s(t(x),{onClick:e[13]||(e[13]=n=>H.value=!1),variant:"outline"},{default:a(()=>e[84]||(e[84]=[d("Cancel",-1)])),_:1,__:[84]}),s(t(x),{onClick:Ne,disabled:!P.value.trim()||v.value},{default:a(()=>[d(r(v.value?"Submitting...":"Submit Excuse"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{Aa as default};
