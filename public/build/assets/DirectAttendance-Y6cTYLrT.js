import{d as H,r as p,u as W,c as N,s as Y,a as c,o as m,b as s,e as t,h as Z,w as n,f as a,t as d,i as l,k as I,F as j,g as P}from"./app-DvD5lfuA.js";import{_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-CbPEVQj7.js";import{_ as y,b as x,c as b,d as L,a as h}from"./CardTitle.vue_vue_type_script_setup_true_lang-Bm7dENVJ.js";import{_ as D}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DuW70504.js";import{_ as k}from"./index-D5999L_P.js";import{_ as O}from"./Input.vue_vue_type_script_setup_true_lang-CeFMmzl1.js";import{_ as V}from"./Label.vue_vue_type_script_setup_true_lang-Ex6JluKO.js";import{_ as te,a as se,b as ae,c as ne,d as w}from"./SelectValue.vue_vue_type_script_setup_true_lang-Di0_pmJO.js";import{_ as oe,a as le,b as re,c as de,d as ie}from"./DialogTitle.vue_vue_type_script_setup_true_lang-5cdlHEvD.js";import{E as ue,S as ce,Q as me,f as fe}from"./browser-d8GobmCk.js";import{Q as _e}from"./qr-code-DNXKeNDV.js";import{U as pe}from"./user-B6sdUoqO.js";import{C as E}from"./circle-check-big-9LvJLBJS.js";import{C as T}from"./circle-x-da156FXW.js";import{L as ge}from"./loader-circle-CasON-xX.js";import"./useForwardExpose-DrilU4Ay.js";import"./users-DghIYMBj.js";import"./RovingFocusGroup-BIwBOwvo.js";import"./check-ByxtUOfk.js";import"./vue-qrcode-reader-3EwTCL0Z.js";import"./RovingFocusItem-b-OKAiZI.js";import"./Textarea.vue_vue_type_script_setup_true_lang-CF52yOxX.js";import"./zap-7qzh3ink.js";import"./circle-alert-w4YxOQLP.js";import"./hash-Ds39kE9S.js";import"./calendar-BcsYx6v_.js";const ve={class:"container mx-auto p-6 space-y-6"},ye={class:"space-y-2"},xe={class:"flex items-center justify-between"},be={class:"text-muted-foreground"},he={class:"grid gap-4 sm:gap-6 grid-cols-1 md:grid-cols-2"},ke={class:"flex gap-2"},we={class:"space-y-2"},Se={class:"space-y-2"},Ce={class:"space-y-2"},$e={class:"grid gap-6 lg:grid-cols-2"},Qe={class:"space-y-3 max-h-80 overflow-y-auto"},Re={class:"flex-1 min-w-0"},Ae={class:"font-medium text-gray-900 truncate"},Fe={class:"text-sm text-green-700 font-mono"},Ie={key:0,class:"text-center py-8 text-muted-foreground"},je={class:"space-y-3 max-h-80 overflow-y-auto"},De={class:"flex-1 min-w-0"},Ve={class:"font-medium text-gray-900 truncate"},Ee={class:"text-sm text-red-700 font-mono"},Ne={key:0,class:"text-center py-8 text-muted-foreground"},Pe={key:0,class:"flex items-center justify-center py-8"},Le={key:1,class:"space-y-6"},Oe={class:"text-center"},Te={class:"font-semibold text-lg"},Ue={class:"text-sm text-gray-600"},qe={class:"flex flex-col items-center space-y-4"},Me={class:"w-64 h-64 bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center"},Be=["src"],Je={class:"bg-gray-50 rounded-lg p-4"},Xe={class:"grid grid-cols-2 gap-4 text-center"},Ge={class:"text-2xl font-bold text-green-600"},Ke={class:"text-2xl font-bold text-gray-600"},ht=H({__name:"DirectAttendance",props:{teacher:{},classInfo:{},session:{},students:{},attendance_records:{}},setup(U){const i=U,q=[{title:"Teacher Dashboard",href:"/teacher/dashboard"},{title:"Classes",href:"/teacher/classes"},{title:"Direct Attendance",href:"#"}],S=p(!1),C=p(!1),$=p(""),Q=p(!1),f=p({present:0,total:i.students.length}),u=W({student_id:"",name:"",status:"present"}),g=N(()=>i.students.filter(o=>i.attendance_records.includes(o.id))),R=N(()=>i.students.filter(o=>!i.attendance_records.includes(o.id))),A=()=>{f.value.present=g.value.length},M=async()=>{if(i.session?.qr_code)try{Q.value=!0;const o={session_id:i.session.id,class_id:i.classInfo.id,timestamp:Date.now()};$.value=await fe.toDataURL(JSON.stringify(o),{width:300,margin:2,color:{dark:"#000000",light:"#FFFFFF"}})}catch(o){console.error("Error generating QR code:",o)}finally{Q.value=!1}},B=()=>{C.value=!0},J=()=>{C.value=!1},X=async o=>{},G=async o=>{try{const e=o.map(async _=>(await fetch(`/teacher/attendance/${i.session.id}/mark`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({student_id:_.student_id,status:"present",method:"qr"})})).json()),F=(await Promise.all(e)).filter(_=>_.success).length;o.forEach(_=>{const v=i.students.find(z=>z.student_id===_.student_id);v&&!i.attendance_records.includes(v.id)&&i.attendance_records.push(v.id)}),A(),F>0?alert(`✅ ${F} student${F>1?"s":""} marked as present`):alert("❌ Failed to mark attendance for any students")}catch(e){console.error("Error marking batch attendance:",e),alert("Failed to mark attendance")}},K=async()=>{if(!u.student_id&&!u.name){alert("Please enter student ID or name");return}try{const e=await(await fetch(`/teacher/attendance/${i.session.id}/mark`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({student_id:u.student_id,name:u.name,status:u.status,method:"manual"})})).json();if(e.success){const r=e.student.id;i.attendance_records.includes(r)||(i.attendance_records.push(r),A()),alert("✅ Attendance marked successfully"),u.reset()}else alert(`❌ ${e.message}`)}catch(o){console.error("Error marking attendance:",o),alert("Failed to mark attendance")}};return Y(()=>{A(),M()}),(o,e)=>(m(),c(j,null,[s(t(Z),{title:"Direct Attendance"}),s(ee,{breadcrumbs:q},{default:n(()=>[a("div",ve,[a("div",ye,[a("div",xe,[a("div",null,[e[5]||(e[5]=a("h1",{class:"text-3xl font-bold tracking-tight"},"Direct Attendance",-1)),a("p",be,d(o.classInfo.name)+" • "+d(o.classInfo.course)+" - "+d(o.classInfo.section),1)]),s(t(k),{variant:"default",class:"text-sm"},{default:n(()=>[l(d(f.value.present)+"/"+d(f.value.total)+" Present ",1)]),_:1})])]),a("div",he,[s(t(y),null,{default:n(()=>[s(t(x),{class:"text-center"},{default:n(()=>[s(t(_e),{class:"h-12 w-12 mx-auto mb-2 text-primary"}),s(t(b),null,{default:n(()=>e[6]||(e[6]=[l("QR Code Attendance",-1)])),_:1,__:[6]}),s(t(L),null,{default:n(()=>e[7]||(e[7]=[l(" Students scan QR code with their phones to mark attendance ",-1)])),_:1,__:[7]})]),_:1}),s(t(h),{class:"space-y-4"},{default:n(()=>[a("div",ke,[s(t(D),{onClick:e[0]||(e[0]=r=>S.value=!0),class:"flex-1"},{default:n(()=>[s(t(ue),{class:"h-4 w-4 mr-2"}),e[8]||(e[8]=l(" Show QR Code ",-1))]),_:1,__:[8]}),s(t(D),{onClick:B,variant:"outline",class:"flex-1"},{default:n(()=>[s(t(ce),{class:"h-4 w-4 mr-2"}),e[9]||(e[9]=l(" Scan Student QR ",-1))]),_:1,__:[9]})])]),_:1})]),_:1}),s(t(y),null,{default:n(()=>[s(t(x),{class:"text-center"},{default:n(()=>[s(t(pe),{class:"h-12 w-12 mx-auto mb-2 text-primary"}),s(t(b),null,{default:n(()=>e[10]||(e[10]=[l("Manual Input",-1)])),_:1,__:[10]}),s(t(L),null,{default:n(()=>e[11]||(e[11]=[l(" Manually enter student information to mark attendance ",-1)])),_:1,__:[11]})]),_:1}),s(t(h),{class:"space-y-4"},{default:n(()=>[a("div",we,[s(t(V),{for:"student_id"},{default:n(()=>e[12]||(e[12]=[l("Student ID",-1)])),_:1,__:[12]}),s(t(O),{id:"student_id",modelValue:t(u).student_id,"onUpdate:modelValue":e[1]||(e[1]=r=>t(u).student_id=r),placeholder:"Enter student ID"},null,8,["modelValue"])]),a("div",Se,[s(t(V),{for:"name"},{default:n(()=>e[13]||(e[13]=[l("Or Student Name",-1)])),_:1,__:[13]}),s(t(O),{id:"name",modelValue:t(u).name,"onUpdate:modelValue":e[2]||(e[2]=r=>t(u).name=r),placeholder:"Enter student name"},null,8,["modelValue"])]),a("div",Ce,[s(t(V),{for:"status"},{default:n(()=>e[14]||(e[14]=[l("Status",-1)])),_:1,__:[14]}),s(t(te),{modelValue:t(u).status,"onUpdate:modelValue":e[3]||(e[3]=r=>t(u).status=r)},{default:n(()=>[s(t(se),null,{default:n(()=>[s(t(ae))]),_:1}),s(t(ne),null,{default:n(()=>[s(t(w),{value:"present"},{default:n(()=>e[15]||(e[15]=[l("Present",-1)])),_:1,__:[15]}),s(t(w),{value:"late"},{default:n(()=>e[16]||(e[16]=[l("Late",-1)])),_:1,__:[16]}),s(t(w),{value:"absent"},{default:n(()=>e[17]||(e[17]=[l("Absent",-1)])),_:1,__:[17]}),s(t(w),{value:"excused"},{default:n(()=>e[18]||(e[18]=[l("Excused",-1)])),_:1,__:[18]})]),_:1})]),_:1},8,["modelValue"])]),s(t(D),{onClick:K,class:"w-full",disabled:t(u).processing},{default:n(()=>[s(t(E),{class:"h-4 w-4 mr-2"}),e[19]||(e[19]=l(" Mark Attendance ",-1))]),_:1,__:[19]},8,["disabled"])]),_:1})]),_:1})]),a("div",$e,[s(t(y),{class:"h-fit"},{default:n(()=>[s(t(x),{class:"pb-3"},{default:n(()=>[s(t(b),{class:"flex items-center gap-2 text-green-700"},{default:n(()=>[s(t(E),{class:"h-5 w-5"}),l(" Present Students ("+d(g.value.length)+") ",1)]),_:1})]),_:1}),s(t(h),null,{default:n(()=>[a("div",Qe,[(m(!0),c(j,null,P(g.value,r=>(m(),c("div",{key:r.id,class:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors"},[a("div",Re,[a("p",Ae,d(r.name),1),a("p",Fe,d(r.student_id),1)]),s(t(k),{variant:"secondary",class:"bg-green-100 text-green-800 border-green-200 shrink-0"},{default:n(()=>e[20]||(e[20]=[l(" Present ",-1)])),_:1,__:[20]})]))),128)),g.value.length===0?(m(),c("div",Ie,[s(t(E),{class:"h-12 w-12 mx-auto mb-3 opacity-30"}),e[21]||(e[21]=a("p",{class:"font-medium"},"No students marked present yet",-1)),e[22]||(e[22]=a("p",{class:"text-sm"},"Use the QR scanner to mark attendance",-1))])):I("",!0)])]),_:1})]),_:1}),s(t(y),{class:"h-fit"},{default:n(()=>[s(t(x),{class:"pb-3"},{default:n(()=>[s(t(b),{class:"flex items-center gap-2 text-red-700"},{default:n(()=>[s(t(T),{class:"h-5 w-5"}),l(" Absent Students ("+d(R.value.length)+") ",1)]),_:1})]),_:1}),s(t(h),null,{default:n(()=>[a("div",je,[(m(!0),c(j,null,P(R.value,r=>(m(),c("div",{key:r.id,class:"flex items-center justify-between p-3 bg-red-50 border border-red-200 rounded-lg hover:bg-red-100 transition-colors"},[a("div",De,[a("p",Ve,d(r.name),1),a("p",Ee,d(r.student_id),1)]),s(t(k),{variant:"secondary",class:"bg-red-100 text-red-800 border-red-200 shrink-0"},{default:n(()=>e[23]||(e[23]=[l(" Absent ",-1)])),_:1,__:[23]})]))),128)),R.value.length===0?(m(),c("div",Ne,[s(t(T),{class:"h-12 w-12 mx-auto mb-3 opacity-30"}),e[24]||(e[24]=a("p",{class:"font-medium"},"All students are present!",-1)),e[25]||(e[25]=a("p",{class:"text-sm"},"Great job on attendance",-1))])):I("",!0)])]),_:1})]),_:1})])]),s(t(oe),{open:S.value,"onUpdate:open":e[4]||(e[4]=r=>S.value=r)},{default:n(()=>[s(t(le),{class:"max-w-md"},{default:n(()=>[s(t(re),null,{default:n(()=>[s(t(de),null,{default:n(()=>e[26]||(e[26]=[l("Attendance QR Code",-1)])),_:1,__:[26]}),s(t(ie),null,{default:n(()=>e[27]||(e[27]=[l(" Students can scan this QR code to mark their attendance ",-1)])),_:1,__:[27]})]),_:1}),Q.value?(m(),c("div",Pe,[s(t(ge),{class:"h-8 w-8 animate-spin"})])):$.value?(m(),c("div",Le,[a("div",Oe,[a("h3",Te,d(o.classInfo.name),1),a("p",Ue,d(o.classInfo.section)+" • "+d(o.classInfo.course),1),s(t(k),{variant:"default",class:"mt-2"},{default:n(()=>[l(d(o.session.status),1)]),_:1})]),a("div",qe,[a("div",Me,[a("img",{src:$.value,alt:"Attendance QR Code",class:"w-full h-full object-contain"},null,8,Be)])]),e[31]||(e[31]=a("div",{class:"bg-blue-50 rounded-lg p-4"},[a("h4",{class:"font-medium text-blue-900 mb-2"},"Instructions for Students:"),a("ol",{class:"text-sm text-blue-800 space-y-1"},[a("li",null,"1. Open your camera app or QR code scanner"),a("li",null,"2. Point your camera at the QR code above"),a("li",null,"3. Tap the notification or link that appears"),a("li",null,"4. Confirm your attendance on the webpage")])],-1)),a("div",Je,[e[30]||(e[30]=a("h4",{class:"font-medium text-gray-900 mb-3"},"Live Attendance Count",-1)),a("div",Xe,[a("div",null,[a("div",Ge,d(f.value.present),1),e[28]||(e[28]=a("div",{class:"text-sm text-gray-600"},"Present",-1))]),a("div",null,[a("div",Ke,d(f.value.total-f.value.present),1),e[29]||(e[29]=a("div",{class:"text-sm text-gray-600"},"Absent",-1))])])])])):I("",!0)]),_:1})]),_:1},8,["open"]),s(me,{show:C.value,onClose:J,onScanSuccess:X,onBatchScanSuccess:G},null,8,["show"])]),_:1})],64))}});export{ht as default};
