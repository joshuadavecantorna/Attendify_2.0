import{d as ae,r as m,s as le,a as f,o as i,b as s,e as t,h as oe,w as a,f as l,i as n,t as u,v as D,z as N,F as q,g as U,j as ne,k as V,G as C,m as F}from"./app-DvD5lfuA.js";import{_ as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-CbPEVQj7.js";import{_ as g,b,c as y,a as x,d as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-Bm7dENVJ.js";import{_ as w}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DuW70504.js";import{_ as ue}from"./index-D5999L_P.js";import{_ as ie}from"./Separator.vue_vue_type_script_setup_true_lang-Cy23tokA.js";import{_ as de}from"./Input.vue_vue_type_script_setup_true_lang-CeFMmzl1.js";import{_ as k}from"./Label.vue_vue_type_script_setup_true_lang-Ex6JluKO.js";import{_ as P}from"./Textarea.vue_vue_type_script_setup_true_lang-CF52yOxX.js";import{_ as B,a as L,b as T,c as z,d as G}from"./DialogTitle.vue_vue_type_script_setup_true_lang-5cdlHEvD.js";import{_ as O}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CZZ9sw84.js";import"./useForwardExpose-DrilU4Ay.js";import"./users-DghIYMBj.js";import"./RovingFocusGroup-BIwBOwvo.js";const fe={class:"container mx-auto p-6 space-y-6"},ce={class:"grid gap-3 sm:gap-4 grid-cols-2 md:grid-cols-4"},pe={class:"text-2xl font-bold"},me={class:"text-2xl font-bold text-yellow-600"},ve={class:"text-2xl font-bold text-green-600"},_e={class:"text-2xl font-bold text-red-600"},ge={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},xe={class:"space-y-2"},be={class:"space-y-2"},ye=["value"],we={class:"space-y-2"},Re={key:0,class:"p-8 text-center text-muted-foreground"},ke={key:1,class:"p-8 text-center text-muted-foreground"},je={key:2,class:"space-y-4"},$e={class:"flex justify-between items-start mb-4"},he={class:"text-lg font-medium mb-2"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},Se={class:"space-y-2"},Ae={class:"space-y-2"},qe={key:0},Ve={key:1},Ee={class:"flex flex-col sm:flex-row gap-2 justify-between items-start sm:items-center"},De=["href"],Ne={key:0,class:"flex space-x-2"},Ue={key:1,class:"text-sm text-muted-foreground"},Fe={class:"space-y-4"},Me={class:"space-y-2"},Pe={class:"space-y-4"},Be={class:"space-y-2"},et=ae({__name:"ExcuseRequests",props:{teacher:{},requests:{},classes:{}},setup(H){const E=H,I=m([{title:"Dashboard",href:"/teacher/dashboard"},{title:"Excuse Requests",href:"/teacher/excuse-requests"}]),S=m(!1),p=m(!1),j=m(!1),$=m(!1),v=m(null),c=m(""),d=m({status:"",class_id:"",search:""}),_=m(E.requests),A=m(E.classes||[]),R=async()=>{S.value=!0;try{const r=new URLSearchParams;d.value.status&&r.append("status",d.value.status),d.value.class_id&&r.append("class_id",d.value.class_id),d.value.search&&r.append("search",d.value.search);const e=await C.get(`/teacher/excuse-requests?${r}`);_.value=e.data.requests}catch(r){console.error("Error fetching requests:",r)}finally{S.value=!1}},J=(()=>{let r;return()=>{clearTimeout(r),r=setTimeout(R,500)}})(),K=r=>{v.value=r,c.value="",j.value=!0},Q=r=>{v.value=r,c.value="",$.value=!0},h=()=>{j.value=!1,$.value=!1,v.value=null,c.value=""},W=async()=>{if(v.value){p.value=!0;try{await C.post(`/teacher/excuse-requests/${v.value.id}/approve`,{review_notes:c.value}),h(),R(),F.visit(window.location.pathname,{method:"get",data:{},preserveState:!0,preserveScroll:!0,onSuccess:()=>{}})}catch(r){console.error("Error approving request:",r),alert("Failed to approve request. Please try again.")}finally{p.value=!1}}},X=async()=>{if(!(!v.value||!c.value.trim())){p.value=!0;try{await C.post(`/teacher/excuse-requests/${v.value.id}/reject`,{review_notes:c.value}),h(),R(),F.visit(window.location.pathname,{method:"get",data:{},preserveState:!0,preserveScroll:!0,onSuccess:()=>{}})}catch(r){console.error("Error rejecting request:",r),alert("Failed to reject request. Please try again.")}finally{p.value=!1}}},Y=r=>{switch(r){case"pending":return"secondary";case"approved":return"default";case"rejected":return"destructive";default:return"outline"}},Z=r=>new Date(r).toLocaleDateString(),ee=r=>new Date(r).toLocaleString(),te=async()=>{try{const r=await C.get("/teacher/classes");A.value=r.data.classes||[]}catch(r){console.error("Error fetching classes:",r)}};return le(()=>{A.value.length===0&&te()}),(r,e)=>(i(),f(q,null,[s(t(oe),{title:"Excuse Requests"}),s(re,{breadcrumbs:I.value},{default:a(()=>[l("div",fe,[e[37]||(e[37]=l("div",{class:"space-y-2"},[l("h1",{class:"text-3xl font-bold tracking-tight"},"Excuse Requests"),l("p",{class:"text-muted-foreground"}," Review and manage student excuse requests for your classes ")],-1)),l("div",ce,[s(t(g),null,{default:a(()=>[s(t(b),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(y),{class:"text-sm font-medium"},{default:a(()=>e[7]||(e[7]=[n("Total Requests",-1)])),_:1,__:[7]}),e[8]||(e[8]=l("span",{class:"text-xl"},"ðŸ“‹",-1))]),_:1,__:[8]}),s(t(x),null,{default:a(()=>[l("div",pe,u(_.value.total),1),e[9]||(e[9]=l("p",{class:"text-xs text-muted-foreground mt-1"}," All requests ",-1))]),_:1,__:[9]})]),_:1}),s(t(g),null,{default:a(()=>[s(t(b),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(y),{class:"text-sm font-medium"},{default:a(()=>e[10]||(e[10]=[n("Pending",-1)])),_:1,__:[10]}),e[11]||(e[11]=l("span",{class:"text-xl"},"â³",-1))]),_:1,__:[11]}),s(t(x),null,{default:a(()=>[l("div",me,u(_.value.data.filter(o=>o.status==="pending").length),1),e[12]||(e[12]=l("p",{class:"text-xs text-muted-foreground mt-1"}," Awaiting review ",-1))]),_:1,__:[12]})]),_:1}),s(t(g),null,{default:a(()=>[s(t(b),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(y),{class:"text-sm font-medium"},{default:a(()=>e[13]||(e[13]=[n("Approved",-1)])),_:1,__:[13]}),e[14]||(e[14]=l("span",{class:"text-xl"},"âœ…",-1))]),_:1,__:[14]}),s(t(x),null,{default:a(()=>[l("div",ve,u(_.value.data.filter(o=>o.status==="approved").length),1),e[15]||(e[15]=l("p",{class:"text-xs text-muted-foreground mt-1"}," Approved requests ",-1))]),_:1,__:[15]})]),_:1}),s(t(g),null,{default:a(()=>[s(t(b),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(y),{class:"text-sm font-medium"},{default:a(()=>e[16]||(e[16]=[n("Rejected",-1)])),_:1,__:[16]}),e[17]||(e[17]=l("span",{class:"text-xl"},"âŒ",-1))]),_:1,__:[17]}),s(t(x),null,{default:a(()=>[l("div",_e,u(_.value.data.filter(o=>o.status==="rejected").length),1),e[18]||(e[18]=l("p",{class:"text-xs text-muted-foreground mt-1"}," Rejected requests ",-1))]),_:1,__:[18]})]),_:1})]),s(t(g),null,{default:a(()=>[s(t(b),null,{default:a(()=>[s(t(y),null,{default:a(()=>e[19]||(e[19]=[n("Filters",-1)])),_:1,__:[19]}),s(t(M),null,{default:a(()=>e[20]||(e[20]=[n("Filter excuse requests by status, class, or student name",-1)])),_:1,__:[20]})]),_:1}),s(t(x),null,{default:a(()=>[l("div",ge,[l("div",xe,[s(t(k),{for:"status-filter"},{default:a(()=>e[21]||(e[21]=[n("Status",-1)])),_:1,__:[21]}),D(l("select",{id:"status-filter","onUpdate:modelValue":e[0]||(e[0]=o=>d.value.status=o),onChange:R,class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},e[22]||(e[22]=[l("option",{value:""},"All Status",-1),l("option",{value:"pending"},"Pending",-1),l("option",{value:"approved"},"Approved",-1),l("option",{value:"rejected"},"Rejected",-1)]),544),[[N,d.value.status]])]),l("div",be,[s(t(k),{for:"class-filter"},{default:a(()=>e[23]||(e[23]=[n("Class",-1)])),_:1,__:[23]}),D(l("select",{id:"class-filter","onUpdate:modelValue":e[1]||(e[1]=o=>d.value.class_id=o),onChange:R,class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},[e[24]||(e[24]=l("option",{value:""},"All Classes",-1)),(i(!0),f(q,null,U(A.value,o=>(i(),f("option",{key:o.id,value:o.id.toString()},u(o.name)+" - "+u(o.course),9,ye))),128))],544),[[N,d.value.class_id]])]),l("div",we,[s(t(k),{for:"search-filter"},{default:a(()=>e[25]||(e[25]=[n("Search",-1)])),_:1,__:[25]}),s(t(de),{id:"search-filter",modelValue:d.value.search,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.search=o),onInput:t(J),type:"text",placeholder:"Search by student name...",class:"w-full"},null,8,["modelValue","onInput"])])])]),_:1})]),_:1}),s(t(g),null,{default:a(()=>[s(t(b),null,{default:a(()=>[s(t(y),null,{default:a(()=>e[26]||(e[26]=[n("Excuse Requests",-1)])),_:1,__:[26]}),s(t(M),null,{default:a(()=>e[27]||(e[27]=[n("Review and manage student excuse requests",-1)])),_:1,__:[27]})]),_:1}),s(t(x),null,{default:a(()=>[S.value?(i(),f("div",Re," Loading requests... ")):_.value.data.length===0?(i(),f("div",ke," No excuse requests to review at this time. ")):(i(),f("div",je,[(i(!0),f(q,null,U(_.value.data,o=>(i(),ne(t(g),{key:o.id,class:"transition-all hover:shadow-md"},{default:a(()=>[s(t(x),{class:"p-6"},{default:a(()=>[l("div",$e,[l("div",null,[l("h3",he,u(o.student.name),1),s(t(ue),{variant:Y(o.status),class:"mb-3"},{default:a(()=>[n(u(o.status.charAt(0).toUpperCase()+o.status.slice(1)),1)]),_:2},1032,["variant"])])]),l("div",Ce,[l("div",Se,[l("p",null,[e[28]||(e[28]=l("span",{class:"font-medium"},"Student ID:",-1)),n(" "+u(o.student.student_id),1)]),l("p",null,[e[29]||(e[29]=l("span",{class:"font-medium"},"Class:",-1)),n(" "+u(o.attendance_session.class.name)+" - "+u(o.attendance_session.class.course),1)]),l("p",null,[e[30]||(e[30]=l("span",{class:"font-medium"},"Session:",-1)),n(" "+u(o.attendance_session.session_name),1)]),l("p",null,[e[31]||(e[31]=l("span",{class:"font-medium"},"Date:",-1)),n(" "+u(Z(o.attendance_session.session_date)),1)])]),l("div",Ae,[l("p",null,[e[32]||(e[32]=l("span",{class:"font-medium"},"Reason:",-1)),n(" "+u(o.reason),1)]),o.review_notes?(i(),f("p",qe,[e[33]||(e[33]=l("span",{class:"font-medium"},"Review Notes:",-1)),n(" "+u(o.review_notes),1)])):V("",!0),o.reviewed_at?(i(),f("p",Ve,[e[34]||(e[34]=l("span",{class:"font-medium"},"Reviewed:",-1)),n(" "+u(ee(o.reviewed_at)),1)])):V("",!0)])]),s(t(ie),{class:"my-4"}),l("div",Ee,[l("div",null,[o.attachment_path?(i(),f("a",{key:0,href:`/teacher/excuse-requests/${o.id}/download-attachment`,target:"_blank",class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"}," ðŸ“Ž Download Attachment ",8,De)):V("",!0)]),o.status==="pending"?(i(),f("div",Ne,[s(t(w),{onClick:se=>K(o),variant:"default",size:"sm",class:"bg-green-600 hover:bg-green-700"},{default:a(()=>e[35]||(e[35]=[n(" âœ“ Approve ",-1)])),_:2,__:[35]},1032,["onClick"]),s(t(w),{onClick:se=>Q(o),variant:"destructive",size:"sm"},{default:a(()=>e[36]||(e[36]=[n(" âœ— Reject ",-1)])),_:2,__:[36]},1032,["onClick"])])):(i(),f("div",Ue,u(o.status==="approved"?"âœ“ Approved":"âœ— Rejected"),1))])]),_:2},1024)]),_:2},1024))),128))]))]),_:1})]),_:1})]),s(t(B),{open:j.value,"onUpdate:open":e[4]||(e[4]=o=>j.value=o)},{default:a(()=>[s(t(L),{class:"sm:max-w-md"},{default:a(()=>[s(t(T),null,{default:a(()=>[s(t(z),null,{default:a(()=>e[38]||(e[38]=[n("Approve Excuse Request",-1)])),_:1,__:[38]}),s(t(G),null,{default:a(()=>[n(" Are you sure you want to approve this excuse request from "+u(v.value?.student?.name)+"? ",1)]),_:1})]),_:1}),l("div",Fe,[l("div",Me,[s(t(k),{for:"approve-notes"},{default:a(()=>e[39]||(e[39]=[n("Review Notes (Optional)",-1)])),_:1,__:[39]}),s(t(P),{id:"approve-notes",modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),rows:"3",placeholder:"Add any notes about your approval..."},null,8,["modelValue"])])]),s(t(O),null,{default:a(()=>[s(t(w),{variant:"outline",onClick:h,disabled:p.value},{default:a(()=>e[40]||(e[40]=[n(" Cancel ",-1)])),_:1,__:[40]},8,["disabled"]),s(t(w),{onClick:W,disabled:p.value,class:"bg-green-600 hover:bg-green-700"},{default:a(()=>[n(u(p.value?"Approving...":"Approve"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),s(t(B),{open:$.value,"onUpdate:open":e[6]||(e[6]=o=>$.value=o)},{default:a(()=>[s(t(L),{class:"sm:max-w-md"},{default:a(()=>[s(t(T),null,{default:a(()=>[s(t(z),null,{default:a(()=>e[41]||(e[41]=[n("Reject Excuse Request",-1)])),_:1,__:[41]}),s(t(G),null,{default:a(()=>[n(" Are you sure you want to reject this excuse request from "+u(v.value?.student?.name)+"? ",1)]),_:1})]),_:1}),l("div",Pe,[l("div",Be,[s(t(k),{for:"reject-notes"},{default:a(()=>e[42]||(e[42]=[n("Review Notes (Required)",-1)])),_:1,__:[42]}),s(t(P),{id:"reject-notes",modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=o=>c.value=o),rows:"3",placeholder:"Please provide a reason for rejection...",required:""},null,8,["modelValue"])])]),s(t(O),null,{default:a(()=>[s(t(w),{variant:"outline",onClick:h,disabled:p.value},{default:a(()=>e[43]||(e[43]=[n(" Cancel ",-1)])),_:1,__:[43]},8,["disabled"]),s(t(w),{variant:"destructive",onClick:X,disabled:p.value||!c.value.trim()},{default:a(()=>[n(u(p.value?"Rejecting...":"Reject"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1},8,["breadcrumbs"])],64))}});export{et as default};
