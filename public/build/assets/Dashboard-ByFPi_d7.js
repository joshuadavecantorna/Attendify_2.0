import{_ as be}from"./AppLayout.vue_vue_type_script_setup_true_lang-BS7ImaE2.js";import{d as Ce,q as ye,c as P,r as b,C as we,a as _,o as d,b as s,e as t,h as he,w as a,f as l,i as n,t as u,F as E,g as T,n as ke,j as N,l as Se,k as j,m as X}from"./app-DW-4G1vZ.js";import{_ as C,b as y,c as w,a as h,d as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-BcDEr4TB.js";import{_ as Y}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-T0P3N6mj.js";import{_ as $e}from"./index-r1g3ib2J.js";import{_ as H,a as J,b as W,c as K,d as G}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B2g3MDQd.js";import{_ as Z,a as ee,b as te,c as se,d as B}from"./SelectValue.vue_vue_type_script_setup_true_lang-DqZ9_JK4.js";import{_ as Re}from"./Input.vue_vue_type_script_setup_true_lang-DnmVy0AL.js";import{_ as U}from"./Label.vue_vue_type_script_setup_true_lang-PYw3eRzO.js";import{C as De,I as Pe}from"./vue-qrcode-reader-DmduyMv5.js";import{C as ae}from"./circle-check-big-BJq8CkBX.js";import{C as le}from"./circle-x-DdLfTClc.js";import{C as M}from"./circle-alert-BcdFzL-g.js";import{Q as oe}from"./qr-code-DtmqAAPy.js";import{C as Ee}from"./clock-DQA8MFeI.js";import"./useForwardExpose-CYdwRePy.js";import"./users-BhZaHBdP.js";import"./RovingFocusGroup-Dsi-dyvh.js";import"./check-DCQm1Fl6.js";const Ne={class:"flex h-full flex-1 flex-col gap-6 p-6"},je={class:"text-3xl font-bold"},Qe={class:"text-blue-600"},qe={class:"text-muted-foreground"},Ae={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},Te={class:"text-2xl font-bold text-green-600"},Ve={class:"text-xs text-muted-foreground"},Fe={class:"text-2xl font-bold text-red-600"},Ie={class:"text-xs text-muted-foreground"},ze={class:"text-2xl font-bold text-yellow-600"},Ye={class:"text-xs text-muted-foreground"},Be={class:"grid gap-4 md:grid-cols-2"},Ue={class:"bg-white dark:bg-gray-800 rounded-md p-3 font-mono text-sm border"},Me={class:"space-y-3"},Le={key:0},Oe={class:"space-y-1"},Xe={class:"font-medium"},He={class:"text-sm text-muted-foreground"},Je={class:"text-sm text-muted-foreground"},We={class:"text-right"},Ke={class:"text-sm font-medium"},Ge={class:"text-xs text-muted-foreground"},Ze={key:1,class:"text-center py-6 text-muted-foreground"},et={class:"space-y-3"},tt={class:"flex items-center space-x-3"},st={class:"font-medium"},at={class:"text-sm text-muted-foreground"},lt={class:"space-y-4"},ot={class:"space-y-2"},nt={key:0,class:"p-3 bg-yellow-100 border border-yellow-400 rounded text-sm"},rt={key:1,class:"border rounded-lg overflow-hidden bg-muted/50"},ut={class:"relative aspect-square bg-black"},dt={key:1,class:"absolute inset-0 flex items-center justify-center bg-black/50 text-white text-center p-4"},it={class:"text-sm"},ct={key:2,class:"absolute inset-0 flex items-center justify-center bg-black/50 text-white"},mt={key:2,class:"text-center py-8 text-muted-foreground"},ft={class:"space-y-4"},_t={class:"space-y-2"},pt={class:"space-y-2"},Tt=Ce({__name:"Dashboard",props:{student:{},stats:{},classes:{},upcomingClasses:{},recentRequests:{},recentAttendance:{}},setup(ne){const p=ne,re=ye(),ue=P(()=>re.props.auth.user),de=[{title:"Dashboard",href:"/student/dashboard"}],D=b(!1),Q=b(!1),m=b(""),k=b(""),q=b("off"),S=b(""),g=b(!1),v=P(()=>{const r=p.stats;if(console.log("Computing attendance stats with:",r),!r)return{presentPercentage:0,absentPercentage:0,excusedPercentage:0,totalClasses:0,presentCount:0,absentCount:0,excusedCount:0};const e=r.totalAttendance||0,i=Math.max(0,e-(r.presentCount||0));let c=r.attendanceRate||0,f=0;e>0&&(f=Math.round(i/e*100)),c=isNaN(c)?0:c,f=isNaN(f)?0:f;const o={presentPercentage:c,absentPercentage:f,excusedPercentage:0,totalClasses:r.totalClasses||0,presentCount:r.presentCount||0,absentCount:i,excusedCount:0};return console.log("Computed attendance stats:",o),o}),L=P(()=>p.upcomingClasses||[]),ie=P(()=>p.recentAttendance??[]),$=P(()=>p.classes||[]),ce=()=>{if($.value.length===0){alert("You are not enrolled in any classes.");return}D.value=!0,q.value="auto",S.value=""};we(D,r=>{r||(q.value="off",m.value="",S.value="")});const me=r=>{console.error("Camera error:",r),S.value="Unable to access camera. Please check permissions."},fe=r=>{if(r.length>0){const e=r[0].rawValue;pe(e)}},_e=()=>{if($.value.length===0){alert("You are not enrolled in any classes.");return}Q.value=!0},pe=async r=>{var e;if(!m.value){alert("Please select a class first.");return}g.value=!0;try{const i=r.trim().split(",").map(A=>A.trim());if(i.length<2)throw new Error('Invalid QR code format. Expected: "Name,Course"');const c=i[0],f=i[1];if(!p.student)throw new Error("Student information not available");const o=p.student.name.toLowerCase().replace(/\s+/g," ").trim(),x=c.toLowerCase().replace(/\s+/g," ").trim();if(!(o.includes(x)||x.includes(o)))throw new Error(`QR code name "${c}" does not match your profile name "${p.student.name}"`);const F=(p.student.course||"").toLowerCase().replace(/\s+/g,""),O=f.toLowerCase().replace(/\s+/g,"");if(F&&!F.includes(O.replace("bs",""))&&!O.includes(F.replace("bachelor","").replace("science","")))throw new Error(`QR code course "${f}" does not match your profile course "${p.student.course}"`);const I=(e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content");if(!I)throw new Error("CSRF token not found. Please refresh the page.");console.log("QR Data verified - Name:",c,"Course:",f),console.log("Marking attendance for class:",m.value);const R=await fetch("/student/self-checkin",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":I,"X-Requested-With":"XMLHttpRequest",Authorization:`Bearer ${I}`},credentials:"same-origin",body:JSON.stringify({class_id:m.value,name:c,course:f})});if(console.log("Response status:",R.status),console.log("Response headers:",Object.fromEntries(R.headers.entries())),!R.ok){const A=await R.json().catch(()=>({message:"Failed to mark attendance"}));throw console.error("Error response:",A),new Error(A.message||`HTTP error! status: ${R.status}`)}const z=await R.json();console.log("Success response:",z),z.success?(alert("Success! You have been marked as present."),D.value=!1,m.value="",X.reload()):alert(z.message||"Failed to mark attendance")}catch(i){console.error("Check-in error:",i),S.value=i.message||"Failed to process check-in. Please try again."}finally{g.value=!1}},ve=async()=>{var r;if(!m.value){alert("Please select a class.");return}if(!k.value){alert("Please enter a session ID.");return}g.value=!0;try{const e=(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content");if(!e)throw new Error("CSRF token not found");const i=await fetch("/student/quick-checkin",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":e,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({method:"manual",qr_code:k.value,class_id:m.value})});if(!i.ok){const f=await i.json().catch(()=>({message:"Failed to mark attendance"}));throw new Error(f.message||`HTTP error! status: ${i.status}`)}const c=await i.json();c.success?(alert(`Success! ${c.message}`),Q.value=!1,m.value="",k.value="",X.reload()):alert(c.message||"Failed to mark attendance")}catch(e){console.error("Check-in error:",e),alert(e.message||"Failed to process check-in. Please try again.")}finally{g.value=!1}},ge=r=>{switch(r){case"present":return"bg-green-500";case"absent":return"bg-red-500";case"excused":return"bg-yellow-500";default:return"bg-gray-500"}},xe=r=>{switch(r){case"present":return ae;case"absent":return le;case"excused":return M;default:return Ee}};return(r,e)=>(d(),_(E,null,[s(t(he),{title:"Student Dashboard"}),s(be,{breadcrumbs:de},{default:a(()=>{var i,c,f;return[l("div",Ne,[l("div",null,[l("h1",je,[e[5]||(e[5]=n("Welcome back, ",-1)),l("span",Qe,u(((i=p.student)==null?void 0:i.name)||ue.value.name),1),e[6]||(e[6]=n(" ðŸŽ“",-1))]),l("p",qe," Student ID: "+u(((c=p.student)==null?void 0:c.student_id)||"Not available")+" â€¢ Course: "+u(((f=p.student)==null?void 0:f.course)||"Not specified"),1),e[7]||(e[7]=l("p",{class:"text-sm text-muted-foreground mt-1"},"Here's your attendance overview and upcoming classes",-1))]),l("div",Ae,[s(t(C),null,{default:a(()=>[s(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(w),{class:"text-sm font-medium"},{default:a(()=>e[8]||(e[8]=[n("Present %",-1)])),_:1,__:[8]}),s(t(ae),{class:"h-4 w-4 text-green-600"})]),_:1}),s(t(h),null,{default:a(()=>[l("div",Te,u(v.value.presentPercentage)+"%",1),l("p",Ve,u(v.value.presentCount)+" of "+u(v.value.totalClasses)+" sessions",1)]),_:1})]),_:1}),s(t(C),null,{default:a(()=>[s(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(w),{class:"text-sm font-medium"},{default:a(()=>e[9]||(e[9]=[n("Absent %",-1)])),_:1,__:[9]}),s(t(le),{class:"h-4 w-4 text-red-600"})]),_:1}),s(t(h),null,{default:a(()=>[l("div",Fe,u(v.value.absentPercentage)+"%",1),l("p",Ie,u(v.value.absentCount)+" of "+u(v.value.totalClasses)+" sessions",1)]),_:1})]),_:1}),s(t(C),null,{default:a(()=>[s(t(y),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[s(t(w),{class:"text-sm font-medium"},{default:a(()=>e[10]||(e[10]=[n("Excused %",-1)])),_:1,__:[10]}),s(t(M),{class:"h-4 w-4 text-yellow-600"})]),_:1}),s(t(h),null,{default:a(()=>[l("div",ze,u(v.value.excusedPercentage)+"%",1),l("p",Ye,u(v.value.excusedCount)+" of "+u(v.value.totalClasses)+" sessions",1)]),_:1})]),_:1})]),l("div",Be,[s(t(C),{class:"border-blue-200 bg-blue-50 dark:bg-blue-950/20"},{default:a(()=>[s(t(y),null,{default:a(()=>[s(t(w),{class:"text-blue-900 dark:text-blue-100"},{default:a(()=>e[11]||(e[11]=[n("Your QR Code Format",-1)])),_:1,__:[11]}),s(t(V),{class:"text-blue-700 dark:text-blue-300"},{default:a(()=>e[12]||(e[12]=[n(" Generate a QR code with this exact text to use for self check-in ",-1)])),_:1,__:[12]})]),_:1}),s(t(h),null,{default:a(()=>{var o,x;return[l("div",Ue,u(((o=r.student)==null?void 0:o.name)||"Your Name")+","+u(((x=r.student)==null?void 0:x.course)||"Your Course"),1),e[13]||(e[13]=l("p",{class:"text-xs text-blue-600 dark:text-blue-400 mt-2"},' Example: "Juan Dela Cruz,BSCS" or "Maria Santos,BSIT" ',-1))]}),_:1,__:[13]})]),_:1}),s(t(C),null,{default:a(()=>[s(t(y),null,{default:a(()=>[s(t(w),null,{default:a(()=>e[14]||(e[14]=[n("Self Check-In",-1)])),_:1,__:[14]}),s(t(V),null,{default:a(()=>e[15]||(e[15]=[n("Use your personal QR code (name,course format) to mark attendance",-1)])),_:1,__:[15]})]),_:1}),s(t(h),{class:"space-y-4"},{default:a(()=>[s(t(Y),{onClick:ce,class:"w-full",size:"lg"},{default:a(()=>[s(t(oe),{class:"mr-2 h-5 w-5"}),e[16]||(e[16]=n(" Scan Your QR Code ",-1))]),_:1,__:[16]}),e[18]||(e[18]=l("div",{class:"text-center text-sm text-muted-foreground"}," or ",-1)),s(t(Y),{onClick:_e,variant:"outline",class:"w-full",size:"lg"},{default:a(()=>[s(t(De),{class:"mr-2 h-5 w-5"}),e[17]||(e[17]=n(" Enter Session ID ",-1))]),_:1,__:[17]})]),_:1,__:[18]})]),_:1}),s(t(C),null,{default:a(()=>[s(t(y),null,{default:a(()=>[s(t(w),null,{default:a(()=>e[19]||(e[19]=[n("Upcoming Classes",-1)])),_:1,__:[19]}),s(t(V),null,{default:a(()=>e[20]||(e[20]=[n("Your schedule for today and tomorrow",-1)])),_:1,__:[20]})]),_:1}),s(t(h),null,{default:a(()=>[l("div",Me,[L.value.length>0?(d(),_("div",Le,[(d(!0),_(E,null,T(L.value.slice(0,4),o=>(d(),_("div",{key:o.class_name,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors"},[l("div",Oe,[l("p",Xe,u(o.class_name),1),l("p",He,u(o.teacher),1),l("p",Je,"Room "+u(o.room),1)]),l("div",We,[l("p",Ke,u(o.time),1),l("p",Ge,u(o.date),1)])]))),128))])):(d(),_("div",Ze,e[21]||(e[21]=[l("p",null,"No upcoming classes scheduled",-1)])))])]),_:1})]),_:1})]),s(t(C),null,{default:a(()=>[s(t(y),null,{default:a(()=>[s(t(w),null,{default:a(()=>e[22]||(e[22]=[n("Recent Attendance",-1)])),_:1,__:[22]}),s(t(V),null,{default:a(()=>e[23]||(e[23]=[n("Your recent attendance history",-1)])),_:1,__:[23]})]),_:1}),s(t(h),null,{default:a(()=>[l("div",et,[(d(!0),_(E,null,T(ie.value,(o,x)=>(d(),_("div",{key:x,class:"flex items-center justify-between p-3 border rounded-lg"},[l("div",tt,[l("div",{class:ke(["w-2 h-2 rounded-full",ge(o.status)])},null,2),l("div",null,[l("p",st,u(o.class_name),1),l("p",at,u(o.session_date),1)])]),s(t($e),{variant:o.status==="present"?"default":o.status==="excused"?"secondary":"destructive"},{default:a(()=>[(d(),N(Se(xe(o.status)),{class:"w-3 h-3 mr-1"})),n(" "+u(o.status.charAt(0).toUpperCase()+o.status.slice(1)),1)]),_:2},1032,["variant"])]))),128))])]),_:1})]),_:1})]),s(t(H),{open:D.value,"onUpdate:open":e[1]||(e[1]=o=>D.value=o)},{default:a(()=>[s(t(J),{class:"sm:max-w-md"},{default:a(()=>[s(t(W),null,{default:a(()=>[s(t(K),null,{default:a(()=>e[24]||(e[24]=[n("Self Check-in with Your QR Code",-1)])),_:1,__:[24]}),s(t(G),null,{default:a(()=>e[25]||(e[25]=[n(' Select your class, then scan your personal QR code containing your name and course (e.g., "Juan Dela Cruz,BSCS") ',-1)])),_:1,__:[25]})]),_:1}),l("div",lt,[l("div",ot,[s(t(U),{for:"qr-class"},{default:a(()=>e[26]||(e[26]=[n("Select Class",-1)])),_:1,__:[26]}),s(t(Z),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o)},{default:a(()=>[s(t(ee),{id:"qr-class"},{default:a(()=>[s(t(te),{placeholder:"Choose a class"})]),_:1}),s(t(se),null,{default:a(()=>[$.value.length===0?(d(),N(t(B),{key:0,value:"",disabled:""},{default:a(()=>e[27]||(e[27]=[n(" No enrolled classes found ",-1)])),_:1,__:[27]})):j("",!0),(d(!0),_(E,null,T($.value,o=>(d(),N(t(B),{key:o.id,value:String(o.id)},{default:a(()=>[n(u(o.display_name||`${o.name} - ${o.course} ${o.section}`),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),$.value.length===0?(d(),_("div",nt,e[28]||(e[28]=[l("p",{class:"font-medium text-yellow-800"},"No enrolled classes found",-1),l("p",{class:"text-yellow-700"},"Please contact your teacher to be enrolled in a class.",-1)]))):j("",!0),m.value?(d(),_("div",rt,[e[30]||(e[30]=l("p",{class:"text-sm text-center p-2"},"Scan your personal QR code with your name and course",-1)),l("div",ut,[q.value==="auto"?(d(),N(t(Pe),{key:0,camera:q.value,onDetect:fe,onError:me,class:"w-full h-full object-cover"},null,8,["camera"])):j("",!0),S.value?(d(),_("div",dt,[l("div",null,[s(t(M),{class:"h-8 w-8 mx-auto mb-2"}),l("p",it,u(S.value),1)])])):j("",!0),g.value?(d(),_("div",ct,e[29]||(e[29]=[l("div",{class:"text-center"},[l("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),l("p",{class:"text-sm"},"Processing...")],-1)]))):j("",!0)])])):(d(),_("div",mt,[s(t(oe),{class:"h-12 w-12 mx-auto mb-2 opacity-50"}),e[31]||(e[31]=l("p",null,"Select a class to start scanning",-1))]))])]),_:1})]),_:1},8,["open"]),s(t(H),{open:Q.value,"onUpdate:open":e[4]||(e[4]=o=>Q.value=o)},{default:a(()=>[s(t(J),{class:"sm:max-w-md"},{default:a(()=>[s(t(W),null,{default:a(()=>[s(t(K),null,{default:a(()=>e[32]||(e[32]=[n("Enter Session ID",-1)])),_:1,__:[32]}),s(t(G),null,{default:a(()=>e[33]||(e[33]=[n(" Select your class and enter the session ID provided by your teacher ",-1)])),_:1,__:[33]})]),_:1}),l("div",ft,[l("div",_t,[s(t(U),{for:"manual-class"},{default:a(()=>e[34]||(e[34]=[n("Select Class",-1)])),_:1,__:[34]}),s(t(Z),{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=o=>m.value=o)},{default:a(()=>[s(t(ee),{id:"manual-class"},{default:a(()=>[s(t(te),{placeholder:"Choose a class"})]),_:1}),s(t(se),null,{default:a(()=>[(d(!0),_(E,null,T($.value,o=>(d(),N(t(B),{key:o.id,value:String(o.id)},{default:a(()=>[n(u(o.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),l("div",pt,[s(t(U),{for:"session-id"},{default:a(()=>e[35]||(e[35]=[n("Session ID",-1)])),_:1,__:[35]}),s(t(Re),{id:"session-id",modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=o=>k.value=o),type:"text",placeholder:"Enter session ID",disabled:!m.value||g.value},null,8,["modelValue","disabled"])]),s(t(Y),{onClick:ve,class:"w-full",disabled:!m.value||!k.value||g.value},{default:a(()=>[n(u(g.value?"Processing...":"Submit Attendance"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["open"])]}),_:1})],64))}});export{Tt as default};
